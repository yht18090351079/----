<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>地质灾害预警系统 - 实时监控大屏</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚡</text></svg>"
    
    <!-- 引入字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto+Mono:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- 引入CesiumJS CDN -->
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.131/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.131/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    
    <link rel="stylesheet" href="css/geological-disaster-dashboard.css">
</head>
<body>
    <!-- 地图作为全屏背景 -->
    <div id="cesiumContainer" class="map-background"></div>

    <!-- 顶部导航栏 - 科技风格无边界设计 -->
    <header class="header">
        <div class="header-left">
            <div class="logo">⚡</div>
            <h1 class="system-title">地质灾害预警系统</h1>
        </div>

        <!-- 导航菜单 -->
        <nav class="header-nav">
            <div class="menu-item active">
                <span class="menu-icon">◉</span>
                实时监控
            </div>
            <div class="menu-item">
                <span class="menu-icon">△</span>
                预警管理
            </div>
            <div class="menu-item">
                <span class="menu-icon">▲</span>
                数据分析
            </div>
            <div class="menu-item">
                <span class="menu-icon">◆</span>
                应急指挥
            </div>
            <div class="menu-item">
                <span class="menu-icon">◈</span>
                系统设置
            </div>
        </nav>

        <div class="header-right">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span>系统正常</span>
            </div>
            <div class="user-info">
                <div class="user-avatar">管</div>
                <span>管理员</span>
            </div>
        </div>
    </header>

    <!-- 浮动UI层 -->
    <div class="floating-ui-layer">
        <!-- 地图工具栏 -->
        <div class="map-toolbar">
            <div class="toolbar-section toolbar-buttons">
                <button class="toolbar-btn active" id="homeBtn">◎ 回到成都</button>
                <button class="toolbar-btn active" id="terrainBtn">▲ 关闭地形</button>
                <button class="toolbar-btn" id="boundaryBtn">◇ 行政区划</button>
                <button class="toolbar-btn" id="imageryBtn">◈ 切换影像</button>
                <button class="toolbar-btn" id="addPointBtn">● 添加监测点</button>
                <button class="toolbar-btn" id="addAreaBtn">△ 添加预警区域</button>
                <button class="toolbar-btn" id="clearBtn">◌ 清除所有</button>
            </div>

            <div class="toolbar-section toolbar-status">
                <div class="status-item">
                    <span>监测点总数: <span id="totalPoints">156</span></span>
                    <span style="margin-left: 24px;">在线设备: <span id="onlinePoints">154</span></span>
                </div>
                <div class="status-item">
                    <span>最后更新: <span id="lastUpdate">2025/07/17 16:26:42</span></span>
                </div>
                <div class="status-item">
                    <span>系统版本: v2.1.0</span>
                </div>
            </div>
        </div>

        <!-- 左侧面板容器 -->
        <div class="left-panels-container">


            <!-- 设备状态面板 -->
            <div class="panel-wrapper">
                <div class="device-panel">
                    <div class="panel-header">
                        <div class="device-header">
                            <h3 class="section-title">
                                <span>◉</span>
                                设备状态
                            </h3>
                            <div class="device-stats-inline">
                                <div class="stat-item-inline" data-tooltip="正常 9">
                                    <div class="stat-dot online"></div>
                                    <span class="stat-value-inline" id="onlineCount">9</span>
                                </div>
                                <div class="stat-item-inline" data-tooltip="预警 2">
                                    <div class="stat-dot warning"></div>
                                    <span class="stat-value-inline" id="warningCount">2</span>
                                </div>
                                <div class="stat-item-inline" data-tooltip="离线 1">
                                    <div class="stat-dot offline"></div>
                                    <span class="stat-value-inline" id="offlineCount">1</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel-content">
                        <div id="deviceList">
                            <!-- 设备列表将由JavaScript动态生成 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 右侧面板容器 -->
        <div class="right-panels-container">
            <!-- KPI指标卡片面板 -->
            <div class="panel-wrapper">
                <div class="kpi-panel">
                    <div class="panel-content">
                        <div class="kpi-cards">
                            <div class="kpi-card">
                                <div class="kpi-value" id="onlineDevices">98.5%</div>
                                <div class="kpi-label">在线设备率</div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-value" id="dataIntegrity">95.2%</div>
                                <div class="kpi-label">数据完整性</div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-value" id="todayWarnings">3</div>
                                <div class="kpi-label">当日预警</div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-value" id="processingEvents">1</div>
                                <div class="kpi-label">处理中事件</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 预警通知合并面板 -->
            <div class="panel-wrapper">
                <div class="warning-notification-panel">
                    <!-- 页卡头部直接在看板顶部，横向充满 -->
                    <div class="panel-tabs-header">
                        <button class="panel-tab active" data-tab="warnings">
                            <span class="tab-icon">△</span>
                            <span class="tab-text">预警信息</span>
                            <span class="tab-badge" id="warningBadge">3</span>
                        </button>
                        <button class="panel-tab" data-tab="notifications">
                            <span class="tab-icon">◈</span>
                            <span class="tab-text">实时通知</span>
                            <span class="tab-badge" id="notificationBadge">4</span>
                        </button>
                    </div>

                    <!-- 面板内容区域 -->
                    <div class="panel-content">
                        <!-- 预警信息页卡内容 -->
                        <div class="tab-content active" id="warningsTab">
                            <div class="warning-list" id="warningListMerged">
                                <div class="warning-item red">
                                    <div class="warning-header">
                                        <span class="warning-level red">红色预警</span>
                                        <span class="warning-time">14:25</span>
                                    </div>
                                    <div class="warning-content">XX村滑坡风险极高，请立即撤离</div>
                                </div>

                                <div class="warning-item orange">
                                    <div class="warning-header">
                                        <span class="warning-level orange">橙色预警</span>
                                        <span class="warning-time">13:45</span>
                                    </div>
                                    <div class="warning-content">XX镇泥石流风险较高，注意防范</div>
                                </div>

                                <div class="warning-item yellow">
                                    <div class="warning-header">
                                        <span class="warning-level yellow">黄色预警</span>
                                        <span class="warning-time">12:30</span>
                                    </div>
                                    <div class="warning-content">XX县地质灾害风险一般，保持警惕</div>
                                </div>
                            </div>
                        </div>

                        <!-- 实时通知页卡内容 -->
                        <div class="tab-content" id="notificationsTab">
                            <div id="notificationListMerged">
                                <div class="notification-item">
                                    <span class="notification-content">系统自检完成，所有模块正常运行</span>
                                    <span class="notification-time">16:30</span>
                                </div>

                                <div class="notification-item">
                                    <span class="notification-content">新增3个监测点数据接入</span>
                                    <span class="notification-time">16:25</span>
                                </div>

                                <div class="notification-item">
                                    <span class="notification-content">预警推送服务已启动</span>
                                    <span class="notification-time">16:20</span>
                                </div>

                                <div class="notification-item">
                                    <span class="notification-content">数据备份任务执行成功</span>
                                    <span class="notification-time">16:15</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 弹窗模态框 -->
    <!-- 设备详情弹窗 -->
    <div id="deviceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>设备详情</h3>
                <span class="close" data-modal="deviceModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="device-info">
                    <div class="info-row">
                        <span class="label">设备名称:</span>
                        <span class="value" id="deviceName">监测站001</span>
                    </div>
                    <div class="info-row">
                        <span class="label">设备状态:</span>
                        <span class="value status" id="deviceStatus">正常运行</span>
                    </div>
                    <div class="info-row">
                        <span class="label">位置坐标:</span>
                        <span class="value" id="deviceLocation">104.0668°E, 30.5728°N</span>
                    </div>
                    <div class="info-row">
                        <span class="label">最后更新:</span>
                        <span class="value" id="deviceLastUpdate">2025-07-18 16:30:25</span>
                    </div>
                    <div class="info-row">
                        <span class="label">数据完整性:</span>
                        <span class="value" id="deviceDataIntegrity">98.5%</span>
                    </div>
                </div>
                <div class="device-charts">
                    <div class="chart-container">
                        <h4>24小时数据趋势</h4>
                        <div class="chart-placeholder">
                            <canvas id="deviceChart" width="300" height="150"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="controlDevice()">设备控制</button>
                <button class="btn btn-secondary" onclick="exportData()">导出数据</button>
            </div>
        </div>
    </div>

    <!-- 预警详情弹窗 -->
    <div id="warningModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>预警详情</h3>
                <span class="close" data-modal="warningModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="warning-details">
                    <div class="warning-level-badge" id="warningLevelBadge">红色预警</div>
                    <div class="warning-title" id="warningTitle">XX村滑坡风险极高</div>
                    <div class="warning-description" id="warningDescription">
                        根据最新监测数据显示，该区域土壤含水量急剧上升，地表位移加速，存在极高的滑坡风险。建议立即组织人员撤离，并设置警戒区域。
                    </div>
                    <div class="warning-info-grid">
                        <div class="info-item">
                            <span class="label">预警等级:</span>
                            <span class="value red" id="warningLevel">红色预警</span>
                        </div>
                        <div class="info-item">
                            <span class="label">发布时间:</span>
                            <span class="value" id="warningTime">2025-07-18 14:25:30</span>
                        </div>
                        <div class="info-item">
                            <span class="label">影响范围:</span>
                            <span class="value" id="warningArea">半径2公里</span>
                        </div>
                        <div class="info-item">
                            <span class="label">风险类型:</span>
                            <span class="value" id="warningType">滑坡</span>
                        </div>
                        <div class="info-item">
                            <span class="label">预计持续:</span>
                            <span class="value" id="warningDuration">24-48小时</span>
                        </div>
                        <div class="info-item">
                            <span class="label">责任人:</span>
                            <span class="value" id="warningResponsible">张三</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" onclick="emergencyResponse()">启动应急响应</button>
                <button class="btn btn-warning" onclick="sendNotification()">发送通知</button>
                <button class="btn btn-secondary" onclick="updateWarning()">更新状态</button>
            </div>
        </div>
    </div>

    <!-- 添加监测点弹窗 -->
    <div id="addPointModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>添加监测点</h3>
                <span class="close" data-modal="addPointModal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addPointForm">
                    <div class="form-group">
                        <label for="pointName">监测点名称:</label>
                        <input type="text" id="pointName" name="pointName" placeholder="请输入监测点名称" required>
                    </div>
                    <div class="form-group">
                        <label for="pointType">监测类型:</label>
                        <select id="pointType" name="pointType" required>
                            <option value="">请选择监测类型</option>
                            <option value="landslide">滑坡监测</option>
                            <option value="debris">泥石流监测</option>
                            <option value="collapse">崩塌监测</option>
                            <option value="subsidence">地面沉降监测</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="pointLongitude">经度:</label>
                        <input type="number" id="pointLongitude" name="pointLongitude" step="0.000001" placeholder="104.066800" required>
                    </div>
                    <div class="form-group">
                        <label for="pointLatitude">纬度:</label>
                        <input type="number" id="pointLatitude" name="pointLatitude" step="0.000001" placeholder="30.572800" required>
                    </div>
                    <div class="form-group">
                        <label for="pointElevation">海拔高度(米):</label>
                        <input type="number" id="pointElevation" name="pointElevation" placeholder="500">
                    </div>
                    <div class="form-group">
                        <label for="pointDescription">描述信息:</label>
                        <textarea id="pointDescription" name="pointDescription" rows="3" placeholder="请输入监测点的详细描述信息"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveMonitoringPoint()">保存</button>
                <button class="btn btn-secondary" onclick="closeModal('addPointModal')">取消</button>
            </div>
        </div>
    </div>

    <!-- 系统设置弹窗 -->
    <div id="settingsModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>系统设置</h3>
                <span class="close" data-modal="settingsModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="settings-tabs">
                    <div class="tab-nav">
                        <button class="tab-btn active" onclick="switchTab('general')">常规设置</button>
                        <button class="tab-btn" onclick="switchTab('alert')">预警设置</button>
                        <button class="tab-btn" onclick="switchTab('display')">显示设置</button>
                        <button class="tab-btn" onclick="switchTab('user')">用户管理</button>
                    </div>
                    <div class="tab-content">
                        <div id="general" class="tab-pane active">
                            <div class="form-group">
                                <label>数据更新频率:</label>
                                <select id="updateFrequency">
                                    <option value="5">5秒</option>
                                    <option value="10" selected>10秒</option>
                                    <option value="30">30秒</option>
                                    <option value="60">1分钟</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>数据保存天数:</label>
                                <input type="number" id="dataRetention" value="30" min="1" max="365">
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="autoBackup" checked>
                                    启用自动备份
                                </label>
                            </div>
                        </div>
                        <div id="alert" class="tab-pane">
                            <div class="form-group">
                                <label>预警阈值设置:</label>
                                <div class="threshold-settings">
                                    <div class="threshold-item">
                                        <span>黄色预警:</span>
                                        <input type="number" value="60" min="0" max="100">%
                                    </div>
                                    <div class="threshold-item">
                                        <span>橙色预警:</span>
                                        <input type="number" value="80" min="0" max="100">%
                                    </div>
                                    <div class="threshold-item">
                                        <span>红色预警:</span>
                                        <input type="number" value="95" min="0" max="100">%
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="display" class="tab-pane">
                            <div class="form-group">
                                <label>地图主题:</label>
                                <select id="mapTheme">
                                    <option value="dark" selected>深色主题</option>
                                    <option value="light">浅色主题</option>
                                    <option value="satellite">卫星图像</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="showTerrain" checked>
                                    显示地形
                                </label>
                            </div>
                        </div>
                        <div id="user" class="tab-pane">
                            <div class="user-list">
                                <div class="user-item">
                                    <span>管理员</span>
                                    <span class="user-role">超级管理员</span>
                                    <button class="btn btn-small">编辑</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveSettings()">保存设置</button>
                <button class="btn btn-secondary" onclick="closeModal('settingsModal')">取消</button>
            </div>
        </div>
    </div>

    <!-- 通知弹窗 -->
    <div id="notificationToast" class="toast">
        <div class="toast-content">
            <div class="toast-icon">
                <span id="toastIcon">✓</span>
            </div>
            <div class="toast-message">
                <div class="toast-title" id="toastTitle">操作成功</div>
                <div class="toast-text" id="toastText">操作已成功完成</div>
            </div>
            <button class="toast-close" onclick="hideToast()">&times;</button>
        </div>
    </div>

    <!-- 全局Tooltip容器 -->
    <div id="globalTooltip" class="global-tooltip"></div>

    <script src="js/geological-disaster-dashboard.js"></script>
</body>
</html>
