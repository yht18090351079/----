<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ°è´¨ç¾å®³é¢„è­¦ç³»ç»Ÿ - å®æ—¶ç›‘æ§å¤§å±</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš¡</text></svg>"
    
    <!-- å¼•å…¥å­—ä½“ -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto+Mono:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- å¼•å…¥CesiumJS CDN -->
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.131/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.131/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    
    <link rel="stylesheet" href="css/geological-disaster-dashboard.css">

    <style>
        /* å¤©æ°”ä¿¡æ¯æ ·å¼ */
        .weather-info {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .weather-info:hover {
            background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.08));
            border-color: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }

        .weather-icon {
            font-size: 18px;
            line-height: 1;
        }

        .weather-details {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .weather-temp {
            font-size: 14px;
            font-weight: 600;
            color: #ffffff;
            line-height: 1;
        }

        .weather-desc {
            font-size: 11px;
            color: rgba(255,255,255,0.8);
            line-height: 1;
        }

        /* è®¾å¤‡é¢æ¿å®¹å™¨æ ·å¼ */
        .device-panel-container {
            display: flex;
            gap: 15px;
            align-items: flex-start;
            width: 100%;
            height: 100%;
        }

        .device-panel {
            flex: 1;
            min-width: 0;
        }

        /* æ°”è±¡æŒ‰é’®å®¹å™¨æ ·å¼ */
        .weather-buttons-container {
            display: flex;
            flex-direction: column;
            gap: 6px;
            min-width: 50px;
        }

        .weather-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            padding: 0;
            background: linear-gradient(135deg, rgba(0,30,60,0.8), rgba(0,15,40,0.9));
            border: 1px solid rgba(0,255,255,0.3);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            font-size: 16px;
            line-height: 1;
            color: rgba(255,255,255,0.8);
        }

        .weather-btn:hover {
            background: linear-gradient(135deg, rgba(0,40,80,0.9), rgba(0,20,50,0.95));
            border-color: rgba(0,255,255,0.5);
            color: rgba(255,255,255,1);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0,255,255,0.2);
        }

        .weather-btn.active {
            background: linear-gradient(135deg, rgba(0,255,255,0.2), rgba(0,200,200,0.3));
            border-color: rgba(0,255,255,0.8);
            color: #00ffff;
            box-shadow: 0 0 15px rgba(0,255,255,0.4);
            transform: scale(1.05);
        }

        /* å¤©æ°”æ—¶é—´æ§åˆ¶é¢æ¿æ ·å¼å·²ç§»è‡³å¤–éƒ¨CSSæ–‡ä»¶ */



        /* æ°”è±¡æ•°æ®æ˜¾ç¤ºé¢æ¿æ ·å¼ */
        .weather-data-panel {
            position: fixed;
            top: 120px;
            right: 20px;
            background: linear-gradient(135deg, rgba(0,20,40,0.95), rgba(0,10,25,0.98));
            border: 2px solid rgba(0,255,255,0.4);
            border-radius: 12px;
            padding: 15px;
            min-width: 200px;
            backdrop-filter: blur(15px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 999;
        }

        .data-panel-header {
            color: #00ffff;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 10px;
            text-align: center;
            border-bottom: 1px solid rgba(0,255,255,0.3);
            padding-bottom: 8px;
        }

        .data-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .data-label {
            color: rgba(255,255,255,0.8);
        }

        .data-item span:last-child {
            color: #ffffff;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <!-- åœ°å›¾ä½œä¸ºå…¨å±èƒŒæ™¯ -->
    <div id="cesiumContainer" class="map-background"></div>

    <!-- é¡¶éƒ¨å¯¼èˆªæ  - ç§‘æŠ€é£æ ¼æ— è¾¹ç•Œè®¾è®¡ -->
    <header class="header">
        <div class="header-left">
            <div class="logo">âš¡</div>
            <h1 class="system-title">åœ°è´¨ç¾å®³é¢„è­¦ç³»ç»Ÿ</h1>
        </div>

        <!-- å¯¼èˆªèœå• -->
        <nav class="header-nav">
            <div class="menu-item active">
                <span class="menu-icon">â—‰</span>
                å®æ—¶ç›‘æ§
            </div>
            <div class="menu-item">
                <span class="menu-icon">â–³</span>
                é¢„è­¦ç®¡ç†
            </div>
            <div class="menu-item">
                <span class="menu-icon">â–²</span>
                æ•°æ®åˆ†æ
            </div>
            <div class="menu-item">
                <span class="menu-icon">â—†</span>
                åº”æ€¥æŒ‡æŒ¥
            </div>
            <div class="menu-item">
                <span class="menu-icon">â—ˆ</span>
                ç³»ç»Ÿè®¾ç½®
            </div>
        </nav>

        <div class="header-right">
            <div class="weather-info">
                <div class="weather-icon">â˜€ï¸</div>
                <div class="weather-details">
                    <div class="weather-temp">23Â°C</div>
                    <div class="weather-desc">æ™´</div>
                </div>
            </div>
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span>ç³»ç»Ÿæ­£å¸¸</span>
            </div>
            <div class="user-info">
                <div class="user-avatar">ç®¡</div>
                <span>ç®¡ç†å‘˜</span>
            </div>
        </div>
    </header>

    <!-- æµ®åŠ¨UIå±‚ -->
    <div class="floating-ui-layer">
        <!-- åœ°å›¾å·¥å…·æ  -->
        <div class="map-toolbar">
            <div class="toolbar-section toolbar-buttons">
                <button class="toolbar-btn active" id="homeBtn">â— å›åˆ°æˆéƒ½</button>
                <button class="toolbar-btn active" id="terrainBtn">â–² å…³é—­åœ°å½¢</button>
                <button class="toolbar-btn" id="boundaryBtn">â—‡ è¡Œæ”¿åŒºåˆ’</button>
                <button class="toolbar-btn" id="imageryBtn">â—ˆ åˆ‡æ¢å½±åƒ</button>
                <button class="toolbar-btn" id="addAreaBtn">â–³ æ·»åŠ é¢„è­¦åŒºåŸŸ</button>
                <button class="toolbar-btn" id="clearBtn">â—Œ æ¸…é™¤æ‰€æœ‰</button>
            </div>

            <div class="toolbar-section toolbar-status">
                <div class="status-item">
                    <span>ç›‘æµ‹ç‚¹æ€»æ•°: <span id="totalPoints">156</span></span>
                    <span style="margin-left: 24px;">åœ¨çº¿è®¾å¤‡: <span id="onlinePoints">154</span></span>
                </div>
                <div class="status-item">
                    <span>æœ€åæ›´æ–°: <span id="lastUpdate">2025/07/17 16:26:42</span></span>
                </div>
                <div class="status-item">
                    <span>ç³»ç»Ÿç‰ˆæœ¬: v2.1.0</span>
                </div>
            </div>
        </div>

        <!-- å·¦ä¾§é¢æ¿å®¹å™¨ -->
        <div class="left-panels-container">
            <!-- å·¦ä¾§ä¸Šéƒ¨ï¼šé¢„è­¦é€šçŸ¥é¢æ¿ -->
            <div class="panel-wrapper">
                <div class="warning-notification-panel">
                    <!-- é¡µå¡å¤´éƒ¨ç›´æ¥åœ¨çœ‹æ¿é¡¶éƒ¨ï¼Œæ¨ªå‘å……æ»¡ -->
                    <div class="panel-tabs-header">
                        <button class="panel-tab active" data-tab="warnings">
                            <span class="tab-icon">â–³</span>
                            <span class="tab-text">é¢„è­¦ä¿¡æ¯</span>
                            <span class="tab-badge" id="warningBadge">3</span>
                        </button>
                        <button class="panel-tab" data-tab="notifications">
                            <span class="tab-icon">â—ˆ</span>
                            <span class="tab-text">å®æ—¶é€šçŸ¥</span>
                            <span class="tab-badge" id="notificationBadge">4</span>
                        </button>
                    </div>

                    <!-- é¢æ¿å†…å®¹åŒºåŸŸ -->
                    <div class="panel-content">
                        <!-- é¢„è­¦ä¿¡æ¯é¡µå¡å†…å®¹ -->
                        <div class="tab-content active" id="warningsTab">
                            <div class="warning-list" id="warningListMerged">
                                <div class="warning-item red">
                                    <div class="warning-header">
                                        <span class="warning-level red">çº¢è‰²é¢„è­¦</span>
                                        <span class="warning-time">14:25</span>
                                    </div>
                                    <div class="warning-content">XXæ‘æ»‘å¡é£é™©æé«˜ï¼Œè¯·ç«‹å³æ’¤ç¦»</div>
                                </div>

                                <div class="warning-item orange">
                                    <div class="warning-header">
                                        <span class="warning-level orange">æ©™è‰²é¢„è­¦</span>
                                        <span class="warning-time">13:45</span>
                                    </div>
                                    <div class="warning-content">XXé•‡æ³¥çŸ³æµé£é™©è¾ƒé«˜ï¼Œæ³¨æ„é˜²èŒƒ</div>
                                </div>

                                <div class="warning-item yellow">
                                    <div class="warning-header">
                                        <span class="warning-level yellow">é»„è‰²é¢„è­¦</span>
                                        <span class="warning-time">12:30</span>
                                    </div>
                                    <div class="warning-content">XXå¿åœ°è´¨ç¾å®³é£é™©ä¸€èˆ¬ï¼Œä¿æŒè­¦æƒ•</div>
                                </div>
                            </div>
                        </div>

                        <!-- å®æ—¶é€šçŸ¥é¡µå¡å†…å®¹ -->
                        <div class="tab-content" id="notificationsTab">
                            <div id="notificationListMerged">
                                <div class="notification-item">
                                    <span class="notification-content">ç³»ç»Ÿè‡ªæ£€å®Œæˆï¼Œæ‰€æœ‰æ¨¡å—æ­£å¸¸è¿è¡Œ</span>
                                    <span class="notification-time">16:30</span>
                                </div>

                                <div class="notification-item">
                                    <span class="notification-content">æ–°å¢3ä¸ªç›‘æµ‹ç‚¹æ•°æ®æ¥å…¥</span>
                                    <span class="notification-time">16:25</span>
                                </div>

                                <div class="notification-item">
                                    <span class="notification-content">é¢„è­¦æ¨é€æœåŠ¡å·²å¯åŠ¨</span>
                                    <span class="notification-time">16:20</span>
                                </div>

                                <div class="notification-item">
                                    <span class="notification-content">æ•°æ®å¤‡ä»½ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ</span>
                                    <span class="notification-time">16:15</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å·¦ä¾§ä¸‹éƒ¨ï¼šè®¾å¤‡çŠ¶æ€é¢æ¿ -->
            <div class="panel-wrapper">
                <div class="device-panel">
                    <div class="panel-header">
                        <div class="device-header">
                            <div class="device-title-section">
                                <h3 class="section-title">
                                    <span>â—‰</span>
                                    è®¾å¤‡çŠ¶æ€
                                </h3>
                                <div class="device-type-selector">
                                    <select id="deviceTypeFilter" class="device-type-dropdown">
                                        <option value="all">å…¨éƒ¨è®¾å¤‡</option>
                                        <option value="weather">æ°”è±¡ç«™</option>
                                        <option value="water">æ°´ä½è®¡</option>
                                        <option value="camera">æ‘„åƒå¤´</option>
                                        <option value="displacement">ä½ç§»è®¡</option>
                                        <option value="rainfall">é›¨é‡è®¡</option>
                                        <option value="soil">åœŸå£¤ç›‘æµ‹</option>
                                    </select>
                                </div>
                            </div>
                            <div class="device-stats-inline">
                                <div class="stat-item-inline" data-tooltip="æ­£å¸¸ 9">
                                    <div class="stat-dot online"></div>
                                    <span class="stat-value-inline" id="onlineCount">9</span>
                                </div>
                                <div class="stat-item-inline" data-tooltip="é¢„è­¦ 2">
                                    <div class="stat-dot warning"></div>
                                    <span class="stat-value-inline" id="warningCount">2</span>
                                </div>
                                <div class="stat-item-inline" data-tooltip="ç¦»çº¿ 1">
                                    <div class="stat-dot offline"></div>
                                    <span class="stat-value-inline" id="offlineCount">1</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel-content">
                        <div id="deviceList">
                            <!-- è®¾å¤‡åˆ—è¡¨å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ°”è±¡çƒ­åŠ›å›¾æŒ‰é’®å®¹å™¨ - æ”¾åœ¨å·¦ä¾§é¢æ¿å³è¾¹ -->
        <div class="weather-buttons-container">
            <button class="weather-btn" id="temperatureBtn" title="æ¸©åº¦çƒ­åŠ›å›¾">
                ğŸŒ¡ï¸
            </button>
            <button class="weather-btn" id="rainfallBtn" title="é™é›¨çƒ­åŠ›å›¾">
                ğŸŒ§ï¸
            </button>
            <button class="weather-btn" id="windBtn" title="é£é€Ÿçƒ­åŠ›å›¾">
                ğŸ’¨
            </button>
        </div>

        <!-- å³ä¾§é¢æ¿å®¹å™¨ -->
        <div class="right-panels-container">
            <!-- ä»»åŠ¡é¢æ¿ -->
            <div class="panel-wrapper">
                <div class="task-panel">
                    <div class="panel-tabs-header">
                        <button class="panel-tab active" data-tab="pending">
                            <span class="tab-icon">â³</span>
                            <span class="tab-text">å¾…å¤„ç†ä»»åŠ¡</span>
                            <span class="tab-badge" id="pendingCount">5</span>
                        </button>
                        <button class="panel-tab" data-tab="processing">
                            <span class="tab-icon">âš¡</span>
                            <span class="tab-text">å¤„ç†ä¸­ä»»åŠ¡</span>
                            <span class="tab-badge" id="processingCount">4</span>
                        </button>
                        <button class="panel-tab" data-tab="completed">
                            <span class="tab-icon">âœ“</span>
                            <span class="tab-text">å·²å¤„ç†ä»»åŠ¡</span>
                            <span class="tab-badge" id="completedCount">3</span>
                        </button>
                    </div>
                    <div class="panel-content">
                        <!-- å¾…å¤„ç†ä»»åŠ¡ -->
                        <div id="pending" class="tab-pane active">
                            <div class="task-list" id="pendingTaskList">
                                <!-- ä»»åŠ¡é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                        <!-- å¤„ç†ä¸­ä»»åŠ¡ -->
                        <div id="processing" class="tab-pane">
                            <div class="task-list" id="processingTaskList">
                                <!-- ä»»åŠ¡é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                        <!-- å·²å¤„ç†ä»»åŠ¡ -->
                        <div id="completed" class="tab-pane">
                            <div class="task-list" id="completedTaskList">
                                <!-- ä»»åŠ¡é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>

    <!-- å¼¹çª—æ¨¡æ€æ¡† -->
    <!-- ä»»åŠ¡è¯¦æƒ…å¼¹çª— -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ä»»åŠ¡è¯¦æƒ…</h3>
                <span class="close" data-modal="taskModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="task-details">
                    <div class="task-status-badge" id="taskStatusBadge">å¾…å¤„ç†</div>
                    <div class="task-title" id="taskModalTitle">æ•°æ®é‡‡é›†ä»»åŠ¡</div>
                    <div class="task-description" id="taskModalDescription">
                        å‰å¾€XXç›‘æµ‹ç‚¹è¿›è¡Œä¾‹è¡Œæ•°æ®é‡‡é›†ï¼Œæ£€æŸ¥è®¾å¤‡è¿è¡ŒçŠ¶æ€ï¼Œè®°å½•ç›¸å…³æ•°æ®å¹¶ä¸Šä¼ ç³»ç»Ÿã€‚
                    </div>
                    <div class="task-info-grid" id="taskInfoGrid">
                        <div class="info-item">
                            <span class="label">ä»»åŠ¡ç±»å‹:</span>
                            <span class="value" id="taskType">æ•°æ®é‡‡é›†</span>
                        </div>
                        <div class="info-item">
                            <span class="label">ä¼˜å…ˆçº§:</span>
                            <span class="value priority-high" id="taskPriority">é«˜</span>
                        </div>
                        <div class="info-item">
                            <span class="label">åˆ†é…æ—¶é—´:</span>
                            <span class="value" id="taskAssignTime">2025-07-24 09:00</span>
                        </div>
                        <div class="info-item">
                            <span class="label">æˆªæ­¢æ—¶é—´:</span>
                            <span class="value" id="taskDeadline">2025-07-24 18:00</span>
                        </div>
                        <div class="info-item">
                            <span class="label">æ‰§è¡Œäººå‘˜:</span>
                            <span class="value" id="taskAssignee">å¼ ä¸‰</span>
                        </div>
                        <div class="info-item">
                            <span class="label">ä»»åŠ¡åœ°ç‚¹:</span>
                            <span class="value" id="taskLocation">æˆéƒ½å¸‚æ­¦ä¾¯åŒºXXç›‘æµ‹ç‚¹</span>
                        </div>
                    </div>
                    <div class="task-content-section" id="taskModalContent">
                        <!-- ä»»åŠ¡ç‰¹å®šå†…å®¹å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="acceptTask()">æ¥å—ä»»åŠ¡</button>
                <button class="btn btn-warning" onclick="updateTaskStatus()">æ›´æ–°çŠ¶æ€</button>
                <button class="btn btn-secondary" onclick="viewTaskDetails()">æŸ¥çœ‹è¯¦æƒ…</button>
            </div>
        </div>
    </div>

    <!-- è®¾å¤‡è¯¦æƒ…å¼¹çª— -->
    <div id="deviceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>è®¾å¤‡è¯¦æƒ…</h3>
                <span class="close" data-modal="deviceModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="device-info">
                    <div class="info-row">
                        <span class="label">è®¾å¤‡åç§°:</span>
                        <span class="value" id="deviceName">ç›‘æµ‹ç«™001</span>
                    </div>
                    <div class="info-row">
                        <span class="label">è®¾å¤‡çŠ¶æ€:</span>
                        <span class="value status" id="deviceStatus">æ­£å¸¸è¿è¡Œ</span>
                    </div>
                    <div class="info-row">
                        <span class="label">ä½ç½®åæ ‡:</span>
                        <span class="value" id="deviceLocation">104.0668Â°E, 30.5728Â°N</span>
                    </div>
                    <div class="info-row">
                        <span class="label">æœ€åæ›´æ–°:</span>
                        <span class="value" id="deviceLastUpdate">2025-07-18 16:30:25</span>
                    </div>
                    <div class="info-row">
                        <span class="label">æ•°æ®å®Œæ•´æ€§:</span>
                        <span class="value" id="deviceDataIntegrity">98.5%</span>
                    </div>
                </div>
                <div class="device-charts">
                    <div class="chart-container">
                        <h4>24å°æ—¶æ•°æ®è¶‹åŠ¿</h4>
                        <div class="chart-placeholder">
                            <canvas id="deviceChart" width="300" height="150"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="controlDevice()">è®¾å¤‡æ§åˆ¶</button>
                <button class="btn btn-secondary" onclick="exportData()">å¯¼å‡ºæ•°æ®</button>
            </div>
        </div>
    </div>

    <!-- æ–°çš„è®¾å¤‡è¯¦æƒ…å¼¹çª— -->
    <div id="deviceDetailModal" class="modal">
        <div class="modal-content device-modal-content">
            <div class="modal-header">
                <h3 id="deviceModalTitle">è®¾å¤‡è¯¦æƒ…</h3>
                <span class="close" data-modal="deviceDetailModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="device-details">
                    <div class="device-status-badge" id="deviceStatusBadge">åœ¨çº¿</div>
                    <div class="device-title" id="deviceModalName">è®¾å¤‡åç§°</div>
                    <div class="device-description" id="deviceModalDescription">
                        è®¾å¤‡è¿è¡Œæ­£å¸¸ï¼Œå„é¡¹æŒ‡æ ‡æ­£å¸¸ï¼Œæ•°æ®ä¼ è¾“ç¨³å®šã€‚
                    </div>
                    <div class="device-info-grid" id="deviceInfoGrid">
                        <!-- è®¾å¤‡åŸºæœ¬ä¿¡æ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div class="device-content-section" id="deviceModalContent">
                        <!-- è®¾å¤‡ç‰¹å®šå†…å®¹å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="deviceControl()">è®¾å¤‡æ§åˆ¶</button>
                <button class="btn btn-warning" onclick="deviceMaintenance()">ç»´æŠ¤æ¨¡å¼</button>
                <button class="btn btn-secondary" onclick="exportDeviceData()">å¯¼å‡ºæ•°æ®</button>
            </div>
        </div>
    </div>

    <!-- é¢„è­¦è¯¦æƒ…å¼¹çª— -->
    <div id="warningModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>é¢„è­¦è¯¦æƒ…</h3>
                <span class="close" data-modal="warningModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="warning-details">
                    <div class="warning-level-badge" id="warningLevelBadge">çº¢è‰²é¢„è­¦</div>
                    <div class="warning-title" id="warningTitle">XXæ‘æ»‘å¡é£é™©æé«˜</div>
                    <div class="warning-description" id="warningDescription">
                        æ ¹æ®æœ€æ–°ç›‘æµ‹æ•°æ®æ˜¾ç¤ºï¼Œè¯¥åŒºåŸŸåœŸå£¤å«æ°´é‡æ€¥å‰§ä¸Šå‡ï¼Œåœ°è¡¨ä½ç§»åŠ é€Ÿï¼Œå­˜åœ¨æé«˜çš„æ»‘å¡é£é™©ã€‚å»ºè®®ç«‹å³ç»„ç»‡äººå‘˜æ’¤ç¦»ï¼Œå¹¶è®¾ç½®è­¦æˆ’åŒºåŸŸã€‚
                    </div>
                    <div class="warning-info-grid">
                        <div class="info-item">
                            <span class="label">é¢„è­¦ç­‰çº§:</span>
                            <span class="value red" id="warningLevel">çº¢è‰²é¢„è­¦</span>
                        </div>
                        <div class="info-item">
                            <span class="label">å‘å¸ƒæ—¶é—´:</span>
                            <span class="value" id="warningTime">2025-07-18 14:25:30</span>
                        </div>
                        <div class="info-item">
                            <span class="label">å½±å“èŒƒå›´:</span>
                            <span class="value" id="warningArea">åŠå¾„2å…¬é‡Œ</span>
                        </div>
                        <div class="info-item">
                            <span class="label">é£é™©ç±»å‹:</span>
                            <span class="value" id="warningType">æ»‘å¡</span>
                        </div>
                        <div class="info-item">
                            <span class="label">é¢„è®¡æŒç»­:</span>
                            <span class="value" id="warningDuration">24-48å°æ—¶</span>
                        </div>
                        <div class="info-item">
                            <span class="label">è´£ä»»äºº:</span>
                            <span class="value" id="warningResponsible">å¼ ä¸‰</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" onclick="emergencyResponse()">å¯åŠ¨åº”æ€¥å“åº”</button>
                <button class="btn btn-warning" onclick="sendNotification()">å‘é€é€šçŸ¥</button>
                <button class="btn btn-secondary" onclick="updateWarning()">æ›´æ–°çŠ¶æ€</button>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ ç›‘æµ‹ç‚¹å¼¹çª— -->
    <div id="addPointModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>æ·»åŠ ç›‘æµ‹ç‚¹</h3>
                <span class="close" data-modal="addPointModal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addPointForm">
                    <div class="form-group">
                        <label for="pointName">ç›‘æµ‹ç‚¹åç§°:</label>
                        <input type="text" id="pointName" name="pointName" placeholder="è¯·è¾“å…¥ç›‘æµ‹ç‚¹åç§°" required>
                    </div>
                    <div class="form-group">
                        <label for="pointType">ç›‘æµ‹ç±»å‹:</label>
                        <select id="pointType" name="pointType" required>
                            <option value="">è¯·é€‰æ‹©ç›‘æµ‹ç±»å‹</option>
                            <option value="landslide">æ»‘å¡ç›‘æµ‹</option>
                            <option value="debris">æ³¥çŸ³æµç›‘æµ‹</option>
                            <option value="collapse">å´©å¡Œç›‘æµ‹</option>
                            <option value="subsidence">åœ°é¢æ²‰é™ç›‘æµ‹</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="pointLongitude">ç»åº¦:</label>
                        <input type="number" id="pointLongitude" name="pointLongitude" step="0.000001" placeholder="104.066800" required>
                    </div>
                    <div class="form-group">
                        <label for="pointLatitude">çº¬åº¦:</label>
                        <input type="number" id="pointLatitude" name="pointLatitude" step="0.000001" placeholder="30.572800" required>
                    </div>
                    <div class="form-group">
                        <label for="pointElevation">æµ·æ‹”é«˜åº¦(ç±³):</label>
                        <input type="number" id="pointElevation" name="pointElevation" placeholder="500">
                    </div>
                    <div class="form-group">
                        <label for="pointDescription">æè¿°ä¿¡æ¯:</label>
                        <textarea id="pointDescription" name="pointDescription" rows="3" placeholder="è¯·è¾“å…¥ç›‘æµ‹ç‚¹çš„è¯¦ç»†æè¿°ä¿¡æ¯"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveMonitoringPoint()">ä¿å­˜</button>
                <button class="btn btn-secondary" onclick="closeModal('addPointModal')">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- ç³»ç»Ÿè®¾ç½®å¼¹çª— -->
    <div id="settingsModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>ç³»ç»Ÿè®¾ç½®</h3>
                <span class="close" data-modal="settingsModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="settings-tabs">
                    <div class="tab-nav">
                        <button class="tab-btn active" onclick="switchTab('general')">å¸¸è§„è®¾ç½®</button>
                        <button class="tab-btn" onclick="switchTab('alert')">é¢„è­¦è®¾ç½®</button>
                        <button class="tab-btn" onclick="switchTab('display')">æ˜¾ç¤ºè®¾ç½®</button>
                        <button class="tab-btn" onclick="switchTab('user')">ç”¨æˆ·ç®¡ç†</button>
                    </div>
                    <div class="tab-content">
                        <div id="general" class="tab-pane active">
                            <div class="form-group">
                                <label>æ•°æ®æ›´æ–°é¢‘ç‡:</label>
                                <select id="updateFrequency">
                                    <option value="5">5ç§’</option>
                                    <option value="10" selected>10ç§’</option>
                                    <option value="30">30ç§’</option>
                                    <option value="60">1åˆ†é’Ÿ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>æ•°æ®ä¿å­˜å¤©æ•°:</label>
                                <input type="number" id="dataRetention" value="30" min="1" max="365">
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="autoBackup" checked>
                                    å¯ç”¨è‡ªåŠ¨å¤‡ä»½
                                </label>
                            </div>
                        </div>
                        <div id="alert" class="tab-pane">
                            <div class="form-group">
                                <label>é¢„è­¦é˜ˆå€¼è®¾ç½®:</label>
                                <div class="threshold-settings">
                                    <div class="threshold-item">
                                        <span>é»„è‰²é¢„è­¦:</span>
                                        <input type="number" value="60" min="0" max="100">%
                                    </div>
                                    <div class="threshold-item">
                                        <span>æ©™è‰²é¢„è­¦:</span>
                                        <input type="number" value="80" min="0" max="100">%
                                    </div>
                                    <div class="threshold-item">
                                        <span>çº¢è‰²é¢„è­¦:</span>
                                        <input type="number" value="95" min="0" max="100">%
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="display" class="tab-pane">
                            <div class="form-group">
                                <label>åœ°å›¾ä¸»é¢˜:</label>
                                <select id="mapTheme">
                                    <option value="dark" selected>æ·±è‰²ä¸»é¢˜</option>
                                    <option value="light">æµ…è‰²ä¸»é¢˜</option>
                                    <option value="satellite">å«æ˜Ÿå›¾åƒ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="showTerrain" checked>
                                    æ˜¾ç¤ºåœ°å½¢
                                </label>
                            </div>
                        </div>
                        <div id="user" class="tab-pane">
                            <div class="user-list">
                                <div class="user-item">
                                    <span>ç®¡ç†å‘˜</span>
                                    <span class="user-role">è¶…çº§ç®¡ç†å‘˜</span>
                                    <button class="btn btn-small">ç¼–è¾‘</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveSettings()">ä¿å­˜è®¾ç½®</button>
                <button class="btn btn-secondary" onclick="closeModal('settingsModal')">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥å¼¹çª— -->
    <div id="notificationToast" class="toast">
        <div class="toast-content">
            <div class="toast-icon">
                <span id="toastIcon">âœ“</span>
            </div>
            <div class="toast-message">
                <div class="toast-title" id="toastTitle">æ“ä½œæˆåŠŸ</div>
                <div class="toast-text" id="toastText">æ“ä½œå·²æˆåŠŸå®Œæˆ</div>
            </div>
            <button class="toast-close" onclick="hideToast()">&times;</button>
        </div>
    </div>

    <!-- å…¨å±€Tooltipå®¹å™¨ -->
    <div id="globalTooltip" class="global-tooltip"></div>

    <!-- æ°”è±¡æ•°æ®æ—¶é—´æ’­æ”¾æ§åˆ¶é¢æ¿ -->
    <div id="weatherTimeControl" class="weather-time-control" style="display: none; position: fixed !important; bottom: 70px !important; left: 50% !important; transform: translateX(-50%) !important; z-index: 1500 !important;">
        <div class="time-control-header">
            <span id="weatherDataType">æ¸©åº¦çƒ­åŠ›å›¾</span>
        </div>
        <div class="time-control-content">
            <div class="time-display">
                <span id="currentTime">2025-07-24 12:00</span>
            </div>
            <div class="time-slider-container">
                <input type="range" id="timeSlider" min="0" max="23" value="12" step="1">
                <div class="time-labels">
                    <span>00:00</span>
                    <span>06:00</span>
                    <span>12:00</span>
                    <span>18:00</span>
                    <span>24:00</span>
                </div>
            </div>
            <div class="playback-controls">
                <button id="playBtn" class="control-btn">â–¶ï¸</button>
                <button id="pauseBtn" class="control-btn" style="display: none;">â¸ï¸</button>
                <button id="resetBtn" class="control-btn">â®ï¸</button>
                <button class="close-btn" id="closeWeatherControl">Ã—</button>
            </div>
        </div>
    </div>

    <!-- æ°”è±¡æ•°æ®æ˜¾ç¤ºé¢æ¿ -->
    <div id="weatherDataPanel" class="weather-data-panel" style="display: none;">
        <div class="data-panel-header">
            <span>æ°”è±¡æ•°æ®</span>
        </div>
        <div class="data-panel-content">
            <div class="data-item">
                <span class="data-label">ä½ç½®:</span>
                <span id="dataLocation">--</span>
            </div>
            <div class="data-item">
                <span class="data-label">æ¸©åº¦:</span>
                <span id="dataTemperature">--</span>
            </div>
            <div class="data-item">
                <span class="data-label">é™é›¨é‡:</span>
                <span id="dataRainfall">--</span>
            </div>
            <div class="data-item">
                <span class="data-label">é£é€Ÿ:</span>
                <span id="dataWindSpeed">--</span>
            </div>
            <div class="data-item">
                <span class="data-label">æ—¶é—´:</span>
                <span id="dataTime">--</span>
            </div>
        </div>
    </div>

    <script src="js/geological-disaster-dashboard.js"></script>

    <script>
        // å¤©æ°”ä¿¡æ¯æ›´æ–°
        function updateWeatherInfo() {
            const weatherData = [
                { icon: 'â˜€ï¸', temp: '23Â°C', desc: 'æ™´' },
                { icon: 'â›…', temp: '21Â°C', desc: 'å¤šäº‘' },
                { icon: 'ğŸŒ§ï¸', temp: '18Â°C', desc: 'å°é›¨' },
                { icon: 'ğŸŒ¦ï¸', temp: '19Â°C', desc: 'é˜µé›¨' },
                { icon: 'â˜ï¸', temp: '20Â°C', desc: 'é˜´' },
                { icon: 'ğŸŒ¤ï¸', temp: '22Â°C', desc: 'æ™´è½¬å¤šäº‘' }
            ];

            const randomWeather = weatherData[Math.floor(Math.random() * weatherData.length)];

            const weatherIcon = document.querySelector('.weather-icon');
            const weatherTemp = document.querySelector('.weather-temp');
            const weatherDesc = document.querySelector('.weather-desc');

            if (weatherIcon && weatherTemp && weatherDesc) {
                weatherIcon.textContent = randomWeather.icon;
                weatherTemp.textContent = randomWeather.temp;
                weatherDesc.textContent = randomWeather.desc;
            }
        }

        // æ°”è±¡çƒ­åŠ›å›¾ç®¡ç†
        const WeatherHeatmap = {
            currentType: null,
            isPlaying: false,
            currentHour: 12,
            playInterval: null,
            heatmapLayer: null,

            // åˆå§‹åŒ–
            init() {
                this.currentHour = 12;
                this.isPlaying = false;
                this.playInterval = null;
                this.currentType = null;
                this.heatmapLayer = null;
                this.groundPrimitives = []; // å­˜å‚¨GroundPrimitiveå¼•ç”¨
                this.useGroundPrimitive = true; // ä½¿ç”¨GroundPrimitiveå®ç°å®Œå…¨åœ°å½¢è´´åˆ
                this.bindEvents();
                console.log('æ°”è±¡æ•°æ®æ§åˆ¶å™¨åˆå§‹åŒ–å®Œæˆ - å¯ç”¨GroundPrimitiveåœ°å½¢è´´åˆ');
            },

            // ç»‘å®šäº‹ä»¶
            bindEvents() {
                // çƒ­åŠ›å›¾æŒ‰é’®äº‹ä»¶
                document.getElementById('temperatureBtn').addEventListener('click', () => {
                    console.log('ğŸŒ¡ï¸ ç‚¹å‡»æ¸©åº¦çƒ­åŠ›å›¾æŒ‰é’®');
                    this.showHeatmap('temperature', 'æ¸©åº¦çƒ­åŠ›å›¾');
                });

                document.getElementById('rainfallBtn').addEventListener('click', () => {
                    console.log('ğŸŒ§ï¸ ç‚¹å‡»é™é›¨çƒ­åŠ›å›¾æŒ‰é’®');
                    this.showHeatmap('rainfall', 'é™é›¨çƒ­åŠ›å›¾');
                });

                document.getElementById('windBtn').addEventListener('click', () => {
                    console.log('ğŸ’¨ ç‚¹å‡»é£é€Ÿçƒ­åŠ›å›¾æŒ‰é’®');
                    this.showHeatmap('wind', 'é£é€Ÿçƒ­åŠ›å›¾');
                });

                // æ—¶é—´æ§åˆ¶äº‹ä»¶
                document.getElementById('closeWeatherControl').addEventListener('click', () => {
                    this.hideHeatmap();
                });

                document.getElementById('timeSlider').addEventListener('input', (e) => {
                    this.currentHour = parseInt(e.target.value);
                    this.updateTimeDisplay();
                    this.updateHeatmap();
                    // æ›´æ–°æ»‘å—è¿›åº¦æ¡æ•ˆæœ
                    const progress = (this.currentHour / 23) * 100;
                    e.target.style.setProperty('--progress', progress + '%');
                });

                document.getElementById('playBtn').addEventListener('click', () => {
                    this.startPlay();
                    document.getElementById('playBtn').classList.add('playing');
                });

                document.getElementById('pauseBtn').addEventListener('click', () => {
                    this.pausePlay();
                    document.getElementById('playBtn').classList.remove('playing');
                });

                document.getElementById('resetBtn').addEventListener('click', () => {
                    this.resetTime();
                    document.getElementById('playBtn').classList.remove('playing');
                });
            },

            // æ˜¾ç¤ºçƒ­åŠ›å›¾
            showHeatmap(type, title) {
                console.log(`ğŸ”„ å¼€å§‹åˆ‡æ¢çƒ­åŠ›å›¾: ${type} (${title})`);

                // å¦‚æœç‚¹å‡»çš„æ˜¯å½“å‰æ¿€æ´»çš„æŒ‰é’®ï¼Œåˆ™å…³é—­çƒ­åŠ›å›¾
                if (this.currentType === type) {
                    console.log('âŒ ç‚¹å‡»ç›¸åŒæŒ‰é’®ï¼Œå…³é—­çƒ­åŠ›å›¾');
                    this.hideHeatmap();
                    return;
                }

                // æ­¥éª¤1ï¼šå…³é—­ä¹‹å‰çš„çƒ­åŠ›å›¾ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                if (this.currentType !== null) {
                    console.log(`ğŸ§¹ å…³é—­ä¹‹å‰çš„çƒ­åŠ›å›¾: ${this.currentType}`);
                    this.clearCurrentHeatmap();
                }

                // æ­¥éª¤2ï¼šæ¸…é™¤çŠ¶æ€
                console.log('ğŸ”„ æ¸…é™¤æ‰€æœ‰çŠ¶æ€');
                this.clearAllStates();

                // æ­¥éª¤3ï¼šæ‰“å¼€æ–°çš„çƒ­åŠ›å›¾
                console.log(`âœ… æ‰“å¼€æ–°çš„çƒ­åŠ›å›¾: ${type}`);
                this.currentType = type;
                document.getElementById('weatherDataType').textContent = title;
                const weatherControl = document.getElementById('weatherTimeControl');
                weatherControl.style.display = 'block';
                setTimeout(() => weatherControl.classList.add('show'), 10);
                document.getElementById('weatherDataPanel').style.display = 'block';

                // æ¿€æ´»å½“å‰é€‰ä¸­çš„æŒ‰é’®
                document.getElementById(type + 'Btn').classList.add('active');

                this.updateTimeDisplay();
                this.updateHeatmap();
                this.bindMapEvents();

                console.log(`ğŸ¯ çƒ­åŠ›å›¾åˆ‡æ¢å®Œæˆ: ${type}`);
            },

            // æ¸…é™¤å½“å‰çƒ­åŠ›å›¾
            clearCurrentHeatmap() {
                // æ¸…é™¤åœ°å›¾ä¸Šçš„çƒ­åŠ›å›¾å®ä½“
                if (this.heatmapLayer && viewer) {
                    viewer.entities.removeAll();
                }

                // æ¸…é™¤GroundPrimitiveçƒ­åŠ›å›¾
                if (this.groundPrimitives && viewer) {
                    this.groundPrimitives.forEach(primitive => {
                        viewer.scene.groundPrimitives.remove(primitive);
                    });
                    this.groundPrimitives = [];
                }

                // è§£ç»‘åœ°å›¾äº‹ä»¶
                this.unbindMapEvents();

                // æš‚åœæ’­æ”¾
                this.pausePlay();

                console.log('å·²æ¸…é™¤å½“å‰çƒ­åŠ›å›¾ï¼ˆåŒ…æ‹¬GroundPrimitiveï¼‰');
            },

            // æ¸…é™¤æ‰€æœ‰çŠ¶æ€
            clearAllStates() {
                // ç§»é™¤æ‰€æœ‰æ°”è±¡æŒ‰é’®çš„æ¿€æ´»çŠ¶æ€
                document.querySelectorAll('.weather-btn').forEach(btn => btn.classList.remove('active'));

                // é‡ç½®å½“å‰ç±»å‹
                this.currentType = null;

                // é‡ç½®æ’­æ”¾çŠ¶æ€
                this.isPlaying = false;

                // é‡ç½®æ—¶é—´åˆ°é»˜è®¤å€¼
                this.currentHour = 12;

                // æ¸…é™¤æ’­æ”¾é—´éš”
                if (this.playInterval) {
                    clearInterval(this.playInterval);
                    this.playInterval = null;
                }

                // é‡ç½®æ’­æ”¾æŒ‰é’®çŠ¶æ€
                document.getElementById('playBtn').style.display = 'inline-block';
                document.getElementById('pauseBtn').style.display = 'none';
                document.getElementById('playBtn').classList.remove('playing');

                console.log('å·²æ¸…é™¤æ‰€æœ‰çŠ¶æ€');
            },

            // éšè—çƒ­åŠ›å›¾
            hideHeatmap() {
                // ä½¿ç”¨ç»Ÿä¸€çš„æ¸…ç†é€»è¾‘
                this.clearCurrentHeatmap();
                this.clearAllStates();

                // éšè—æ§åˆ¶é¢æ¿
                const weatherControl = document.getElementById('weatherTimeControl');
                weatherControl.classList.remove('show');
                setTimeout(() => weatherControl.style.display = 'none', 400);
                document.getElementById('weatherDataPanel').style.display = 'none';

                console.log('å·²éšè—çƒ­åŠ›å›¾');
            },

            // æ›´æ–°æ—¶é—´æ˜¾ç¤º
            updateTimeDisplay() {
                const timeStr = `2025-07-24 ${this.currentHour.toString().padStart(2, '0')}:00`;
                document.getElementById('currentTime').textContent = timeStr;
                document.getElementById('timeSlider').value = this.currentHour;
            },

            // æ›´æ–°çƒ­åŠ›å›¾
            updateHeatmap() {
                if (!this.currentType || !viewer) return;

                // æ¸…é™¤ç°æœ‰çƒ­åŠ›å›¾
                if (this.heatmapLayer) {
                    viewer.entities.removeAll();
                }

                // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®å¹¶åˆ›å»ºçƒ­åŠ›å›¾
                this.generateHeatmapData();
            },

            // ç”Ÿæˆç½‘æ ¼åŒ–çƒ­åŠ›å›¾æ•°æ®
            generateHeatmapData() {
                console.log(`ğŸŒ¡ï¸ ç”Ÿæˆ${this.currentType}ç½‘æ ¼çƒ­åŠ›å›¾æ•°æ®`);
                const centerLon = 104.0668;
                const centerLat = 30.5728;
                const gridSize = 0.005; // ç½‘æ ¼å¤§å°ï¼ˆåº¦ï¼‰- ä¿æŒç»†è‡´çš„ç½‘æ ¼
                const gridCount = 200; // ç½‘æ ¼æ•°é‡ - è¿›ä¸€æ­¥æ‰©å¤§èŒƒå›´

                // åˆ›å»ºç½‘æ ¼æ•°æ®
                const gridData = [];
                for (let i = 0; i < gridCount; i++) {
                    gridData[i] = [];
                    for (let j = 0; j < gridCount; j++) {
                        const lon = centerLon + (i - gridCount/2) * gridSize;
                        const lat = centerLat + (j - gridCount/2) * gridSize;

                        // æ ¹æ®æ—¶é—´å’Œä½ç½®ç”Ÿæˆæ•°æ®å€¼
                        const timeEffect = Math.sin(this.currentHour * Math.PI / 12);
                        const distanceFromCenter = Math.sqrt((i - gridCount/2)**2 + (j - gridCount/2)**2);
                        // è°ƒæ•´è·ç¦»æ•ˆåº”ï¼Œé€‚åº”æ›´å¤§èŒƒå›´
                        const distanceEffect = Math.exp(-distanceFromCenter / 35);

                        // æ·»åŠ å¤šä¸ªçƒ­ç‚¹ä¸­å¿ƒï¼Œåˆ›å»ºæ›´å¤æ‚çš„åˆ†å¸ƒï¼Œé€‚åº”æ›´å¤§èŒƒå›´
                        const hotspot1 = Math.exp(-((i - gridCount*0.25)**2 + (j - gridCount*0.25)**2) / 200);
                        const hotspot2 = Math.exp(-((i - gridCount*0.75)**2 + (j - gridCount*0.75)**2) / 250);
                        const hotspot3 = Math.exp(-((i - gridCount*0.5)**2 + (j - gridCount*0.15)**2) / 150);
                        const hotspot4 = Math.exp(-((i - gridCount*0.15)**2 + (j - gridCount*0.8)**2) / 180);
                        const hotspot5 = Math.exp(-((i - gridCount*0.85)**2 + (j - gridCount*0.4)**2) / 220);
                        const combinedEffect = distanceEffect + 0.4 * (hotspot1 + hotspot2 + hotspot3 + hotspot4 + hotspot5);

                        let value;
                        if (this.currentType === 'temperature') {
                            value = 20 + 15 * timeEffect * combinedEffect + Math.random() * 5;
                        } else if (this.currentType === 'rainfall') {
                            value = Math.max(0, 10 * timeEffect * combinedEffect + Math.random() * 5);
                        } else if (this.currentType === 'wind') {
                            value = Math.max(0, 8 * timeEffect * combinedEffect + Math.random() * 3);
                        }

                        gridData[i][j] = {
                            lon: lon,
                            lat: lat,
                            value: value
                        };
                    }
                }

                // åˆ›å»ºç½‘æ ¼çƒ­åŠ›å›¾
                this.createGridHeatmap(gridData, gridSize);
                console.log(`âœ… é«˜å¯†åº¦è´´åˆåœ°å½¢çƒ­åŠ›å›¾ç”Ÿæˆå®Œæˆ: ${gridCount}x${gridCount} = ${gridCount*gridCount}ä¸ªç½‘æ ¼ï¼Œè¦†ç›–èŒƒå›´: ${(gridCount*gridSize).toFixed(2)}Â°x${(gridCount*gridSize).toFixed(2)}Â°`);
            },

            // åˆ›å»ºç½‘æ ¼çƒ­åŠ›å›¾
            createGridHeatmap(gridData, gridSize) {
                const gridCount = gridData.length;
                const totalGrids = gridCount * gridCount;
                const coverageArea = (gridCount * gridSize).toFixed(2);
                console.log(`ğŸ¨ å¼€å§‹åˆ›å»ºé«˜å¯†åº¦è´´åˆåœ°å½¢çƒ­åŠ›å›¾: ${gridCount}x${gridCount}=${totalGrids}ä¸ªç½‘æ ¼ï¼Œè¦†ç›–${coverageArea}Â°x${coverageArea}Â°åŒºåŸŸ`);

                // å°è¯•ä½¿ç”¨GroundPrimitiveå®ç°æ›´å¥½çš„åœ°å½¢è´´åˆ
                if (this.useGroundPrimitive) {
                    this.createGroundPrimitiveHeatmap(gridData, gridSize);
                } else {
                    // ä½¿ç”¨å¤šè¾¹å½¢å®ä½“æ–¹æ³•
                    for (let i = 0; i < gridCount; i++) {
                        for (let j = 0; j < gridCount; j++) {
                            const data = gridData[i][j];
                            const color = this.getColorForValue(data.value);
                            this.createTerrainClampedPolygon(data, gridSize, color);
                        }
                    }
                }
            },

            // ä½¿ç”¨GroundPrimitiveåˆ›å»ºå®Œå…¨è´´åˆåœ°å½¢çš„çƒ­åŠ›å›¾ï¼ˆåƒå¸ƒä¸€æ ·ï¼‰
            createGroundPrimitiveHeatmap(gridData, gridSize) {
                const gridCount = gridData.length;
                const instances = [];

                for (let i = 0; i < gridCount; i++) {
                    for (let j = 0; j < gridCount; j++) {
                        const data = gridData[i][j];
                        const color = this.getColorForValue(data.value);

                        // åˆ›å»ºçŸ©å½¢å‡ ä½•ä½“
                        const rectangleGeometry = new Cesium.RectangleGeometry({
                            rectangle: Cesium.Rectangle.fromDegrees(
                                data.lon - gridSize/2,
                                data.lat - gridSize/2,
                                data.lon + gridSize/2,
                                data.lat + gridSize/2
                            ),
                            granularity: Cesium.Math.RADIANS_PER_DEGREE / 128 // è¶…é«˜ç²¾åº¦è´´åˆï¼Œé€‚åº”ç»†ç½‘æ ¼
                        });

                        // åˆ›å»ºå‡ ä½•ä½“å®ä¾‹
                        instances.push(new Cesium.GeometryInstance({
                            geometry: rectangleGeometry,
                            attributes: {
                                color: Cesium.ColorGeometryInstanceAttribute.fromColor(
                                    color.withAlpha(0.5)
                                )
                            },
                            id: `heatmap_${i}_${j}_${this.currentType}_${this.currentHour}`
                        }));
                    }
                }

                // åˆ›å»ºGroundPrimitive - è¿™æ˜¯æœ€ä½³çš„åœ°å½¢è´´åˆæ–¹æ¡ˆ
                const groundPrimitive = new Cesium.GroundPrimitive({
                    geometryInstances: instances,
                    appearance: new Cesium.PerInstanceColorAppearance({
                        translucent: true,
                        closed: false
                    }),
                    // å…³é”®ï¼šå®Œå…¨è´´åˆåœ°å½¢
                    classificationType: Cesium.ClassificationType.TERRAIN,
                    // å¼‚æ­¥åŠ è½½ä»¥æé«˜æ€§èƒ½
                    asynchronous: true
                });

                // æ·»åŠ åˆ°åœºæ™¯
                viewer.scene.groundPrimitives.add(groundPrimitive);

                // ä¿å­˜å¼•ç”¨ä»¥ä¾¿åç»­æ¸…ç†
                if (!this.groundPrimitives) {
                    this.groundPrimitives = [];
                }
                this.groundPrimitives.push(groundPrimitive);

                console.log(`âœ… é«˜å¯†åº¦GroundPrimitiveçƒ­åŠ›å›¾åˆ›å»ºå®Œæˆï¼Œ${instances.length}ä¸ªç½‘æ ¼å®Œå…¨è´´åˆåœ°å½¢`);
            },

            // åˆ›å»ºè´´åˆåœ°å½¢çš„å¤šè¾¹å½¢
            createTerrainClampedPolygon(data, gridSize, color) {
                // åˆ›å»ºç½‘æ ¼å››ä¸ªè§’çš„åæ ‡
                const positions = [
                    Cesium.Cartesian3.fromDegrees(data.lon - gridSize/2, data.lat - gridSize/2),
                    Cesium.Cartesian3.fromDegrees(data.lon + gridSize/2, data.lat - gridSize/2),
                    Cesium.Cartesian3.fromDegrees(data.lon + gridSize/2, data.lat + gridSize/2),
                    Cesium.Cartesian3.fromDegrees(data.lon - gridSize/2, data.lat + gridSize/2)
                ];

                try {
                    // åˆ›å»ºå®Œå…¨è´´åˆåœ°å½¢çš„å¤šè¾¹å½¢ï¼ˆåƒå¸ƒä¸€æ ·ï¼‰
                    viewer.entities.add({
                        polygon: {
                            hierarchy: positions,
                            material: color.withAlpha(0.5),
                            // å…³é”®ï¼šå®Œå…¨è´´åˆåœ°å½¢ï¼Œåƒå¸ƒä¸€æ ·éšåœ°å½¢èµ·ä¼
                            heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,
                            // ä¸è®¾ç½®extrudedHeightï¼Œè®©å®ƒå®Œå…¨è´´åˆåœ°å½¢è¡¨é¢
                            outline: false,
                            // åªè´´åˆåœ°å½¢ï¼Œä¸è´´åˆ3Dç“¦ç‰‡
                            classificationType: Cesium.ClassificationType.TERRAIN,
                            // ç¦ç”¨é˜´å½±ä»¥è·å¾—æ›´å¥½çš„è´´åˆæ•ˆæœ
                            shadows: Cesium.ShadowMode.DISABLED,
                            fill: true,
                            // è®¾ç½®ä¸ºåœ°é¢çº§åˆ«
                            zIndex: 1,
                            // ç¡®ä¿å®Œå…¨è´´åˆåœ°å½¢
                            perPositionHeight: false
                        },
                        properties: {
                            type: 'heatmap',
                            dataType: this.currentType,
                            value: data.value,
                            lon: data.lon,
                            lat: data.lat,
                            time: this.currentHour
                        }
                    });
                } catch (error) {
                    console.warn('å¤šè¾¹å½¢åˆ›å»ºå¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ:', error);
                    // å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨çŸ©å½¢
                    this.createFallbackRectangle(data, gridSize, color);
                }
            },

            // å¤‡ç”¨æ–¹æ¡ˆï¼šåˆ›å»ºçŸ©å½¢ï¼ˆå¦‚æœå¤šè¾¹å½¢å¤±è´¥ï¼‰
            createFallbackRectangle(data, gridSize, color) {
                viewer.entities.add({
                    rectangle: {
                        coordinates: Cesium.Rectangle.fromDegrees(
                            data.lon - gridSize/2,
                            data.lat - gridSize/2,
                            data.lon + gridSize/2,
                            data.lat + gridSize/2
                        ),
                        material: color.withAlpha(0.5),
                        heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,
                        extrudedHeight: 1,
                        outline: false
                    },
                    properties: {
                        type: 'heatmap',
                        dataType: this.currentType,
                        value: data.value,
                        lon: data.lon,
                        lat: data.lat,
                        time: this.currentHour
                    }
                });
            },

            // æ ¹æ®æ•°å€¼å’Œç±»å‹è·å–é¢œè‰²
            getColorForValue(value) {
                if (this.currentType === 'temperature') {
                    return this.getTemperatureColor(value);
                } else if (this.currentType === 'rainfall') {
                    return this.getRainfallColor(value);
                } else if (this.currentType === 'wind') {
                    return this.getWindColor(value);
                }
                return Cesium.Color.WHITE;
            },

            // è·å–æ¸©åº¦é¢œè‰² (æ°”è±¡æ ‡å‡†: è“è‰²->é’è‰²->ç»¿è‰²->é»„è‰²->æ©™è‰²->çº¢è‰²)
            getTemperatureColor(temp) {
                // æ¸©åº¦èŒƒå›´: -10 åˆ° 40Â°C
                const normalizedTemp = Math.max(-10, Math.min(40, temp));
                const tempRange = (normalizedTemp + 10) / 50; // å½’ä¸€åŒ–åˆ°0-1

                if (tempRange < 0.2) {
                    // æ·±è“åˆ°è“è‰² (-10 åˆ° 0Â°C)
                    const factor = tempRange / 0.2;
                    return Cesium.Color.fromBytes(
                        Math.floor(0 + factor * 30),
                        Math.floor(0 + factor * 100),
                        Math.floor(139 + factor * 116),
                        255
                    );
                } else if (tempRange < 0.4) {
                    // è“è‰²åˆ°é’è‰² (0 åˆ° 10Â°C)
                    const factor = (tempRange - 0.2) / 0.2;
                    return Cesium.Color.fromBytes(
                        Math.floor(30 + factor * 70),
                        Math.floor(100 + factor * 155),
                        Math.floor(255),
                        255
                    );
                } else if (tempRange < 0.6) {
                    // é’è‰²åˆ°ç»¿è‰² (10 åˆ° 20Â°C)
                    const factor = (tempRange - 0.4) / 0.2;
                    return Cesium.Color.fromBytes(
                        Math.floor(100 - factor * 100),
                        Math.floor(255),
                        Math.floor(255 - factor * 155),
                        255
                    );
                } else if (tempRange < 0.8) {
                    // ç»¿è‰²åˆ°é»„è‰² (20 åˆ° 30Â°C)
                    const factor = (tempRange - 0.6) / 0.2;
                    return Cesium.Color.fromBytes(
                        Math.floor(0 + factor * 255),
                        Math.floor(255),
                        Math.floor(100 - factor * 100),
                        255
                    );
                } else if (tempRange < 0.9) {
                    // é»„è‰²åˆ°æ©™è‰² (30 åˆ° 35Â°C)
                    const factor = (tempRange - 0.8) / 0.1;
                    return Cesium.Color.fromBytes(
                        Math.floor(255),
                        Math.floor(255 - factor * 90),
                        Math.floor(0),
                        255
                    );
                } else {
                    // æ©™è‰²åˆ°çº¢è‰² (35 åˆ° 40Â°C)
                    const factor = (tempRange - 0.9) / 0.1;
                    return Cesium.Color.fromBytes(
                        Math.floor(255),
                        Math.floor(165 - factor * 165),
                        Math.floor(0),
                        255
                    );
                }
            },

            // è·å–é™é›¨é¢œè‰² (æ°”è±¡æ ‡å‡†: è“è‰²->ç»¿è‰²->é»„è‰²->æ©™è‰²->çº¢è‰²)
            getRainfallColor(rainfall) {
                // é™é›¨èŒƒå›´: 0-20mm/h
                const normalizedRain = Math.max(0, Math.min(20, rainfall)) / 20;

                if (normalizedRain < 0.25) {
                    // æµ…è“åˆ°è“è‰² (0-5mm/h)
                    const factor = normalizedRain / 0.25;
                    return Cesium.Color.fromBytes(
                        Math.floor(173 - factor * 73),
                        Math.floor(216 - factor * 16),
                        Math.floor(230),
                        255
                    );
                } else if (normalizedRain < 0.5) {
                    // è“è‰²åˆ°ç»¿è‰² (5-10mm/h)
                    const factor = (normalizedRain - 0.25) / 0.25;
                    return Cesium.Color.fromBytes(
                        Math.floor(100 - factor * 100),
                        Math.floor(200 + factor * 55),
                        Math.floor(230 - factor * 130),
                        255
                    );
                } else if (normalizedRain < 0.75) {
                    // ç»¿è‰²åˆ°é»„è‰² (10-15mm/h)
                    const factor = (normalizedRain - 0.5) / 0.25;
                    return Cesium.Color.fromBytes(
                        Math.floor(0 + factor * 255),
                        Math.floor(255),
                        Math.floor(100 - factor * 100),
                        255
                    );
                } else {
                    // é»„è‰²åˆ°æ©™çº¢è‰² (15-20mm/h)
                    const factor = (normalizedRain - 0.75) / 0.25;
                    return Cesium.Color.fromBytes(
                        Math.floor(255),
                        Math.floor(255 - factor * 155),
                        Math.floor(0),
                        255
                    );
                }
            },

            // è·å–é£é€Ÿé¢œè‰² (æ°”è±¡æ ‡å‡†: ç™½è‰²->æµ…è“->è“è‰²->ç»¿è‰²->é»„è‰²->æ©™è‰²->çº¢è‰²->ç´«è‰²)
            getWindColor(wind) {
                // é£é€ŸèŒƒå›´: 0-15m/s (æŒ‰è’²ç¦é£çº§)
                const normalizedWind = Math.max(0, Math.min(15, wind)) / 15;

                if (normalizedWind < 0.15) {
                    // ç™½è‰²åˆ°æµ…è“ (0-2.25m/s å¾®é£)
                    const factor = normalizedWind / 0.15;
                    return Cesium.Color.fromBytes(
                        Math.floor(255 - factor * 80),
                        Math.floor(255 - factor * 30),
                        Math.floor(255),
                        255
                    );
                } else if (normalizedWind < 0.3) {
                    // æµ…è“åˆ°è“è‰² (2.25-4.5m/s è½»é£)
                    const factor = (normalizedWind - 0.15) / 0.15;
                    return Cesium.Color.fromBytes(
                        Math.floor(175 - factor * 75),
                        Math.floor(225 - factor * 125),
                        Math.floor(255),
                        255
                    );
                } else if (normalizedWind < 0.5) {
                    // è“è‰²åˆ°ç»¿è‰² (4.5-7.5m/s å’Œé£)
                    const factor = (normalizedWind - 0.3) / 0.2;
                    return Cesium.Color.fromBytes(
                        Math.floor(100 - factor * 100),
                        Math.floor(100 + factor * 155),
                        Math.floor(255 - factor * 155),
                        255
                    );
                } else if (normalizedWind < 0.7) {
                    // ç»¿è‰²åˆ°é»„è‰² (7.5-10.5m/s æ¸…é£)
                    const factor = (normalizedWind - 0.5) / 0.2;
                    return Cesium.Color.fromBytes(
                        Math.floor(0 + factor * 255),
                        Math.floor(255),
                        Math.floor(100 - factor * 100),
                        255
                    );
                } else if (normalizedWind < 0.85) {
                    // é»„è‰²åˆ°æ©™è‰² (10.5-12.75m/s å¼ºé£)
                    const factor = (normalizedWind - 0.7) / 0.15;
                    return Cesium.Color.fromBytes(
                        Math.floor(255),
                        Math.floor(255 - factor * 90),
                        Math.floor(0),
                        255
                    );
                } else {
                    // æ©™è‰²åˆ°çº¢ç´«è‰² (12.75-15m/s ç–¾é£)
                    const factor = (normalizedWind - 0.85) / 0.15;
                    return Cesium.Color.fromBytes(
                        Math.floor(255),
                        Math.floor(165 - factor * 65),
                        Math.floor(0 + factor * 100),
                        255
                    );
                }
            },

            // å¼€å§‹æ’­æ”¾
            startPlay() {
                this.isPlaying = true;
                document.getElementById('playBtn').style.display = 'none';
                document.getElementById('pauseBtn').style.display = 'inline-block';

                this.playInterval = setInterval(() => {
                    this.currentHour++;
                    if (this.currentHour > 23) {
                        this.currentHour = 0;
                    }
                    this.updateTimeDisplay();
                    this.updateHeatmap();
                }, 1000); // å›ºå®š1ç§’é—´éš”
            },

            // æš‚åœæ’­æ”¾
            pausePlay() {
                this.isPlaying = false;
                document.getElementById('playBtn').style.display = 'inline-block';
                document.getElementById('pauseBtn').style.display = 'none';

                if (this.playInterval) {
                    clearInterval(this.playInterval);
                    this.playInterval = null;
                }
            },

            // é‡ç½®æ—¶é—´
            resetTime() {
                this.pausePlay();
                this.currentHour = 0;
                this.updateTimeDisplay();
                this.updateHeatmap();
            },

            // ç»‘å®šåœ°å›¾äº‹ä»¶
            bindMapEvents() {
                if (!viewer) return;

                this.mapClickHandler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);
                this.mapClickHandler.setInputAction((event) => {
                    const pickedObject = viewer.scene.pick(event.position);
                    if (pickedObject && pickedObject.id && pickedObject.id.properties) {
                        const props = pickedObject.id.properties;
                        if (props.type && props.type.getValue() === 'heatmap') {
                            this.showWeatherData(props);
                        }
                    }
                }, Cesium.ScreenSpaceEventType.LEFT_CLICK);

                this.mapMoveHandler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);
                this.mapMoveHandler.setInputAction((event) => {
                    const pickedObject = viewer.scene.pick(event.endPosition);
                    if (pickedObject && pickedObject.id && pickedObject.id.properties) {
                        const props = pickedObject.id.properties;
                        if (props.type && props.type.getValue() === 'heatmap') {
                            this.showWeatherData(props);
                        }
                    }
                }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);
            },

            // è§£ç»‘åœ°å›¾äº‹ä»¶
            unbindMapEvents() {
                if (this.mapClickHandler) {
                    this.mapClickHandler.destroy();
                    this.mapClickHandler = null;
                }
                if (this.mapMoveHandler) {
                    this.mapMoveHandler.destroy();
                    this.mapMoveHandler = null;
                }
            },

            // æ˜¾ç¤ºæ°”è±¡æ•°æ®
            showWeatherData(props) {
                const lon = props.lon.getValue().toFixed(4);
                const lat = props.lat.getValue().toFixed(4);
                const value = props.value.getValue().toFixed(1);
                const dataType = props.dataType.getValue();
                const time = props.time.getValue();

                document.getElementById('dataLocation').textContent = `${lon}Â°E, ${lat}Â°N`;
                document.getElementById('dataTime').textContent = `${time.toString().padStart(2, '0')}:00`;

                // æ ¹æ®æ•°æ®ç±»å‹æ˜¾ç¤ºç›¸åº”æ•°å€¼
                if (dataType === 'temperature') {
                    document.getElementById('dataTemperature').textContent = `${value}Â°C`;
                    document.getElementById('dataRainfall').textContent = '--';
                    document.getElementById('dataWindSpeed').textContent = '--';
                } else if (dataType === 'rainfall') {
                    document.getElementById('dataTemperature').textContent = '--';
                    document.getElementById('dataRainfall').textContent = `${value}mm/h`;
                    document.getElementById('dataWindSpeed').textContent = '--';
                } else if (dataType === 'wind') {
                    document.getElementById('dataTemperature').textContent = '--';
                    document.getElementById('dataRainfall').textContent = '--';
                    document.getElementById('dataWindSpeed').textContent = `${value}m/s`;
                }
            }
        };

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateWeatherInfo();
            WeatherHeatmap.init();

            // åˆå§‹åŒ–è®¾å¤‡ç±»å‹ç­›é€‰åŠŸèƒ½
            initDeviceTypeFilter();

            // æ¯30åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡å¤©æ°”ä¿¡æ¯
            setInterval(updateWeatherInfo, 30 * 60 * 1000);
        });

        // è·å–çŠ¶æ€æ–‡æœ¬ - å…¨å±€å‡½æ•°
        function getStatusText(status) {
            const statusMap = {
                'online': 'æ­£å¸¸',
                'warning': 'é¢„è­¦',
                'offline': 'ç¦»çº¿'
            };
            return statusMap[status] || 'æœªçŸ¥';
        }

        // è·å–è®¾å¤‡ç±»å‹ä¸­æ–‡åç§° - å…¨å±€å‡½æ•°
        function getDeviceTypeName(type) {
            const typeMap = {
                'weather': 'æ°”è±¡ç«™',
                'water': 'æ°´ä½è®¡',
                'camera': 'ç›‘æ§æ‘„åƒå¤´',
                'displacement': 'ä½ç§»è®¡',
                'rainfall': 'é›¨é‡è®¡',
                'soil': 'åœŸå£¤ç›‘æµ‹ä»ª'
            };
            return typeMap[type] || 'ç›‘æµ‹è®¾å¤‡';
        }

        // è®¾å¤‡ç±»å‹ç­›é€‰åŠŸèƒ½
        function initDeviceTypeFilter() {
            const deviceTypeFilter = document.getElementById('deviceTypeFilter');

            // ç›´æ¥ä½¿ç”¨JavaScriptä¸­çš„è®¾å¤‡æ•°æ®
            function getDeviceDataFromMap() {
                console.log('ğŸ” å¼€å§‹è·å–è®¾å¤‡æ•°æ®...');

                // ä½¿ç”¨ä¸åœ°å›¾ç›¸åŒçš„è®¾å¤‡æ•°æ®æº
                const sampleDevices = [
                    // æ°”è±¡ç«™è®¾å¤‡
                    { id: 1, name: 'é”¦æ±Ÿæ°”è±¡ç«™', type: 'weather', status: 'online', location: 'é”¦æ±ŸåŒºæ˜¥ç†™è·¯' },
                    { id: 2, name: 'åŒæµæ°”è±¡ç«™', type: 'weather', status: 'warning', location: 'åŒæµæœºåœºé™„è¿‘' },
                    { id: 3, name: 'æ–°éƒ½æ°”è±¡ç«™', type: 'weather', status: 'online', location: 'æ–°éƒ½åŒºå®å…‰å¯º' },

                    // æ°´ä½è®¡è®¾å¤‡
                    { id: 4, name: 'åºœæ²³æ°´ä½è®¡', type: 'water', status: 'online', location: 'åºœæ²³å¤§æ¡¥ä¸‹æ¸¸' },
                    { id: 5, name: 'æ²±æ±Ÿæ°´ä½è®¡', type: 'water', status: 'online', location: 'æ²±æ±Ÿé‡‘å ‚æ®µ' },
                    { id: 6, name: 'å²·æ±Ÿæ°´ä½è®¡', type: 'water', status: 'warning', location: 'å²·æ±Ÿå½­å±±æ®µ' },

                    // æ‘„åƒå¤´è®¾å¤‡
                    { id: 7, name: 'é¾™æ³‰å±±æ‘„åƒå¤´', type: 'camera', status: 'warning', location: 'é¾™æ³‰å±±è„‰è§‚æµ‹ç‚¹' },
                    { id: 8, name: 'å½­å·ç›‘æ§æ‘„åƒå¤´', type: 'camera', status: 'online', location: 'å½­å·å±±åŒº' },
                    { id: 9, name: 'å¤§é‚‘ç›‘æ§æ‘„åƒå¤´', type: 'camera', status: 'online', location: 'å¤§é‚‘å¿è¥¿å²­é›ªå±±' },

                    // ä½ç§»è®¡è®¾å¤‡
                    { id: 10, name: 'é’åŸå±±ä½ç§»è®¡', type: 'displacement', status: 'online', location: 'é’åŸå±±åå±±' },
                    { id: 11, name: 'æ±¶å·ä½ç§»è®¡', type: 'displacement', status: 'online', location: 'æ±¶å·å¿æ˜ ç§€é•‡' },

                    // é›¨é‡è®¡è®¾å¤‡
                    { id: 12, name: 'éƒ½æ±Ÿå °é›¨é‡è®¡', type: 'rainfall', status: 'offline', location: 'éƒ½æ±Ÿå °æ™¯åŒº' },
                    { id: 13, name: 'å¤©åºœæ–°åŒºé›¨é‡è®¡', type: 'rainfall', status: 'online', location: 'å¤©åºœæ–°åŒºå…´éš†æ¹–' },
                    { id: 14, name: 'é‡‘å ‚é›¨é‡è®¡', type: 'rainfall', status: 'online', location: 'é‡‘å ‚å¿æ·®å£é•‡' },

                    // åœŸå£¤ç›‘æµ‹è®¾å¤‡
                    { id: 15, name: 'æ¸©æ±ŸåœŸå£¤ç›‘æµ‹ä»ª', type: 'soil', status: 'online', location: 'æ¸©æ±ŸåŒºå†œç§‘é™¢' },
                    { id: 16, name: 'é‚›å´ƒåœŸå£¤ç›‘æµ‹ä»ª', type: 'soil', status: 'online', location: 'é‚›å´ƒå±±åŒº' },
                    { id: 17, name: 'å´‡å·åœŸå£¤ç›‘æµ‹ä»ª', type: 'soil', status: 'offline', location: 'å´‡å·å¸‚åŒº' }
                ];

                console.log('è·å–åˆ°è®¾å¤‡æ•°é‡:', sampleDevices.length);
                return sampleDevices;
            }

            // æ¸²æŸ“è®¾å¤‡åˆ—è¡¨
            function renderDeviceList(devices) {
                const deviceList = document.getElementById('deviceList');
                if (!deviceList) return;

                deviceList.innerHTML = '';

                if (devices.length === 0) {
                    deviceList.innerHTML = '<div style="text-align: center; color: #99ccff; padding: 20px;">æš‚æ— è®¾å¤‡æ•°æ®</div>';
                    return;
                }

                devices.forEach(device => {
                    const deviceItem = document.createElement('div');
                    deviceItem.className = 'device-item';
                    deviceItem.style.cursor = 'pointer';
                    deviceItem.innerHTML = `
                        <div class="device-info">
                            <div class="device-name">${device.name}</div>
                            <div class="device-location">${device.location}</div>
                        </div>
                        <div class="device-status ${device.status}">
                            <div class="status-dot ${device.status}"></div>
                            <span class="status-text">${getStatusText(device.status)}</span>
                        </div>
                    `;

                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œæ ¹æ®è®¾å¤‡ç±»å‹æ‰“å¼€ä¸åŒå¼¹çª—
                    deviceItem.addEventListener('click', () => {
                        openDeviceModal(device);
                    });

                    deviceList.appendChild(deviceItem);
                });

                // æ›´æ–°ç»Ÿè®¡æ•°æ®
                updateDeviceStats(devices);
            }



            // æ›´æ–°è®¾å¤‡ç»Ÿè®¡
            function updateDeviceStats(devices) {
                const stats = devices.reduce((acc, device) => {
                    acc[device.status] = (acc[device.status] || 0) + 1;
                    return acc;
                }, {});

                document.getElementById('onlineCount').textContent = stats.online || 0;
                document.getElementById('warningCount').textContent = stats.warning || 0;
                document.getElementById('offlineCount').textContent = stats.offline || 0;
            }

            // ç­›é€‰è®¾å¤‡
            function filterDevices(type, allDevices) {
                if (type === 'all') {
                    return allDevices;
                }
                return allDevices.filter(device => device.type === type);
            }

            // è®¾å¤‡ç±»å‹ç­›é€‰äº‹ä»¶
            deviceTypeFilter.addEventListener('change', function() {
                const selectedType = this.value;
                const allDevices = getDeviceDataFromMap();
                const filteredDevices = filterDevices(selectedType, allDevices);
                renderDeviceList(filteredDevices);
            });

            // åˆå§‹åŒ–æ˜¾ç¤ºæ‰€æœ‰è®¾å¤‡ï¼ˆå»¶è¿Ÿæ‰§è¡Œï¼Œç­‰å¾…åœ°å›¾æ•°æ®åŠ è½½ï¼‰
            let initRetryCount = 0;
            const maxRetries = 10;

            function initializeDeviceList() {
                console.log(`ğŸ”„ å°è¯•åˆå§‹åŒ–è®¾å¤‡åˆ—è¡¨ (ç¬¬${initRetryCount + 1}æ¬¡)`);
                const allDevices = getDeviceDataFromMap();

                if (allDevices.length > 0) {
                    console.log('âœ… è®¾å¤‡æ•°æ®åŠ è½½æˆåŠŸï¼Œæ¸²æŸ“è®¾å¤‡åˆ—è¡¨');
                    renderDeviceList(allDevices);
                } else {
                    initRetryCount++;
                    if (initRetryCount < maxRetries) {
                        console.log(`â³ æš‚æ— è®¾å¤‡æ•°æ®ï¼Œ2000msåé‡è¯•...`);
                        setTimeout(initializeDeviceList, 2000);
                    } else {
                        console.warn('âŒ è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œè®¾å¤‡æ•°æ®åŠ è½½å¤±è´¥');
                        const deviceList = document.getElementById('deviceList');
                        if (deviceList) {
                            deviceList.innerHTML = '<div style="text-align: center; color: #ff6666; padding: 20px;">è®¾å¤‡æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</div>';
                        }
                    }
                }
            }

            // ç›´æ¥åˆå§‹åŒ–è®¾å¤‡åˆ—è¡¨ï¼ˆç°åœ¨ä½¿ç”¨é™æ€æ•°æ®ï¼Œæ— éœ€ç­‰å¾…ï¼‰
            function initializeDeviceList() {
                console.log('ğŸ”„ åˆå§‹åŒ–è®¾å¤‡åˆ—è¡¨');
                const allDevices = getDeviceDataFromMap();
                console.log('âœ… è®¾å¤‡æ•°æ®åŠ è½½æˆåŠŸï¼Œæ¸²æŸ“è®¾å¤‡åˆ—è¡¨');
                renderDeviceList(allDevices);
            }

            // ç«‹å³åˆå§‹åŒ–
            initializeDeviceList();

            // ç”±äºä½¿ç”¨é™æ€æ•°æ®ï¼Œæ— éœ€å®šæœŸåˆ·æ–°
            // å¦‚æœå°†æ¥éœ€è¦å®æ—¶æ•°æ®ï¼Œå¯ä»¥å¯ç”¨ä»¥ä¸‹ä»£ç ï¼š
            /*
            setInterval(() => {
                const currentFilter = deviceTypeFilter.value;
                const allDevices = getDeviceDataFromMap();
                const filteredDevices = filterDevices(currentFilter, allDevices);
                renderDeviceList(filteredDevices);
            }, 5000);
            */
        }

        // æ‰“å¼€è®¾å¤‡è¯¦æƒ…å¼¹çª—
        function openDeviceModal(device) {
            const modal = document.getElementById('deviceDetailModal');
            const modalTitle = document.getElementById('deviceModalTitle');
            const modalName = document.getElementById('deviceModalName');
            const modalDescription = document.getElementById('deviceModalDescription');
            const statusBadge = document.getElementById('deviceStatusBadge');
            const infoGrid = document.getElementById('deviceInfoGrid');
            const modalContent = document.getElementById('deviceModalContent');

            // è®¾ç½®åŸºæœ¬ä¿¡æ¯
            modalTitle.textContent = device.name;
            modalName.textContent = device.name;

            // è®¾ç½®çŠ¶æ€å¾½ç« 
            statusBadge.textContent = getStatusText(device.status);
            statusBadge.className = `device-status-badge ${device.status}`;

            // è®¾ç½®æè¿°
            modalDescription.textContent = getDeviceDescription(device);

            // ç”ŸæˆåŸºæœ¬ä¿¡æ¯ç½‘æ ¼
            infoGrid.innerHTML = generateDeviceInfoGrid(device);

            // æ ¹æ®è®¾å¤‡ç±»å‹ç”Ÿæˆç‰¹å®šå†…å®¹
            switch(device.type) {
                case 'camera':
                    modalContent.innerHTML = generateCameraContent(device);
                    break;
                case 'weather':
                    modalContent.innerHTML = generateWeatherContent(device);
                    break;
                case 'rainfall':
                    modalContent.innerHTML = generateRainfallContent(device);
                    break;
                case 'water':
                    modalContent.innerHTML = generateWaterContent(device);
                    break;
                case 'displacement':
                    modalContent.innerHTML = generateDisplacementContent(device);
                    break;
                case 'soil':
                    modalContent.innerHTML = generateSoilContent(device);
                    break;
                default:
                    modalContent.innerHTML = generateDefaultContent(device);
            }

            modal.style.display = 'block';

            // å¦‚æœæ˜¯æœ‰å›¾è¡¨çš„è®¾å¤‡ç±»å‹ï¼Œåˆå§‹åŒ–å›¾è¡¨
            if (['weather', 'rainfall', 'water', 'displacement', 'soil'].includes(device.type)) {
                setTimeout(() => initDeviceChart(device.type), 100);
            }
        }

        // è·å–è®¾å¤‡æè¿°
        function getDeviceDescription(device) {
            const descriptions = {
                'camera': 'é«˜æ¸…ç›‘æ§æ‘„åƒå¤´ï¼Œæä¾›24å°æ—¶å®æ—¶ç›‘æ§ï¼Œæ”¯æŒè¿œç¨‹æ§åˆ¶å’Œå½•åƒå›æ”¾åŠŸèƒ½ã€‚',
                'weather': 'å¤šåŠŸèƒ½æ°”è±¡ç›‘æµ‹ç«™ï¼Œå®æ—¶ç›‘æµ‹æ¸©åº¦ã€æ¹¿åº¦ã€é£é€Ÿã€æ°”å‹ç­‰æ°”è±¡å‚æ•°ã€‚',
                'rainfall': 'é«˜ç²¾åº¦é›¨é‡ç›‘æµ‹è®¾å¤‡ï¼Œå®æ—¶ç›‘æµ‹é™é›¨é‡å˜åŒ–ï¼Œä¸ºé¢„è­¦æä¾›å…³é”®æ•°æ®ã€‚',
                'water': 'æ°´ä½ç›‘æµ‹ä¼ æ„Ÿå™¨ï¼Œå®æ—¶ç›‘æµ‹æ°´ä½å˜åŒ–ï¼Œé¢„é˜²æ´ªæ¶ç¾å®³ã€‚',
                'displacement': 'åœ°è¡¨ä½ç§»ç›‘æµ‹è®¾å¤‡ï¼Œé«˜ç²¾åº¦ç›‘æµ‹åœ°è¡¨å¾®å°ä½ç§»å˜åŒ–ã€‚',
                'soil': 'åœŸå£¤å¢’æƒ…ç›‘æµ‹ç«™ï¼Œç›‘æµ‹åœŸå£¤æ¸©åº¦ã€æ¹¿åº¦ã€pHå€¼ç­‰å…³é”®å‚æ•°ã€‚'
            };
            return descriptions[device.type] || 'ä¸“ä¸šç›‘æµ‹è®¾å¤‡ï¼Œä¸ºåœ°è´¨ç¾å®³é¢„è­¦æä¾›é‡è¦æ•°æ®æ”¯æŒã€‚';
        }

        // ç”Ÿæˆè®¾å¤‡åŸºæœ¬ä¿¡æ¯ç½‘æ ¼
        function generateDeviceInfoGrid(device) {
            return `
                <div class="info-item">
                    <span class="label">è®¾å¤‡ä½ç½®:</span>
                    <span class="value">${device.location}</span>
                </div>
                <div class="info-item">
                    <span class="label">è®¾å¤‡çŠ¶æ€:</span>
                    <span class="value status-${device.status}">${getStatusText(device.status)}</span>
                </div>
                <div class="info-item">
                    <span class="label">è®¾å¤‡ç±»å‹:</span>
                    <span class="value">${getDeviceTypeName(device.type)}</span>
                </div>
                <div class="info-item">
                    <span class="label">å®‰è£…æ—¶é—´:</span>
                    <span class="value">${device.installDate || '2024-01-15'}</span>
                </div>
                <div class="info-item">
                    <span class="label">æœ€åé€šä¿¡:</span>
                    <span class="value">${device.lastContact || '2åˆ†é’Ÿå‰'}</span>
                </div>
                <div class="info-item">
                    <span class="label">æ•°æ®å®Œæ•´æ€§:</span>
                    <span class="value">${device.dataIntegrity || '98.5%'}</span>
                </div>
            `;
        }

        // è·å–è®¾å¤‡ç±»å‹åç§°
        function getDeviceTypeName(type) {
            const typeNames = {
                'camera': 'é«˜æ¸…ç›‘æ§æ‘„åƒå¤´',
                'weather': 'æ°”è±¡ç›‘æµ‹ç«™',
                'rainfall': 'é›¨é‡ç›‘æµ‹å™¨',
                'water': 'æ°´ä½ç›‘æµ‹å™¨',
                'displacement': 'ä½ç§»ç›‘æµ‹å™¨',
                'soil': 'åœŸå£¤ç›‘æµ‹ç«™'
            };
            return typeNames[type] || 'ç›‘æµ‹è®¾å¤‡';
        }

        // ç”Ÿæˆæ‘„åƒå¤´è®¾å¤‡å†…å®¹
        function generateCameraContent(device) {
            return `
                <div class="camera-video-section">
                    <div class="video-tabs">
                        <button class="video-tab active" onclick="switchVideoTab('live')">å®æ—¶è§†é¢‘</button>
                        <button class="video-tab" onclick="switchVideoTab('history')">å†å²å›æ”¾</button>
                    </div>

                    <div class="video-content">
                        <div id="liveVideo" class="video-panel active">
                            <div class="video-player">
                                <div class="video-placeholder">
                                    <div class="video-icon">ğŸ“¹</div>
                                    <div class="video-text">å®æ—¶è§†é¢‘æµ</div>
                                    <div class="video-status">â— æ­£åœ¨ç›´æ’­</div>
                                </div>
                            </div>
                            <div class="video-controls">
                                <button class="control-btn">ğŸ“· æˆªå›¾</button>
                                <button class="control-btn">ğŸ¥ å½•åˆ¶</button>
                                <button class="control-btn">ğŸ” æ”¾å¤§</button>
                            </div>
                        </div>

                        <div id="historyVideo" class="video-panel">
                            <div class="history-controls">
                                <input type="date" id="historyDate" class="date-input">
                                <input type="time" id="historyTime" class="time-input">
                                <button class="control-btn">ğŸ” æŸ¥æ‰¾</button>
                            </div>
                            <div class="video-player">
                                <div class="video-placeholder">
                                    <div class="video-icon">ğŸ“¼</div>
                                    <div class="video-text">å†å²è§†é¢‘å›æ”¾</div>
                                    <div class="video-status">è¯·é€‰æ‹©æ—¥æœŸå’Œæ—¶é—´</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ç”Ÿæˆæ°”è±¡ç«™è®¾å¤‡å†…å®¹
        function generateWeatherContent(device) {
            return `
                <div class="device-basic-info">
                    <div class="info-row">
                        <span class="label">è®¾å¤‡åç§°:</span>
                        <span class="value">${device.name}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">è®¾å¤‡ä½ç½®:</span>
                        <span class="value">${device.location}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">è®¾å¤‡çŠ¶æ€:</span>
                        <span class="value status-${device.status}">${getStatusText(device.status)}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">è®¾å¤‡ç±»å‹:</span>
                        <span class="value">è‡ªåŠ¨æ°”è±¡è§‚æµ‹è®¾å¤‡</span>
                    </div>
                </div>

                <div class="weather-data-section">
                    <h4>å®æ—¶æ°”è±¡æ•°æ®</h4>
                    <div class="weather-grid">
                        <div class="weather-item">
                            <div class="weather-icon">ğŸŒ¡ï¸</div>
                            <div class="weather-label">æ¸©åº¦</div>
                            <div class="weather-value">23.5Â°C</div>
                        </div>
                        <div class="weather-item">
                            <div class="weather-icon">ğŸ’§</div>
                            <div class="weather-label">æ¹¿åº¦</div>
                            <div class="weather-value">68%</div>
                        </div>
                        <div class="weather-item">
                            <div class="weather-icon">ğŸ’¨</div>
                            <div class="weather-label">é£é€Ÿ</div>
                            <div class="weather-value">3.2m/s</div>
                        </div>
                        <div class="weather-item">
                            <div class="weather-icon">ğŸ§­</div>
                            <div class="weather-label">é£å‘</div>
                            <div class="weather-value">ä¸œå—é£</div>
                        </div>
                        <div class="weather-item">
                            <div class="weather-icon">ğŸ“Š</div>
                            <div class="weather-label">æ°”å‹</div>
                            <div class="weather-value">1013hPa</div>
                        </div>
                        <div class="weather-item">
                            <div class="weather-icon">â˜€ï¸</div>
                            <div class="weather-label">å…‰ç…§</div>
                            <div class="weather-value">45000Lux</div>
                        </div>
                    </div>
                </div>

                <div class="chart-section">
                    <h4>24å°æ—¶å†å²è¶‹åŠ¿</h4>
                    <div class="chart-container">
                        <canvas id="weatherChart" width="400" height="200"></canvas>
                    </div>
                </div>
            `;
        }

        // ç”Ÿæˆé›¨é‡è®¡è®¾å¤‡å†…å®¹
        function generateRainfallContent(device) {
            return `
                <div class="device-basic-info">
                    <div class="info-row">
                        <span class="label">è®¾å¤‡åç§°:</span>
                        <span class="value">${device.name}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">è®¾å¤‡ä½ç½®:</span>
                        <span class="value">${device.location}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">è®¾å¤‡çŠ¶æ€:</span>
                        <span class="value status-${device.status}">${getStatusText(device.status)}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">è®¾å¤‡ç±»å‹:</span>
                        <span class="value">è‡ªåŠ¨é›¨é‡è®¡</span>
                    </div>
                </div>

                <div class="rainfall-data-section">
                    <div class="current-data">
                        <div class="data-card">
                            <div class="data-title">å½“å‰é™é›¨å¼ºåº¦</div>
                            <div class="data-value">12.5 mm/h</div>
                            <div class="data-status normal">æ­£å¸¸èŒƒå›´</div>
                        </div>
                        <div class="data-card">
                            <div class="data-title">ä»Šæ—¥ç´¯è®¡é™é›¨</div>
                            <div class="data-value">36.8 mm</div>
                            <div class="data-status warning">æ¥è¿‘è­¦æˆ’å€¼</div>
                        </div>
                        <div class="data-card">
                            <div class="data-title">æœ¬å‘¨ç´¯è®¡é™é›¨</div>
                            <div class="data-value">128.5 mm</div>
                            <div class="data-status">--</div>
                        </div>
                    </div>
                </div>

                <div class="chart-section">
                    <h4>é™é›¨é‡å†å²è¶‹åŠ¿</h4>
                    <div class="chart-container">
                        <canvas id="rainfallChart" width="400" height="200"></canvas>
                    </div>
                </div>
            `;
        }

        // ç”Ÿæˆæ°´ä½è®¡è®¾å¤‡å†…å®¹
        function generateWaterContent(device) {
            return `
                <div class="device-basic-info">
                    <div class="info-row">
                        <span class="label">è®¾å¤‡åç§°:</span>
                        <span class="value">${device.name}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">è®¾å¤‡ä½ç½®:</span>
                        <span class="value">${device.location}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">è®¾å¤‡çŠ¶æ€:</span>
                        <span class="value status-${device.status}">${getStatusText(device.status)}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">è®¾å¤‡ç±»å‹:</span>
                        <span class="value">è‡ªåŠ¨æ°´ä½ç›‘æµ‹ç«™</span>
                    </div>
                </div>

                <div class="water-data-section">
                    <div class="current-data">
                        <div class="data-card">
                            <div class="data-title">å½“å‰æ°´ä½</div>
                            <div class="data-value">3.25 m</div>
                            <div class="data-status normal">æ­£å¸¸æ°´ä½</div>
                        </div>
                        <div class="data-card">
                            <div class="data-title">è­¦æˆ’æ°´ä½</div>
                            <div class="data-value">4.50 m</div>
                            <div class="data-status">è·è­¦æˆ’çº¿ 1.25m</div>
                        </div>
                        <div class="data-card">
                            <div class="data-title">24å°æ—¶å˜åŒ–</div>
                            <div class="data-value">+0.15 m</div>
                            <div class="data-status normal">ç¼“æ…¢ä¸Šå‡</div>
                        </div>
                    </div>
                </div>

                <div class="chart-section">
                    <h4>æ°´ä½å†å²è¶‹åŠ¿</h4>
                    <div class="chart-container">
                        <canvas id="waterChart" width="400" height="200"></canvas>
                    </div>
                </div>
            `;
        }

        // ç”Ÿæˆä½ç§»è®¡è®¾å¤‡å†…å®¹
        function generateDisplacementContent(device) {
            return `
                <div class="device-basic-info">
                    <div class="info-row">
                        <span class="label">è®¾å¤‡åç§°:</span>
                        <span class="value">${device.name}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">è®¾å¤‡ä½ç½®:</span>
                        <span class="value">${device.location}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">è®¾å¤‡çŠ¶æ€:</span>
                        <span class="value status-${device.status}">${getStatusText(device.status)}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">è®¾å¤‡ç±»å‹:</span>
                        <span class="value">åœ°è¡¨ä½ç§»ç›‘æµ‹ä»ª</span>
                    </div>
                </div>

                <div class="displacement-data-section">
                    <div class="current-data">
                        <div class="data-card">
                            <div class="data-title">å½“å‰ä½ç§»</div>
                            <div class="data-value">2.8 mm</div>
                            <div class="data-status normal">å®‰å…¨èŒƒå›´</div>
                        </div>
                        <div class="data-card">
                            <div class="data-title">ä½ç§»é€Ÿç‡</div>
                            <div class="data-value">0.3 mm/å¤©</div>
                            <div class="data-status normal">ç¨³å®š</div>
                        </div>
                        <div class="data-card">
                            <div class="data-title">ç´¯è®¡ä½ç§»</div>
                            <div class="data-value">15.6 mm</div>
                            <div class="data-status normal">æ­£å¸¸èŒƒå›´</div>
                        </div>
                    </div>
                </div>

                <div class="chart-section">
                    <h4>ä½ç§»å†å²è¶‹åŠ¿</h4>
                    <div class="chart-container">
                        <canvas id="displacementChart" width="400" height="200"></canvas>
                    </div>
                </div>
            `;
        }

        // ç”ŸæˆåœŸå£¤ç›‘æµ‹è®¾å¤‡å†…å®¹
        function generateSoilContent(device) {
            return `
                <div class="device-basic-info">
                    <div class="info-row">
                        <span class="label">è®¾å¤‡åç§°:</span>
                        <span class="value">${device.name}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">è®¾å¤‡ä½ç½®:</span>
                        <span class="value">${device.location}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">è®¾å¤‡çŠ¶æ€:</span>
                        <span class="value status-${device.status}">${getStatusText(device.status)}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">è®¾å¤‡ç±»å‹:</span>
                        <span class="value">åœŸå£¤ç¯å¢ƒç›‘æµ‹ç«™</span>
                    </div>
                </div>

                <div class="soil-data-section">
                    <div class="current-data">
                        <div class="data-card">
                            <div class="data-title">åœŸå£¤æ¹¿åº¦</div>
                            <div class="data-value">45.2%</div>
                            <div class="data-status normal">é€‚ä¸­</div>
                        </div>
                        <div class="data-card">
                            <div class="data-title">åœŸå£¤æ¸©åº¦</div>
                            <div class="data-value">18.5Â°C</div>
                            <div class="data-status normal">æ­£å¸¸</div>
                        </div>
                        <div class="data-card">
                            <div class="data-title">åœŸå£¤pHå€¼</div>
                            <div class="data-value">6.8</div>
                            <div class="data-status normal">ä¸­æ€§</div>
                        </div>
                    </div>
                </div>

                <div class="chart-section">
                    <h4>åœŸå£¤å‚æ•°å†å²è¶‹åŠ¿</h4>
                    <div class="chart-container">
                        <canvas id="soilChart" width="400" height="200"></canvas>
                    </div>
                </div>
            `;
        }

        // ç”Ÿæˆé»˜è®¤è®¾å¤‡å†…å®¹
        function generateDefaultContent(device) {
            return `
                <div class="device-basic-info">
                    <div class="info-row">
                        <span class="label">è®¾å¤‡åç§°:</span>
                        <span class="value">${device.name}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">è®¾å¤‡ä½ç½®:</span>
                        <span class="value">${device.location}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">è®¾å¤‡çŠ¶æ€:</span>
                        <span class="value status-${device.status}">${getStatusText(device.status)}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">è®¾å¤‡ç±»å‹:</span>
                        <span class="value">ç›‘æµ‹è®¾å¤‡</span>
                    </div>
                    <div class="info-row">
                        <span class="label">æœ€åæ›´æ–°:</span>
                        <span class="value">${new Date().toLocaleString()}</span>
                    </div>
                </div>
            `;
        }

        // è§†é¢‘æ ‡ç­¾åˆ‡æ¢å‡½æ•°
        function switchVideoTab(tabType) {
            document.querySelectorAll('.video-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.video-panel').forEach(panel => panel.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabType + 'Video').classList.add('active');
        }

        // åˆå§‹åŒ–è®¾å¤‡å›¾è¡¨
        function initDeviceChart(deviceType) {
            const chartId = deviceType + 'Chart';
            const canvas = document.getElementById(chartId);
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, width, height);

            // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
            const data = generateChartData(deviceType);

            // ç»˜åˆ¶å›¾è¡¨
            drawChart(ctx, data, width, height, deviceType);
        }

        // ç”Ÿæˆå›¾è¡¨æ•°æ®
        function generateChartData(deviceType) {
            const hours = 24;
            const data = [];

            for (let i = 0; i < hours; i++) {
                let value;
                switch(deviceType) {
                    case 'weather':
                        value = 20 + Math.sin(i * Math.PI / 12) * 5 + Math.random() * 3;
                        break;
                    case 'rainfall':
                        value = Math.max(0, Math.sin(i * Math.PI / 8) * 10 + Math.random() * 5);
                        break;
                    case 'water':
                        value = 3 + Math.sin(i * Math.PI / 16) * 0.5 + Math.random() * 0.2;
                        break;
                    case 'displacement':
                        value = 2 + i * 0.05 + Math.random() * 0.3;
                        break;
                    case 'soil':
                        value = 45 + Math.sin(i * Math.PI / 12) * 10 + Math.random() * 5;
                        break;
                    default:
                        value = Math.random() * 100;
                }
                data.push(value);
            }

            return data;
        }

        // ç»˜åˆ¶å›¾è¡¨
        function drawChart(ctx, data, width, height, deviceType) {
            const padding = 40;
            const chartWidth = width - padding * 2;
            const chartHeight = height - padding * 2;

            // è®¾ç½®æ ·å¼
            ctx.strokeStyle = '#00ffff';
            ctx.fillStyle = '#00ffff';
            ctx.lineWidth = 2;
            ctx.font = '12px Roboto Mono';

            // ç»˜åˆ¶åæ ‡è½´
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.stroke();

            // ç»˜åˆ¶æ•°æ®çº¿
            ctx.beginPath();
            const maxValue = Math.max(...data);
            const minValue = Math.min(...data);
            const valueRange = maxValue - minValue || 1;

            data.forEach((value, index) => {
                const x = padding + (index / (data.length - 1)) * chartWidth;
                const y = height - padding - ((value - minValue) / valueRange) * chartHeight;

                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });

            ctx.stroke();

            // ç»˜åˆ¶æ•°æ®ç‚¹
            ctx.fillStyle = '#00ffff';
            data.forEach((value, index) => {
                const x = padding + (index / (data.length - 1)) * chartWidth;
                const y = height - padding - ((value - minValue) / valueRange) * chartHeight;

                ctx.beginPath();
                ctx.arc(x, y, 3, 0, 2 * Math.PI);
                ctx.fill();
            });
        }
    </script>
</body>
</html>
