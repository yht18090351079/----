<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VRå…¨æ™¯å¯è§†åŒ– - åœ°è´¨ç¾å®³é¢„è­¦ç³»ç»Ÿ</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŒ</text></svg>">
    <!-- A-Frame VRæ¡†æ¶ -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <!-- ç²’å­ç³»ç»Ÿç»„ä»¶ -->
    <script src="https://cdn.jsdelivr.net/gh/supermedium/superframe@master/components/particle-system/dist/aframe-particle-system-component.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #000;
            overflow: hidden;
        }

        /* VRåœºæ™¯å…¨å± */
        a-scene {
            width: 100vw !important;
            height: 100vh !important;
        }

        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            backdrop-filter: blur(10px);
            color: #00ffff;
            font-family: 'Courier New', monospace;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
            color: #99ccff;
        }

        .control-group select,
        .control-group button {
            background: rgba(0, 30, 60, 0.8);
            border: 1px solid rgba(0, 255, 255, 0.3);
            color: #00ffff;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            margin: 2px;
        }

        .control-group button:hover {
            background: rgba(0, 255, 255, 0.2);
            border-color: #00ffff;
        }

        .simulation-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
        }

        /* ä¿¡æ¯æ˜¾ç¤º */
        .info-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            backdrop-filter: blur(10px);
            color: #00ffff;
            font-family: 'Courier New', monospace;
            min-width: 200px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .info-label {
            color: #99ccff;
        }

        .info-value {
            color: #00ffff;
            font-weight: bold;
        }

        /* åº•éƒ¨æ§åˆ¶æ  */
        .bottom-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 25px;
            padding: 10px 20px;
            backdrop-filter: blur(10px);
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .control-btn {
            background: rgba(0, 30, 60, 0.8);
            border: 1px solid rgba(0, 255, 255, 0.3);
            color: #00ffff;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            border-color: #00ffff;
            transform: scale(1.05);
        }

        .control-btn.active {
            background: rgba(0, 255, 255, 0.3);
            border-color: #00ffff;
        }

        /* æç¤ºä¿¡æ¯ */
        .toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: #00ffff;
            padding: 15px 25px;
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 255, 0.5);
            z-index: 2000;
            font-family: 'Courier New', monospace;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .toast.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="page-container">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <header class="header">
            <div class="header-left">
                <div class="logo">
                    <span class="logo-icon">ğŸŒ</span>
                    <span class="logo-text">åœ°è´¨ç¾å®³é¢„è­¦ç³»ç»Ÿ</span>
                </div>
                <nav class="breadcrumb">
                    <a href="geological-disaster-dashboard.html">ç›‘æ§ä¸­å¿ƒ</a>
                    <span class="separator">></span>
                    <span class="current">VRå…¨æ™¯å¯è§†åŒ–</span>
                </nav>
            </div>

            <nav class="header-nav">
                <a href="geological-disaster-dashboard.html" class="menu-item">
                    <span class="menu-icon">â—‰</span>
                    å®æ—¶ç›‘æ§
                </a>
                <a href="../warning/warning-monitor.html" class="menu-item">
                    <span class="menu-icon">â–³</span>
                    é¢„è­¦ç®¡ç†
                </a>
                <a href="../data/data-analysis.html" class="menu-item">
                    <span class="menu-icon">â–²</span>
                    æ•°æ®åˆ†æ
                </a>
                <a href="#" class="menu-item" onclick="showComingSoon('åº”æ€¥æŒ‡æŒ¥')">
                    <span class="menu-icon">â—†</span>
                    åº”æ€¥æŒ‡æŒ¥
                </a>
                <a href="../system/system-settings.html" class="menu-item">
                    <span class="menu-icon">â—ˆ</span>
                    ç³»ç»Ÿè®¾ç½®
                </a>
            </nav>

            <div class="header-right">
                <button class="btn btn-secondary" onclick="toggleAudio()">ğŸ”Š éŸ³æ•ˆ</button>
                <button class="btn btn-secondary" onclick="toggleVRMode()">ğŸ¥½ VRæ¨¡å¼</button>
                <button class="btn btn-primary" onclick="captureScreenshot()">ğŸ“· æˆªå›¾</button>
                <div class="user-info">
                    <span class="user-name">å¼ ä¸‰</span>
                    <div class="user-avatar">ğŸ‘¤</div>
                </div>
                <button class="fullscreen-btn" onclick="toggleFullscreen()">â›¶</button>
            </div>
        </header>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="control-panel">
            <div class="panel-left">
                <!-- éšæ‚£ç‚¹é€‰æ‹© -->
                <div class="control-group">
                    <label>éšæ‚£ç‚¹é€‰æ‹©</label>
                    <select id="hazardPointSelect" onchange="switchHazardPoint()">
                        <option value="point1">XXæ‘æ»‘å¡éšæ‚£ç‚¹</option>
                        <option value="point2">YYé•‡æ³¥çŸ³æµéšæ‚£ç‚¹</option>
                        <option value="point3">ZZå¿å´©å¡Œéšæ‚£ç‚¹</option>
                        <option value="point4">AAåŒºåœ°é™·éšæ‚£ç‚¹</option>
                    </select>
                </div>

                <!-- è§†è§’æ§åˆ¶ -->
                <div class="control-group">
                    <label>è§†è§’æ§åˆ¶</label>
                    <div class="view-controls">
                        <button class="control-btn" onclick="resetView()">ğŸ¯ é‡ç½®è§†è§’</button>
                        <button class="control-btn" onclick="autoRotate()">ğŸ”„ è‡ªåŠ¨æ—‹è½¬</button>
                        <button class="control-btn" onclick="toggleFlyMode()">ğŸš é£è¡Œæ¨¡å¼</button>
                        <button class="control-btn" onclick="testPanorama()">ğŸ–¼ï¸ æµ‹è¯•å…¨æ™¯</button>
                    </div>
                </div>
            </div>

            <div class="panel-center">
                <!-- ç¾å®³æ¨¡æ‹Ÿæ§åˆ¶ -->
                <div class="control-group">
                    <label>ç¾å®³æ¨¡æ‹Ÿ</label>
                    <div class="simulation-controls">
                        <button class="sim-btn" onclick="simulateDisaster('landslide')">
                            <span class="sim-icon">ğŸ”ï¸</span>
                            æ»‘å¡æ¨¡æ‹Ÿ
                        </button>
                        <button class="sim-btn" onclick="simulateDisaster('debris-flow')">
                            <span class="sim-icon">ğŸŒŠ</span>
                            æ³¥çŸ³æµæ¨¡æ‹Ÿ
                        </button>
                        <button class="sim-btn" onclick="simulateDisaster('collapse')">
                            <span class="sim-icon">â›°ï¸</span>
                            å´©å¡Œæ¨¡æ‹Ÿ
                        </button>
                        <button class="sim-btn" onclick="simulateDisaster('rainfall')">
                            <span class="sim-icon">ğŸŒ§ï¸</span>
                            é™é›¨æ¨¡æ‹Ÿ
                        </button>
                    </div>
                </div>
            </div>

            <div class="panel-right">
                <!-- å›¾å±‚æ§åˆ¶ -->
                <div class="control-group">
                    <label>å›¾å±‚æ§åˆ¶</label>
                    <div class="layer-controls">
                        <label class="layer-item">
                            <input type="checkbox" checked onchange="toggleLayer('monitoring')">
                            <span class="checkmark"></span>
                            <span class="layer-text">ç›‘æµ‹è®¾å¤‡</span>
                        </label>
                        <label class="layer-item">
                            <input type="checkbox" checked onchange="toggleLayer('warning')">
                            <span class="checkmark"></span>
                            <span class="layer-text">é¢„è­¦åŒºåŸŸ</span>
                        </label>
                        <label class="layer-item">
                            <input type="checkbox" onchange="toggleLayer('evacuation')">
                            <span class="checkmark"></span>
                            <span class="layer-text">ç–æ•£è·¯çº¿</span>
                        </label>
                        <label class="layer-item">
                            <input type="checkbox" onchange="toggleLayer('historical')">
                            <span class="checkmark"></span>
                            <span class="layer-text">å†å²ç¾æƒ…</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- VRå…¨æ™¯ä¸»ä½“åŒºåŸŸ -->
        <div class="vr-container">
            <!-- A-Frame VRåœºæ™¯ -->
            <a-scene id="vrScene" embedded style="height: 100%; width: 100%;"
                     background="color: #000000"
                     fog="type: exponential; density: 0.005; color: #cccccc">

                <!-- èµ„æºé¢„åŠ è½½ -->
                <a-assets>
                    <!-- å…¨æ™¯å›¾ç‰‡èµ„æº -->
                    <canvas id="panorama1" width="2048" height="1024"></canvas>
                    <canvas id="panorama2" width="2048" height="1024"></canvas>
                    <canvas id="panorama3" width="2048" height="1024"></canvas>
                    <canvas id="panorama4" width="2048" height="1024"></canvas>

                    <!-- 3Dæ¨¡å‹èµ„æº -->
                    <a-mixin id="deviceMixin"
                             geometry="primitive: box; width: 0.5; height: 0.5; depth: 0.5"
                             material="color: #00ffff; metalness: 0.8; roughness: 0.2"
                             animation="property: rotation; to: 0 360 0; loop: true; dur: 4000"></a-mixin>

                    <a-mixin id="sensorMixin"
                             geometry="primitive: cylinder; radius: 0.3; height: 1"
                             material="color: #ffaa00; metalness: 0.6; roughness: 0.3"
                             animation="property: position; dir: alternate; loop: true; dur: 2000"></a-mixin>

                    <!-- éŸ³æ•ˆèµ„æº (ç§»é™¤æ— æ•ˆçš„base64éŸ³é¢‘) -->
                    <!-- éŸ³é¢‘åŠŸèƒ½å·²ç¦ç”¨ï¼Œé¿å…åŠ è½½é”™è¯¯ -->
                </a-assets>

                <!-- å…¨æ™¯å¤©ç©ºç›’ -->
                <a-sky id="panoramaSky"
                       src="#panorama1"
                       rotation="0 0 0"
                       color="#87CEEB"></a-sky>

                <!-- é«˜ä¿çœŸ3Dç¯å¢ƒ -->
                <a-entity id="environment" environment="preset: forest; groundColor: #445; grid: cross">
                    <!-- åœ°è´¨åœ°å½¢ (ç®€åŒ–ç‰ˆ) -->
                    <a-plane id="terrain" position="0 -1 0" rotation="-90 0 0" width="100" height="100"
                             material="color: #8B7355; roughness: 1"></a-plane>

                    <!-- å¤æ‚å±±ä½“ç»“æ„ -->
                    <a-entity id="mountainRange">
                        <!-- ä¸»å±±ä½“ -->
                        <a-cone position="-15 8 -25" radius-bottom="12" radius-top="3" height="16"
                                material="color: #696969; roughness: 0.8; metalness: 0.1"
                                physics="type: static; shape: hull"></a-cone>

                        <!-- æ¬¡å±±ä½“ -->
                        <a-cone position="12 6 -30" radius-bottom="8" radius-top="1" height="12"
                                material="color: #708090; roughness: 0.9; metalness: 0.05"></a-cone>

                        <!-- å²©çŸ³ç¾¤ -->
                        <a-dodecahedron position="-8 2 -12" radius="2"
                                        material="color: #555; roughness: 1; metalness: 0"
                                        physics="type: static"></a-dodecahedron>
                        <a-icosahedron position="6 1.5 -8" radius="1.5"
                                       material="color: #666; roughness: 0.9"></a-icosahedron>
                    </a-entity>

                    <!-- æ¤è¢«ç³»ç»Ÿ -->
                    <a-entity id="vegetation">
                        <!-- å¤§æ ‘ -->
                        <a-cylinder position="-5 2 -10" radius="0.3" height="4"
                                    material="color: #8B4513; roughness: 1"></a-cylinder>
                        <a-sphere position="-5 4.5 -10" radius="2"
                                  material="color: #228B22; roughness: 0.8"></a-sphere>

                        <!-- å°æ ‘æ— -->
                        <a-cylinder position="8 1.5 -15" radius="0.2" height="3"
                                    material="color: #654321; roughness: 1"></a-cylinder>
                        <a-sphere position="8 3.2 -15" radius="1.5"
                                  material="color: #32CD32; roughness: 0.7"></a-sphere>

                        <a-cylinder position="3 1 -6" radius="0.15" height="2"
                                    material="color: #8B4513; roughness: 1"></a-cylinder>
                        <a-sphere position="3 2.2 -6" radius="1"
                                  material="color: #90EE90; roughness: 0.8"></a-sphere>
                    </a-entity>

                    <!-- æ°´ä½“ç³»ç»Ÿ -->
                    <a-entity id="waterSystem">
                        <a-plane position="10 0.1 -20" rotation="-90 0 0" width="8" height="12"
                                 material="color: #006994; opacity: 0.8; transparent: true"
                                 animation="property: rotation; to: -90 0 5; dir: alternate; loop: true; dur: 4000"></a-plane>
                    </a-entity>
                </a-entity>

                <!-- é«˜ä¿çœŸç›‘æµ‹è®¾å¤‡ç³»ç»Ÿ -->
                <a-entity id="monitoringDevices">
                    <!-- ä½ç§»ä¼ æ„Ÿå™¨ç«™ -->
                    <a-entity id="displacementStation" position="-5 0 -3" class="clickable">
                        <!-- è®¾å¤‡åŸºåº§ -->
                        <a-cylinder radius="0.8" height="0.2"
                                    material="color: #333; metalness: 0.8; roughness: 0.2"
                                    physics="type: static"></a-cylinder>
                        <!-- æ”¯æ’‘æ† -->
                        <a-cylinder position="0 1 0" radius="0.05" height="2"
                                    material="color: #666; metalness: 0.9; roughness: 0.1"></a-cylinder>
                        <!-- ä¼ æ„Ÿå™¨ä¸»ä½“ -->
                        <a-box mixin="deviceMixin" position="0 2.5 0"
                               material="color: #00ffff; metalness: 0.8; roughness: 0.2"></a-box>
                        <!-- å¤©çº¿ -->
                        <a-cylinder position="0 3.2 0" radius="0.02" height="0.4"
                                    material="color: #fff; metalness: 1; roughness: 0"></a-cylinder>
                        <!-- æ•°æ®æ˜¾ç¤ºå± -->
                        <a-plane position="0 2.5 0.3" width="0.4" height="0.3"
                                 material="color: #000; emissive: #00ff00; emissiveIntensity: 0.5"
                                 text="value: 2.3mm; color: #00ff00; align: center; width: 8"></a-plane>
                        <!-- è®¾å¤‡æ ‡ç­¾ -->
                        <a-text value="ä½ç§»ä¼ æ„Ÿå™¨-001" position="0 3.5 0" align="center"
                                color="#00ffff" scale="0.6 0.6 0.6"
                                material="emissive: #004444; emissiveIntensity: 0.2"></a-text>
                        <!-- çŠ¶æ€æŒ‡ç¤ºç¯ -->
                        <a-sphere position="0.3 2.8 0.3" radius="0.05"
                                  material="color: #00ff00; emissive: #00ff00; emissiveIntensity: 0.8"
                                  animation="property: material.emissiveIntensity; to: 0.2; dir: alternate; loop: true; dur: 1000"></a-sphere>
                    </a-entity>

                    <!-- é›¨é‡è®¡ç«™ -->
                    <a-entity id="rainfallStation" position="3 0 -4" class="clickable">
                        <!-- è®¾å¤‡åŸºåº§ -->
                        <a-cylinder radius="0.6" height="0.15"
                                    material="color: #444; metalness: 0.7; roughness: 0.3"></a-cylinder>
                        <!-- é›¨é‡è®¡ä¸»ä½“ -->
                        <a-cylinder mixin="sensorMixin" position="0 1 0"
                                    material="color: #ffaa00; metalness: 0.6; roughness: 0.3; emissive: #442200; emissiveIntensity: 0.2"
                                    animation="property: position; to: 0 1.2 0; dir: alternate; loop: true; dur: 2000"></a-cylinder>
                        <!-- æ”¶é›†æ¼æ–— -->
                        <a-cone position="0 1.8 0" radius-bottom="0.4" radius-top="0.2" height="0.3"
                                material="color: #ffc000; metalness: 0.8; roughness: 0.1"></a-cone>
                        <!-- æ•°æ®ä¼ è¾“æ¨¡å— -->
                        <a-box position="0 0.5 0" width="0.3" height="0.2" depth="0.3"
                               material="color: #333; metalness: 0.9; roughness: 0.1"></a-box>
                        <!-- å¤ªé˜³èƒ½æ¿ -->
                        <a-plane position="0 2.2 0" rotation="-15 0 0" width="0.8" height="0.6"
                                 material="color: #001133; metalness: 0.9; roughness: 0.1; emissive: #000044; emissiveIntensity: 0.1"></a-plane>
                        <!-- è®¾å¤‡æ ‡ç­¾ -->
                        <a-text value="é›¨é‡è®¡-002" position="0 2.8 0" align="center"
                                color="#ffaa00" scale="0.6 0.6 0.6"
                                material="emissive: #442200; emissiveIntensity: 0.2"></a-text>
                        <!-- æ•°æ®æ˜¾ç¤º -->
                        <a-plane position="0 0.5 0.2" width="0.25" height="0.15"
                                 material="color: #000; emissive: #ffaa00; emissiveIntensity: 0.4"
                                 text="value: 15mm/h; color: #ffaa00; align: center; width: 10"></a-plane>
                    </a-entity>

                    <!-- å€¾æ–œä¼ æ„Ÿå™¨ -->
                    <a-entity id="tiltSensor" position="-2 0 -8" class="clickable">
                        <a-octahedron radius="0.3"
                                      material="color: #ff6600; metalness: 0.7; roughness: 0.2; emissive: #441100; emissiveIntensity: 0.3"
                                      animation="property: rotation; to: 360 360 0; loop: true; dur: 8000"
                                      physics="type: static"></a-octahedron>
                        <a-text value="å€¾æ–œä¼ æ„Ÿå™¨" position="0 1 0" align="center"
                                color="#ff6600" scale="0.5 0.5 0.5"></a-text>
                    </a-entity>

                    <!-- åœ°ä¸‹æ°´ä½ç›‘æµ‹äº• -->
                    <a-entity id="waterLevelSensor" position="6 0 -10" class="clickable">
                        <a-cylinder radius="0.4" height="3"
                                    material="color: #666; metalness: 0.8; roughness: 0.3"
                                    physics="type: static"></a-cylinder>
                        <a-torus position="0 1.5 0" radius="0.5" radius-tubular="0.05"
                                 material="color: #0088ff; metalness: 0.9; roughness: 0.1"
                                 animation="property: rotation; to: 0 360 0; loop: true; dur: 6000"></a-torus>
                        <a-text value="æ°´ä½ç›‘æµ‹" position="0 2.5 0" align="center"
                                color="#0088ff" scale="0.5 0.5 0.5"></a-text>
                    </a-entity>
                </a-entity>

                <!-- é«˜ä¿çœŸé¢„è­¦åŒºåŸŸç³»ç»Ÿ -->
                <a-entity id="warningAreas">
                    <!-- ä¸»è¦å±é™©åŒºåŸŸ -->
                    <a-entity id="primaryDangerZone">
                        <!-- 3Dé¢„è­¦è¾¹ç•Œ -->
                        <a-ring position="0 0.1 -8" radius-inner="8" radius-outer="10"
                                material="color: #ff4444; opacity: 0.4; transparent: true; side: double"
                                animation="property: material.opacity; to: 0.8; dir: alternate; loop: true; dur: 2000"></a-ring>

                        <!-- é¢„è­¦æŸ±çŠ¶ä½“ -->
                        <a-cylinder position="0 2 -8" radius="8" height="0.2"
                                    material="color: #ff4444; opacity: 0.3; transparent: true"
                                    animation="property: scale; to: 1.1 1 1.1; dir: alternate; loop: true; dur: 3000"></a-cylinder>

                        <!-- å…¨æ¯é¢„è­¦æ ‡è¯† -->
                        <a-text value="âš ï¸ é«˜é£é™©åŒºåŸŸ âš ï¸" position="0 3 -8" align="center"
                                color="#ff4444" scale="1.5 1.5 1.5"
                                material="emissive: #ff4444; emissiveIntensity: 0.5"
                                animation="property: position; to: 0 4 -8; dir: alternate; loop: true; dur: 2500"></a-text>

                        <!-- é¢„è­¦å…‰æŸ -->
                        <a-cylinder position="0 5 -8" radius="0.1" height="10"
                                    material="color: #ff0000; emissive: #ff0000; emissiveIntensity: 0.8; opacity: 0.6; transparent: true"
                                    animation="property: material.emissiveIntensity; to: 0.2; dir: alternate; loop: true; dur: 1000"></a-cylinder>
                    </a-entity>

                    <!-- æ¬¡è¦è­¦æˆ’åŒºåŸŸ -->
                    <a-entity id="secondaryWarningZone">
                        <a-ring position="-12 0.1 -15" radius-inner="5" radius-outer="6"
                                material="color: #ffaa00; opacity: 0.3; transparent: true"
                                animation="property: rotation; to: 0 360 0; loop: true; dur: 10000"></a-ring>
                        <a-text value="è­¦æˆ’åŒºåŸŸ" position="-12 2 -15" align="center"
                                color="#ffaa00" scale="1 1 1"></a-text>
                    </a-entity>

                    <!-- ç–æ•£è·¯çº¿æŒ‡ç¤º -->
                    <a-entity id="evacuationRoutes" visible="false">
                        <!-- ç–æ•£ç®­å¤´ -->
                        <a-cone position="2 1 -5" radius-bottom="0.3" radius-top="0" height="1"
                                rotation="0 0 -90" material="color: #00ff00; emissive: #00ff00; emissiveIntensity: 0.5"
                                animation="property: position; to: 8 1 -5; loop: true; dur: 3000"></a-cone>
                        <a-cone position="-2 1 -5" radius-bottom="0.3" radius-top="0" height="1"
                                rotation="0 0 90" material="color: #00ff00; emissive: #00ff00; emissiveIntensity: 0.5"
                                animation="property: position; to: -8 1 -5; loop: true; dur: 3000"></a-cone>

                        <!-- ç–æ•£è·¯å¾„ -->
                        <a-plane position="5 0.05 -5" rotation="-90 0 0" width="10" height="1"
                                 material="color: #00ff00; opacity: 0.6; transparent: true"
                                 animation="property: material.opacity; to: 0.2; dir: alternate; loop: true; dur: 1500"></a-plane>
                    </a-entity>
                </a-entity>

                <!-- é«˜ä¿çœŸç²’å­ç³»ç»Ÿ -->
                <a-entity id="particleEffects">
                    <!-- é™é›¨ç²’å­ç³»ç»Ÿ -->
                    <a-entity id="rainEffect" visible="false"
                              particle-system="preset: rain; particleCount: 2000; maxAge: 3;
                                             positionSpread: 25 0 25; velocityValue: 0 -10 0;
                                             velocitySpread: 2 1 2; color: #87CEEB,#B0E0E6;
                                             size: 0.8,1.2; opacity: 0.6,0.8"
                              position="0 15 0"></a-entity>

                    <!-- é›¾æ°”æ•ˆæœ -->
                    <a-entity id="fogEffect" visible="false"
                              particle-system="preset: dust; particleCount: 500; maxAge: 8;
                                             positionSpread: 20 5 20; velocityValue: 0 1 0;
                                             velocitySpread: 1 1 1; color: #cccccc,#ffffff;
                                             size: 2,4; opacity: 0.1,0.3"
                              position="0 2 -10"></a-entity>

                    <!-- æ»‘å¡åœŸçŸ³æµæ•ˆæœ -->
                    <a-entity id="debrisEffect" visible="false"
                              particle-system="preset: dust; particleCount: 1000; maxAge: 5;
                                             positionSpread: 5 2 5; velocityValue: -2 -5 -3;
                                             velocitySpread: 3 2 3; color: #8B4513,#A0522D;
                                             size: 0.5,2; opacity: 0.7,0.9"
                              position="-10 8 -15"></a-entity>

                    <!-- ç«èŠ±è­¦ç¤ºæ•ˆæœ -->
                    <a-entity id="sparkEffect" visible="false"
                              particle-system="preset: default; particleCount: 200; maxAge: 2;
                                             positionSpread: 1 1 1; velocityValue: 0 3 0;
                                             velocitySpread: 2 2 2; color: #ff4444,#ffaa00;
                                             size: 0.1,0.3; opacity: 0.8,1"
                              position="0 2 -8"></a-entity>
                </a-entity>

                <!-- é«˜ä¿çœŸç›¸æœºç³»ç»Ÿ -->
                <a-camera id="vrCamera"
                          look-controls="enabled: true; pointerLockEnabled: true"
                          wasd-controls="enabled: false; acceleration: 20"
                          position="0 1.6 0"
                          animation-timeline="timeline: cameraPath; autoplay: false">
                    <!-- é«˜çº§å…‰æ ‡ç³»ç»Ÿ -->
                    <a-cursor id="cursor"
                              color="#00ffff"
                              material="color: #00ffff"
                              geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.02"
                              animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
                              animation__fusing="property: scale; startEvents: fusing; from: 1 1 1; to: 0.1 0.1 0.1; dur: 1500"
                              animation__hover="property: material.opacity; startEvents: mouseenter; to: 1; dur: 200"
                              animation__leave="property: material.opacity; startEvents: mouseleave; to: 0.8; dur: 200"
                              raycaster="objects: .clickable; far: 50; interval: 100"></a-cursor>

                    <!-- ç›¸æœºHUDç•Œé¢ -->
                    <a-plane id="cameraHUD" position="0 -0.3 -1" width="0.8" height="0.2"
                             material="color: #000; opacity: 0.7; transparent: true"
                             text="value: è§†è§’: 0Â°, 0Â° | æ¨¡å¼: è§‚å¯Ÿ; color: #00ffff; align: center; width: 6"></a-plane>
                </a-camera>

                <!-- é«˜ä¿çœŸå…‰ç…§ç³»ç»Ÿ -->
                <a-light type="ambient" color="#404040" intensity="0.4"></a-light>
                <a-light type="directional" position="5 10 5" color="#ffffff" intensity="0.8"
                         light="castShadow: true; shadowMapWidth: 2048; shadowMapHeight: 2048"></a-light>
                <a-light type="point" position="-5 3 -3" color="#00ffff" intensity="0.5"
                         animation="property: intensity; to: 0.8; dir: alternate; loop: true; dur: 2000"></a-light>
                <a-light type="point" position="3 2 -4" color="#ffaa00" intensity="0.4"
                         animation="property: intensity; to: 0.7; dir: alternate; loop: true; dur: 1500"></a-light>

                <!-- åŠ¨æ€å¤©ç©ºå…‰ç…§ -->
                <a-light type="hemisphere" color="#87CEEB" groundColor="#8B7355" intensity="0.6"></a-light>

                <!-- ç¯å¢ƒéŸ³é¢‘ç³»ç»Ÿ (å·²ç¦ç”¨ï¼Œé¿å…åŠ è½½é”™è¯¯) -->
                <a-entity id="audioSystem">
                    <!-- éŸ³é¢‘åŠŸèƒ½æš‚æ—¶ç¦ç”¨ -->
                </a-entity>

                <!-- åå¤„ç†æ•ˆæœ -->
                <a-entity id="postProcessing">
                    <!-- å…¶ä»–åå¤„ç†æ•ˆæœå¯ä»¥åœ¨è¿™é‡Œæ·»åŠ  -->
                </a-entity>
            </a-scene>

            <!-- VRåœºæ™¯è¦†ç›–å±‚ä¿¡æ¯ -->
            <div class="vr-overlay">
                <div class="overlay-info">
                    <div class="current-point">
                        <span class="point-name" id="currentPointName">XXæ‘æ»‘å¡éšæ‚£ç‚¹</span>
                        <span class="point-status" id="currentPointStatus">æ­£å¸¸ç›‘æµ‹</span>
                    </div>
                    <div class="real-time-data">
                        <div class="data-item">
                            <span class="data-label">ä½ç§»:</span>
                            <span class="data-value" id="displacementValue">2.3mm</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">é™é›¨:</span>
                            <span class="data-value" id="rainfallValue">15mm/h</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">å€¾æ–œ:</span>
                            <span class="data-value" id="tiltValue">0.5Â°</span>
                        </div>
                    </div>
                </div>

                <!-- æ“ä½œæç¤º -->
                <div class="operation-tips">
                    <div class="tip-item">ğŸ–±ï¸ æ‹–æ‹½æ—‹è½¬è§†è§’</div>
                    <div class="tip-item">ğŸ” æ»šè½®ç¼©æ”¾</div>
                    <div class="tip-item">ğŸ‘† ç‚¹å‡»è®¾å¤‡æŸ¥çœ‹è¯¦æƒ…</div>
                </div>
            </div>
        </div>

        <!-- æ—¶é—´è½´æ§åˆ¶ -->
        <div class="timeline-control">
            <div class="timeline-header">
                <h4>ç¾å®³æ¨¡æ‹Ÿæ—¶é—´è½´</h4>
                <div class="timeline-actions">
                    <button class="timeline-btn" onclick="playSimulation()">â–¶ï¸ æ’­æ”¾</button>
                    <button class="timeline-btn" onclick="pauseSimulation()">â¸ï¸ æš‚åœ</button>
                    <button class="timeline-btn" onclick="resetSimulation()">â¹ï¸ é‡ç½®</button>
                    <select id="playbackSpeed" onchange="setPlaybackSpeed()">
                        <option value="0.5">0.5x</option>
                        <option value="1" selected>1x</option>
                        <option value="2">2x</option>
                        <option value="4">4x</option>
                    </select>
                </div>
            </div>
            <div class="timeline-slider">
                <input type="range" id="timeSlider" min="0" max="100" value="0" 
                       oninput="updateSimulationTime(this.value)">
                <div class="timeline-labels">
                    <span>å¼€å§‹</span>
                    <span id="currentTime">00:00</span>
                    <span>ç»“æŸ</span>
                </div>
            </div>
        </div>

        <!-- ä¿¡æ¯é¢æ¿ -->
        <div class="info-panel">
            <div class="panel-section">
                <h5>å½“å‰çŠ¶æ€</h5>
                <div class="status-grid">
                    <div class="status-item">
                        <span class="status-label">é£é™©ç­‰çº§:</span>
                        <span class="status-value orange" id="riskLevel">æ©™è‰²é¢„è­¦</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">å½±å“èŒƒå›´:</span>
                        <span class="status-value" id="affectedArea">åŠå¾„500ç±³</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">ç–æ•£äººæ•°:</span>
                        <span class="status-value" id="evacuationCount">156äºº</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">æ›´æ–°æ—¶é—´:</span>
                        <span class="status-value" id="updateTime">15:30:25</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨çŠ¶æ€æ  -->
        <footer class="footer">
            <div class="status-info">
                <span class="status-item">
                    <span class="status-label">VRæ¨¡å¼:</span>
                    <span class="status-value" id="vrModeStatus">å…³é—­</span>
                </span>
                <span class="status-item">
                    <span class="status-label">æ¸²æŸ“å¸§ç‡:</span>
                    <span class="status-value" id="fpsCounter">60 FPS</span>
                </span>
                <span class="status-item">
                    <span class="status-label">è§†è§’:</span>
                    <span class="status-value" id="cameraPosition">0Â°, 0Â°</span>
                </span>
                <span class="status-item">
                    <span class="status-label">è¿æ¥çŠ¶æ€:</span>
                    <span class="status-value online">åœ¨çº¿</span>
                </span>
            </div>
        </footer>
    </div>

    <!-- è®¾å¤‡ä¿¡æ¯æ¨¡æ€æ¡† -->
    <div id="deviceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="deviceModalTitle">è®¾å¤‡è¯¦æƒ…</h3>
                <span class="close" onclick="closeDeviceModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="deviceModalContent">
                    <!-- è®¾å¤‡è¯¦ç»†ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
        </div>
    </div>

    <script src="js/vr-panorama.js"></script>

    <!-- è‡ªå®šä¹‰æ¸å˜ç€è‰²å™¨ -->
    <script>
        // æ³¨å†Œæ¸å˜å¤©ç©ºç€è‰²å™¨
        AFRAME.registerShader('gradient', {
            schema: {
                topColor: {type: 'color', default: '#87CEEB'},
                bottomColor: {type: 'color', default: '#98FB98'}
            },
            vertexShader: `
                varying vec3 vWorldPosition;
                void main() {
                    vec4 worldPosition = modelMatrix * vec4(position, 1.0);
                    vWorldPosition = worldPosition.xyz;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            `,
            fragmentShader: `
                uniform vec3 topColor;
                uniform vec3 bottomColor;
                varying vec3 vWorldPosition;
                void main() {
                    float h = normalize(vWorldPosition + cameraPosition).y;
                    gl_FragColor = vec4(mix(bottomColor, topColor, max(pow(max(h, 0.0), 0.6), 0.0)), 1.0);
                }
            `
        });
    </script>
</body>
</html>
