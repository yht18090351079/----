<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VRå…¨æ™¯å¯è§†åŒ– - åœ°è´¨ç¾å®³é¢„è­¦ç³»ç»Ÿ</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŒ</text></svg>">
    <!-- A-Frame VRæ¡†æ¶ -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <!-- ç²’å­ç³»ç»Ÿç»„ä»¶ -->
    <script src="https://cdn.jsdelivr.net/gh/supermedium/superframe@master/components/particle-system/dist/aframe-particle-system-component.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: #000;
            overflow: hidden;
        }
        
        /* VRåœºæ™¯å…¨å± */
        a-scene {
            width: 100vw !important;
            height: 100vh !important;
        }
        
        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            backdrop-filter: blur(10px);
            color: #00ffff;
            font-family: 'Courier New', monospace;
            max-width: 250px;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
            color: #99ccff;
        }
        
        .control-group select,
        .control-group button {
            background: rgba(0, 30, 60, 0.8);
            border: 1px solid rgba(0, 255, 255, 0.3);
            color: #00ffff;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            margin: 2px;
            width: 100%;
        }
        
        .control-group button:hover {
            background: rgba(0, 255, 255, 0.2);
            border-color: #00ffff;
        }
        
        .simulation-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
        }
        
        .simulation-buttons button {
            width: auto;
        }
        
        /* ä¿¡æ¯æ˜¾ç¤º */
        .info-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            backdrop-filter: blur(10px);
            color: #00ffff;
            font-family: 'Courier New', monospace;
            min-width: 200px;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 12px;
        }
        
        .info-label {
            color: #99ccff;
        }
        
        .info-value {
            color: #00ffff;
            font-weight: bold;
        }
        
        /* åº•éƒ¨æ§åˆ¶æ  */
        .bottom-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 25px;
            padding: 10px 20px;
            backdrop-filter: blur(10px);
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .control-btn {
            background: rgba(0, 30, 60, 0.8);
            border: 1px solid rgba(0, 255, 255, 0.3);
            color: #00ffff;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            border-color: #00ffff;
            transform: scale(1.05);
        }
        
        .control-btn.active {
            background: rgba(0, 255, 255, 0.3);
            border-color: #00ffff;
        }
        
        /* æç¤ºä¿¡æ¯ */
        .toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: #00ffff;
            padding: 15px 25px;
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 255, 0.5);
            z-index: 2000;
            font-family: 'Courier New', monospace;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .toast.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
    <div class="control-panel">
        <!-- éšæ‚£ç‚¹é€‰æ‹© -->
        <div class="control-group">
            <label>éšæ‚£ç‚¹é€‰æ‹©</label>
            <select id="hazardPointSelect" onchange="switchHazardPoint()">
                <option value="point1">ç§€å²­æ‘æ»‘å¡éšæ‚£ç‚¹ (å±±åŒºæ£®æ—)</option>
                <option value="point2">é¾™æ½­æ²Ÿæ³¥çŸ³æµéšæ‚£ç‚¹ (æ²³è°·æ²Ÿå£‘)</option>
                <option value="point3">çŸ³å£å±±å´©å¡Œéšæ‚£ç‚¹ (å²©çŸ³å±±ä½“)</option>
                <option value="point4">ç»¿é‡å¹³åŸåœ°é™·éšæ‚£ç‚¹ (å†œç”°å¹³åŸ)</option>
            </select>
        </div>

        <!-- ç¾å®³æ¨¡æ‹Ÿ -->
        <div class="control-group">
            <label>ç¾å®³æ¨¡æ‹Ÿ</label>
            <div class="simulation-buttons">
                <button onclick="simulateDisaster('landslide')">ğŸ”ï¸ æ»‘å¡</button>
                <button onclick="simulateDisaster('debris-flow')">ğŸŒŠ æ³¥çŸ³æµ</button>
                <button onclick="simulateDisaster('collapse')">â›°ï¸ å´©å¡Œ</button>
                <button onclick="simulateDisaster('rainfall')">ğŸŒ§ï¸ é™é›¨</button>
            </div>
        </div>

        <!-- å›¾å±‚æ§åˆ¶ -->
        <div class="control-group">
            <label>å›¾å±‚æ˜¾ç¤º</label>
            <button onclick="toggleLayer('monitoring')">ğŸ“¡ ç›‘æµ‹è®¾å¤‡</button>
            <button onclick="toggleLayer('warning')">âš ï¸ é¢„è­¦åŒºåŸŸ</button>
            <button onclick="toggleLayer('evacuation')">ğŸšª ç–æ•£è·¯çº¿</button>
        </div>

        <!-- å…¨æ™¯æ¨¡å¼ -->
        <div class="control-group">
            <label>å…¨æ™¯æ¨¡å¼</label>
            <button onclick="togglePanoramaMode()">ğŸ–¼ï¸ åˆ‡æ¢å›¾ç‰‡æº</button>
            <button onclick="testAllPanoramas()">ğŸ”„ æµ‹è¯•å…¨æ™¯</button>
        </div>
    </div>

    <!-- å³ä¾§ä¿¡æ¯é¢æ¿ -->
    <div class="info-panel">
        <div class="info-item">
            <span class="info-label">å½“å‰ç‚¹ä½:</span>
            <span class="info-value" id="currentPoint">ç§€å²­æ‘æ»‘å¡éšæ‚£ç‚¹</span>
        </div>
        <div class="info-item">
            <span class="info-label">é£é™©ç­‰çº§:</span>
            <span class="info-value" id="riskLevel">æ©™è‰²é¢„è­¦</span>
        </div>
        <div class="info-item">
            <span class="info-label">ä½ç§»:</span>
            <span class="info-value" id="displacement">2.3mm</span>
        </div>
        <div class="info-item">
            <span class="info-label">é™é›¨:</span>
            <span class="info-value" id="rainfall">15mm/h</span>
        </div>
        <div class="info-item">
            <span class="info-label">å€¾æ–œ:</span>
            <span class="info-value" id="tilt">0.5Â°</span>
        </div>
        <div class="info-item">
            <span class="info-label">æ›´æ–°æ—¶é—´:</span>
            <span class="info-value" id="updateTime">15:30:25</span>
        </div>
        <div class="info-item">
            <span class="info-label">ç¯å¢ƒç±»å‹:</span>
            <span class="info-value" id="environmentType">çœŸå®è‡ªç„¶ç¯å¢ƒ</span>
        </div>
    </div>

    <!-- åº•éƒ¨æ§åˆ¶æ  -->
    <div class="bottom-controls">
        <button class="control-btn" onclick="resetView()">ğŸ¯ é‡ç½®è§†è§’</button>
        <button class="control-btn" onclick="toggleAutoRotate()">ğŸ”„ è‡ªåŠ¨æ—‹è½¬</button>
        <button class="control-btn" onclick="toggleVRMode()">ğŸ¥½ VRæ¨¡å¼</button>
        <button class="control-btn" onclick="clearSimulations()">ğŸ§¹ æ¸…é™¤æ¨¡æ‹Ÿ</button>
        <button class="control-btn" onclick="showEnvironmentInfo()">ğŸŒ ç¯å¢ƒè¯¦æƒ…</button>
        <button class="control-btn" onclick="goBack()">ğŸ  è¿”å›é¦–é¡µ</button>
    </div>

    <!-- VRå…¨æ™¯åœºæ™¯ -->
    <a-scene id="vrScene" embedded background="color: #000000">
        <!-- èµ„æºå®šä¹‰ -->
        <a-assets>
            <!-- çœŸå®è‡ªç„¶ç¯å¢ƒå…¨æ™¯å›¾ç‰‡ -->
            <!-- å±±åŒºæ£®æ—ç¯å¢ƒ - é€‚åˆæ»‘å¡éšæ‚£ç‚¹ -->
            <img id="panorama1" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/sechelt.jpg" crossorigin="anonymous">

            <!-- æ²³è°·æ²Ÿå£‘ç¯å¢ƒ - é€‚åˆæ³¥çŸ³æµéšæ‚£ç‚¹ -->
            <img id="panorama2" src="https://aframe.io/aframe/examples/boilerplate/panorama/puydesancy.jpg" crossorigin="anonymous">

            <!-- å²©çŸ³å±±ä½“ç¯å¢ƒ - é€‚åˆå´©å¡Œéšæ‚£ç‚¹ -->
            <img id="panorama3" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/city.jpg" crossorigin="anonymous">

            <!-- å¹³åŸå†œç”°ç¯å¢ƒ - é€‚åˆåœ°é™·éšæ‚£ç‚¹ -->
            <img id="panorama4" src="https://cdn.aframe.io/basic-guide/img/360-degree-photosphere.jpg" crossorigin="anonymous">

            <!-- å¤‡ç”¨çœŸå®ç¯å¢ƒå›¾ç‰‡ -->
            <img id="panorama5" src="https://cdn.pixabay.com/photo/2017/08/10/02/05/panoramic-2617608_1280.jpg" crossorigin="anonymous">
            <img id="panorama6" src="https://cdn.pixabay.com/photo/2016/11/29/05/45/forest-1867093_1280.jpg" crossorigin="anonymous">

            <!-- æ›´å¤šè‡ªç„¶ç¯å¢ƒå…¨æ™¯å›¾ç‰‡ -->
            <img id="mountain1" src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80" crossorigin="anonymous">
            <img id="forest1" src="https://images.unsplash.com/photo-1441974231531-c6227db76b6e?ixlib=rb-4.0.3&auto=format&fit=crop&w=2071&q=80" crossorigin="anonymous">
            <img id="valley1" src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80" crossorigin="anonymous">
            <img id="field1" src="https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-4.0.3&auto=format&fit=crop&w=2089&q=80" crossorigin="anonymous">

            <!-- æœ¬åœ°å¤‡ç”¨Canvasï¼ˆå¦‚æœç½‘ç»œå›¾ç‰‡å¤±è´¥ï¼‰ -->
            <canvas id="fallback1" width="2048" height="1024"></canvas>
            <canvas id="fallback2" width="2048" height="1024"></canvas>
            <canvas id="fallback3" width="2048" height="1024"></canvas>
            <canvas id="fallback4" width="2048" height="1024"></canvas>
        </a-assets>

        <!-- å…¨æ™¯å¤©ç©ºç›’ -->
        <a-sky id="panoramaSky" src="#panorama1" rotation="0 0 0"></a-sky>

        <!-- ç›‘æµ‹è®¾å¤‡ -->
        <a-entity id="monitoringDevices" visible="true">
            <!-- ä½ç§»ä¼ æ„Ÿå™¨ -->
            <a-box position="-3 2 -5" width="0.5" height="0.5" depth="0.5" 
                   color="#00ffff" 
                   animation="property: rotation; to: 0 360 0; loop: true; dur: 4000"
                   class="clickable"
                   onclick="showDeviceInfo('displacement')"></a-box>
            <a-text value="ä½ç§»ä¼ æ„Ÿå™¨" position="-3 3 -5" align="center" color="#00ffff" scale="0.8 0.8 0.8"></a-text>
            
            <!-- é›¨é‡è®¡ -->
            <a-cylinder position="3 1.5 -4" radius="0.3" height="1" 
                        color="#ffaa00"
                        animation="property: position; to: 3 2 -4; dir: alternate; loop: true; dur: 2000"
                        class="clickable"
                        onclick="showDeviceInfo('rainfall')"></a-cylinder>
            <a-text value="é›¨é‡è®¡" position="3 2.8 -4" align="center" color="#ffaa00" scale="0.8 0.8 0.8"></a-text>
        </a-entity>

        <!-- é¢„è­¦åŒºåŸŸ -->
        <a-entity id="warningAreas" visible="true">
            <a-ring position="0 0.1 -8" radius-inner="6" radius-outer="8" 
                    color="#ff4444" opacity="0.4"
                    animation="property: material.opacity; to: 0.8; dir: alternate; loop: true; dur: 2000"></a-ring>
            <a-text value="âš ï¸ é«˜é£é™©åŒºåŸŸ âš ï¸" position="0 2 -8" align="center" 
                    color="#ff4444" scale="1.2 1.2 1.2"
                    animation="property: position; to: 0 3 -8; dir: alternate; loop: true; dur: 2500"></a-text>
        </a-entity>

        <!-- ç–æ•£è·¯çº¿ -->
        <a-entity id="evacuationRoutes" visible="false">
            <a-cone position="2 1 -3" radius-bottom="0.3" radius-top="0" height="1" 
                    rotation="0 0 -90" color="#00ff00"
                    animation="property: position; to: 8 1 -3; loop: true; dur: 3000"></a-cone>
            <a-cone position="-2 1 -3" radius-bottom="0.3" radius-top="0" height="1" 
                    rotation="0 0 90" color="#00ff00"
                    animation="property: position; to: -8 1 -3; loop: true; dur: 3000"></a-cone>
        </a-entity>

        <!-- ç²’å­æ•ˆæœç³»ç»Ÿ -->
        <a-entity id="particleEffects">
            <!-- é™é›¨æ•ˆæœ -->
            <a-entity id="rainEffect" visible="false"
                      particle-system="preset: rain; particleCount: 1000; maxAge: 3; 
                                     positionSpread: 20 0 20; velocityValue: 0 -8 0; 
                                     color: #87CEEB; size: 0.5; opacity: 0.8"
                      position="0 10 0"></a-entity>
            
            <!-- æ»‘å¡åœŸçŸ³æ•ˆæœ -->
            <a-entity id="landslideEffect" visible="false"
                      particle-system="preset: dust; particleCount: 500; maxAge: 5; 
                                     positionSpread: 3 1 3; velocityValue: -1 -3 -2; 
                                     color: #8B4513; size: 1; opacity: 0.7"
                      position="-5 5 -8"></a-entity>
            
            <!-- æ³¥çŸ³æµæ•ˆæœ -->
            <a-entity id="debrisFlowEffect" visible="false"
                      particle-system="preset: dust; particleCount: 800; maxAge: 4; 
                                     positionSpread: 2 1 2; velocityValue: 0 -4 -3; 
                                     color: #654321; size: 1.5; opacity: 0.8"
                      position="0 6 -10"></a-entity>
            
            <!-- å´©å¡Œæ•ˆæœ -->
            <a-entity id="collapseEffect" visible="false"
                      particle-system="preset: dust; particleCount: 300; maxAge: 3; 
                                     positionSpread: 1 1 1; velocityValue: 0 -5 0; 
                                     color: #696969; size: 2; opacity: 0.9"
                      position="5 8 -6"></a-entity>
        </a-entity>

        <!-- ç›¸æœº -->
        <a-camera id="vrCamera" 
                  look-controls="enabled: true" 
                  wasd-controls="enabled: false"
                  position="0 1.6 0">
            <a-cursor color="#00ffff" 
                      animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
                      raycaster="objects: .clickable"></a-cursor>
        </a-camera>

        <!-- å…‰ç…§ -->
        <a-light type="ambient" color="#404040" intensity="0.6"></a-light>
        <a-light type="directional" position="5 10 5" color="#ffffff" intensity="0.8"></a-light>
    </a-scene>

    <script src="js/vr-panorama-new.js"></script>
</body>
</html>
