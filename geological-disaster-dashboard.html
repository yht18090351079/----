<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>地质灾害预警系统 - 实时监控大屏</title>
    
    <!-- CesiumJS CDN -->
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.131/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.131/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    
    <!-- ECharts CDN -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>

    <!-- Google Fonts - 科技感字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Orbitron', 'Roboto Mono', 'PingFang SC', 'Microsoft YaHei', monospace;
            background:
                radial-gradient(ellipse at top, #0f1419 0%, #0a0e1a 50%, #000000 100%),
                linear-gradient(135deg, #001122 0%, #002244 25%, #000011 50%, #001133 75%, #000000 100%);
            color: #00ffff;
            overflow: hidden;
            height: 100vh;
            position: relative;
        }

        /* 动态粒子背景 */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(2px 2px at 20px 30px, #00ffff, transparent),
                radial-gradient(2px 2px at 40px 70px, #0099ff, transparent),
                radial-gradient(1px 1px at 90px 40px, #ffffff, transparent),
                radial-gradient(1px 1px at 130px 80px, #00ffff, transparent),
                radial-gradient(2px 2px at 160px 30px, #0066ff, transparent);
            background-repeat: repeat;
            background-size: 200px 100px;
            animation: sparkle 20s linear infinite;
            opacity: 0.3;
            z-index: -1;
        }

        @keyframes sparkle {
            0% { transform: translateY(0px); }
            100% { transform: translateY(-100px); }
        }

        /* 扫描线效果 */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00ffff, transparent);
            animation: scan 3s linear infinite;
            z-index: 1;
        }

        @keyframes scan {
            0% { top: 0%; opacity: 1; }
            50% { opacity: 0.8; }
            100% { top: 100%; opacity: 0; }
        }

        /* 顶部导航栏 */
        .header {
            height: 80px;
            background:
                linear-gradient(135deg, rgba(0,255,255,0.1) 0%, rgba(0,150,255,0.1) 50%, rgba(0,100,200,0.1) 100%),
                linear-gradient(90deg, #001122 0%, #002244 50%, #001122 100%);
            border-bottom: 2px solid #00ffff;
            box-shadow:
                0 0 20px rgba(0,255,255,0.3),
                0 4px 20px rgba(0,0,0,0.5),
                inset 0 1px 0 rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 32px;
            position: relative;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, #00ffff, transparent);
            animation: headerGlow 2s ease-in-out infinite alternate;
        }

        @keyframes headerGlow {
            0% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo {
            width: 56px;
            height: 56px;
            background:
                radial-gradient(circle, #00ffff 0%, #0099ff 50%, #0066cc 100%);
            border: 2px solid #00ffff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #000011;
            font-weight: 900;
            font-family: 'Orbitron', monospace;
            box-shadow:
                0 0 20px rgba(0,255,255,0.5),
                inset 0 2px 4px rgba(255,255,255,0.3);
            animation: logoRotate 10s linear infinite;
            position: relative;
        }

        .logo::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            border: 1px solid #00ffff;
            border-radius: 50%;
            animation: logoPulse 2s ease-in-out infinite;
        }

        @keyframes logoRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes logoPulse {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }

        .system-title {
            font-size: 28px;
            font-weight: 900;
            font-family: 'Orbitron', monospace;
            color: #00ffff;
            text-shadow:
                0 0 10px #00ffff,
                0 0 20px #00ffff,
                0 0 30px #00ffff;
            letter-spacing: 2px;
            animation: titleGlow 3s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            0% {
                text-shadow:
                    0 0 10px #00ffff,
                    0 0 20px #00ffff,
                    0 0 30px #00ffff;
            }
            100% {
                text-shadow:
                    0 0 15px #00ffff,
                    0 0 25px #00ffff,
                    0 0 35px #00ffff,
                    0 0 45px #0099ff;
            }
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            background:
                linear-gradient(135deg, rgba(0,255,255,0.1) 0%, rgba(0,150,255,0.1) 100%);
            border: 1px solid rgba(0,255,255,0.3);
            border-radius: 25px;
            box-shadow:
                0 0 15px rgba(0,255,255,0.2),
                inset 0 1px 0 rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ff88;
            box-shadow:
                0 0 10px #00ff88,
                0 0 20px #00ff88;
            animation: statusPulse 2s infinite;
            position: relative;
        }

        .status-dot::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border: 1px solid #00ff88;
            border-radius: 50%;
            animation: statusRipple 2s infinite;
        }

        @keyframes statusPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        @keyframes statusRipple {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(2); }
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            background:
                linear-gradient(135deg, rgba(0,255,255,0.1) 0%, rgba(0,150,255,0.1) 100%);
            border: 1px solid rgba(0,255,255,0.3);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .user-info:hover {
            background:
                linear-gradient(135deg, rgba(0,255,255,0.2) 0%, rgba(0,150,255,0.2) 100%);
            box-shadow: 0 0 20px rgba(0,255,255,0.3);
            transform: translateY(-2px);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background:
                radial-gradient(circle, #00ffff 0%, #0099ff 100%);
            color: #000011;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-family: 'Orbitron', monospace;
            border: 2px solid #00ffff;
            box-shadow:
                0 0 15px rgba(0,255,255,0.5),
                inset 0 2px 4px rgba(255,255,255,0.3);
        }

        /* 主要内容区域 */
        .main-container {
            display: flex;
            height: calc(100vh - 80px);
        }

        /* 左侧菜单 */
        .sidebar {
            width: 280px;
            background:
                linear-gradient(180deg, rgba(0,20,40,0.9) 0%, rgba(0,10,30,0.9) 100%);
            backdrop-filter: blur(15px);
            border-right: 2px solid rgba(0,255,255,0.3);
            box-shadow:
                inset -1px 0 0 rgba(0,255,255,0.1),
                2px 0 20px rgba(0,0,0,0.5);
            padding: 32px 0;
            position: relative;
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 1px;
            height: 100%;
            background: linear-gradient(180deg, transparent, #00ffff, transparent);
            animation: sidebarGlow 3s ease-in-out infinite alternate;
        }

        @keyframes sidebarGlow {
            0% { opacity: 0.3; }
            100% { opacity: 0.8; }
        }

        .menu-item {
            padding: 16px 32px;
            margin: 8px 16px;
            cursor: pointer;
            transition: all 0.4s ease;
            border-left: 4px solid transparent;
            border-radius: 0 25px 25px 0;
            font-family: 'Roboto Mono', monospace;
            font-weight: 500;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .menu-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0,255,255,0.1), transparent);
            transition: left 0.5s ease;
        }

        .menu-item:hover::before {
            left: 100%;
        }

        .menu-item:hover {
            background:
                linear-gradient(135deg, rgba(0,255,255,0.1) 0%, rgba(0,150,255,0.1) 100%);
            border-left-color: #00ffff;
            color: #00ffff;
            box-shadow:
                0 0 15px rgba(0,255,255,0.2),
                inset 0 1px 0 rgba(255,255,255,0.1);
            transform: translateX(8px);
        }

        .menu-item.active {
            background:
                linear-gradient(135deg, rgba(0,255,255,0.2) 0%, rgba(0,150,255,0.2) 100%);
            border-left-color: #00ffff;
            color: #00ffff;
            box-shadow:
                0 0 20px rgba(0,255,255,0.3),
                inset 0 1px 0 rgba(255,255,255,0.2);
            transform: translateX(12px);
        }

        .menu-item.active::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            border-right: 8px solid #00ffff;
        }

        .menu-icon {
            display: inline-block;
            width: 24px;
            margin-right: 16px;
            font-size: 18px;
            text-align: center;
        }

        /* 中央地图区域 */
        .map-container {
            flex: 1;
            position: relative;
            background: #000;
        }

        #cesiumContainer {
            width: 100%;
            height: 100%;
        }

        /* 地图工具栏 */
        .map-toolbar {
            position: absolute;
            top: 24px;
            left: 24px;
            z-index: 100;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .toolbar-btn {
            padding: 12px 20px;
            background:
                linear-gradient(135deg, rgba(0,20,40,0.9) 0%, rgba(0,10,30,0.9) 100%);
            color: #00ffff;
            border: 1px solid rgba(0,255,255,0.3);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.4s ease;
            backdrop-filter: blur(15px);
            font-family: 'Roboto Mono', monospace;
            font-weight: 500;
            font-size: 14px;
            letter-spacing: 0.5px;
            box-shadow:
                0 4px 15px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
        }

        .toolbar-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .toolbar-btn:hover::before {
            left: 100%;
        }

        .toolbar-btn:hover {
            background:
                linear-gradient(135deg, rgba(0,255,255,0.2) 0%, rgba(0,150,255,0.2) 100%);
            border-color: #00ffff;
            box-shadow:
                0 0 20px rgba(0,255,255,0.4),
                0 4px 20px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .toolbar-btn.active {
            background:
                linear-gradient(135deg, rgba(0,255,255,0.3) 0%, rgba(0,150,255,0.3) 100%);
            border-color: #00ffff;
            box-shadow:
                0 0 25px rgba(0,255,255,0.5),
                0 4px 20px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.3);
            color: #ffffff;
        }

        .toolbar-btn.active::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 2px;
            border: 1px solid rgba(0,255,255,0.5);
            border-radius: 23px;
            animation: activeGlow 2s ease-in-out infinite alternate;
        }

        @keyframes activeGlow {
            0% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* 右侧信息面板 */
        .info-panel {
            width: 400px;
            background:
                linear-gradient(180deg, rgba(0,20,40,0.9) 0%, rgba(0,10,30,0.9) 100%);
            backdrop-filter: blur(15px);
            border-left: 2px solid rgba(0,255,255,0.3);
            box-shadow:
                inset 1px 0 0 rgba(0,255,255,0.1),
                -2px 0 20px rgba(0,0,0,0.5);
            padding: 32px 24px;
            overflow-y: auto;
            position: relative;
        }

        .info-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 1px;
            height: 100%;
            background: linear-gradient(180deg, transparent, #00ffff, transparent);
            animation: panelGlow 3s ease-in-out infinite alternate;
        }

        @keyframes panelGlow {
            0% { opacity: 0.3; }
            100% { opacity: 0.8; }
        }

        /* KPI卡片组 */
        .kpi-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 32px;
        }

        .kpi-card {
            background:
                linear-gradient(135deg, rgba(0,255,255,0.1) 0%, rgba(0,150,255,0.1) 100%);
            border: 1px solid rgba(0,255,255,0.3);
            border-radius: 15px;
            padding: 20px 16px;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: all 0.4s ease;
            box-shadow:
                0 4px 15px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.1);
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00ffff, transparent);
            animation: cardScan 3s linear infinite;
        }

        @keyframes cardScan {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .kpi-card:hover {
            transform: translateY(-4px);
            box-shadow:
                0 8px 25px rgba(0,255,255,0.2),
                0 4px 15px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.2);
            border-color: #00ffff;
        }

        .kpi-value {
            font-size: 28px;
            font-weight: 900;
            font-family: 'Orbitron', monospace;
            color: #00ffff;
            margin-bottom: 8px;
            text-shadow:
                0 0 10px #00ffff,
                0 0 20px #00ffff;
            animation: valueGlow 2s ease-in-out infinite alternate;
        }

        @keyframes valueGlow {
            0% {
                text-shadow:
                    0 0 10px #00ffff,
                    0 0 20px #00ffff;
            }
            100% {
                text-shadow:
                    0 0 15px #00ffff,
                    0 0 25px #00ffff,
                    0 0 35px #0099ff;
            }
        }

        .kpi-label {
            font-size: 12px;
            color: #99ccff;
            font-family: 'Roboto Mono', monospace;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        /* 预警信息列表 */
        .warning-section {
            margin-bottom: 32px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            font-family: 'Orbitron', monospace;
            margin-bottom: 20px;
            color: #00ffff;
            display: flex;
            align-items: center;
            gap: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow:
                0 0 10px #00ffff,
                0 0 20px #00ffff;
            position: relative;
        }

        .section-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, #00ffff, transparent);
            margin-left: 16px;
        }

        .warning-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .warning-item {
            background:
                linear-gradient(135deg, rgba(255,77,79,0.1) 0%, rgba(255,77,79,0.05) 100%);
            border: 1px solid rgba(255,77,79,0.4);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            position: relative;
            overflow: hidden;
            transition: all 0.4s ease;
            box-shadow:
                0 4px 15px rgba(255,77,79,0.1),
                inset 0 1px 0 rgba(255,255,255,0.1);
        }

        .warning-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: #ff4d4f;
            box-shadow: 0 0 10px #ff4d4f;
        }

        .warning-item:hover {
            transform: translateX(8px);
            box-shadow:
                0 8px 25px rgba(255,77,79,0.2),
                inset 0 1px 0 rgba(255,255,255,0.2);
        }

        .warning-item.orange {
            background:
                linear-gradient(135deg, rgba(250,140,22,0.1) 0%, rgba(250,140,22,0.05) 100%);
            border-color: rgba(250,140,22,0.4);
            box-shadow:
                0 4px 15px rgba(250,140,22,0.1),
                inset 0 1px 0 rgba(255,255,255,0.1);
        }

        .warning-item.orange::before {
            background: #fa8c16;
            box-shadow: 0 0 10px #fa8c16;
        }

        .warning-item.orange:hover {
            box-shadow:
                0 8px 25px rgba(250,140,22,0.2),
                inset 0 1px 0 rgba(255,255,255,0.2);
        }

        .warning-item.yellow {
            background:
                linear-gradient(135deg, rgba(250,219,20,0.1) 0%, rgba(250,219,20,0.05) 100%);
            border-color: rgba(250,219,20,0.4);
            box-shadow:
                0 4px 15px rgba(250,219,20,0.1),
                inset 0 1px 0 rgba(255,255,255,0.1);
        }

        .warning-item.yellow::before {
            background: #fadb14;
            box-shadow: 0 0 10px #fadb14;
        }

        .warning-item.yellow:hover {
            box-shadow:
                0 8px 25px rgba(250,219,20,0.2),
                inset 0 1px 0 rgba(255,255,255,0.2);
        }

        .warning-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .warning-level {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 700;
            font-family: 'Roboto Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .warning-level::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: levelScan 2s linear infinite;
        }

        @keyframes levelScan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .warning-level.red {
            background:
                linear-gradient(135deg, #FF4D4F 0%, #d32f2f 100%);
            color: #ffffff;
            box-shadow:
                0 0 15px rgba(255,77,79,0.5),
                inset 0 1px 0 rgba(255,255,255,0.3);
        }

        .warning-level.orange {
            background:
                linear-gradient(135deg, #FA8C16 0%, #e65100 100%);
            color: #ffffff;
            box-shadow:
                0 0 15px rgba(250,140,22,0.5),
                inset 0 1px 0 rgba(255,255,255,0.3);
        }

        .warning-level.yellow {
            background:
                linear-gradient(135deg, #FADB14 0%, #f57f17 100%);
            color: #000000;
            box-shadow:
                0 0 15px rgba(250,219,20,0.5),
                inset 0 1px 0 rgba(255,255,255,0.3);
        }

        .warning-time {
            font-size: 12px;
            color: #8C8C8C;
        }

        .warning-content {
            font-size: 14px;
            line-height: 1.4;
        }

        /* 设备状态 */
        .device-status {
            margin-bottom: 24px;
        }

        .device-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .device-name {
            font-size: 14px;
        }

        .device-status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            position: relative;
            animation: devicePulse 2s infinite;
        }

        .device-status-dot::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border-radius: 50%;
            animation: deviceRipple 2s infinite;
        }

        .device-status-dot.online {
            background: #00ff88;
            box-shadow:
                0 0 10px #00ff88,
                0 0 20px #00ff88;
        }

        .device-status-dot.online::before {
            border: 1px solid #00ff88;
        }

        .device-status-dot.offline {
            background: #666666;
            box-shadow:
                0 0 5px #666666;
        }

        .device-status-dot.offline::before {
            border: 1px solid #666666;
        }

        .device-status-dot.warning {
            background: #ff8800;
            box-shadow:
                0 0 10px #ff8800,
                0 0 20px #ff8800;
            animation: warningBlink 1s infinite;
        }

        .device-status-dot.warning::before {
            border: 1px solid #ff8800;
        }

        @keyframes devicePulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        @keyframes deviceRipple {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(2); }
        }

        @keyframes warningBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* 底部状态栏 */
        .footer {
            height: 56px;
            background:
                linear-gradient(90deg, rgba(0,20,40,0.9) 0%, rgba(0,10,30,0.9) 50%, rgba(0,20,40,0.9) 100%);
            border-top: 2px solid rgba(0,255,255,0.3);
            box-shadow:
                inset 0 1px 0 rgba(0,255,255,0.1),
                0 -2px 20px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 32px;
            font-size: 13px;
            font-family: 'Roboto Mono', monospace;
            color: #99ccff;
            backdrop-filter: blur(10px);
            position: relative;
        }

        .footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, #00ffff, transparent);
            animation: footerGlow 3s ease-in-out infinite alternate;
        }

        @keyframes footerGlow {
            0% { opacity: 0.3; }
            100% { opacity: 0.8; }
        }

        .footer span {
            color: #00ffff;
            font-weight: 500;
        }

        /* 响应式设计 */
        @media (max-width: 1366px) {
            .sidebar {
                width: 200px;
            }
            
            .info-panel {
                width: 300px;
            }
            
            .kpi-cards {
                grid-template-columns: 1fr;
            }
        }

        /* 加载动画 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(ellipse at center, #001122 0%, #000000 70%),
                linear-gradient(135deg, #0c1426 0%, #1a2332 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 3px solid transparent;
            border-top: 3px solid #00ffff;
            border-right: 3px solid #0099ff;
            border-radius: 50%;
            animation: spinGlow 1.5s linear infinite;
            margin-bottom: 30px;
            position: relative;
            box-shadow:
                0 0 20px rgba(0,255,255,0.5),
                inset 0 0 20px rgba(0,255,255,0.1);
        }

        .loading-spinner::before {
            content: '';
            position: absolute;
            top: -6px;
            left: -6px;
            right: -6px;
            bottom: -6px;
            border: 1px solid rgba(0,255,255,0.3);
            border-radius: 50%;
            animation: spinGlow 2s linear infinite reverse;
        }

        .loading-spinner::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background:
                radial-gradient(circle, #00ffff 0%, #0099ff 100%);
            border-radius: 50%;
            box-shadow: 0 0 15px #00ffff;
            animation: centerPulse 1s ease-in-out infinite alternate;
        }

        @keyframes spinGlow {
            0% {
                transform: rotate(0deg);
                box-shadow:
                    0 0 20px rgba(0,255,255,0.5),
                    inset 0 0 20px rgba(0,255,255,0.1);
            }
            50% {
                box-shadow:
                    0 0 30px rgba(0,255,255,0.8),
                    inset 0 0 30px rgba(0,255,255,0.2);
            }
            100% {
                transform: rotate(360deg);
                box-shadow:
                    0 0 20px rgba(0,255,255,0.5),
                    inset 0 0 20px rgba(0,255,255,0.1);
            }
        }

        @keyframes centerPulse {
            0% {
                transform: translate(-50%, -50%) scale(1);
                box-shadow: 0 0 15px #00ffff;
            }
            100% {
                transform: translate(-50%, -50%) scale(1.2);
                box-shadow: 0 0 25px #00ffff;
            }
        }

        .loading-text {
            font-size: 24px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            color: #00ffff;
            margin-bottom: 16px;
            text-shadow:
                0 0 10px #00ffff,
                0 0 20px #00ffff,
                0 0 30px #00ffff;
            letter-spacing: 3px;
            animation: textGlow 2s ease-in-out infinite alternate;
        }

        @keyframes textGlow {
            0% {
                text-shadow:
                    0 0 10px #00ffff,
                    0 0 20px #00ffff,
                    0 0 30px #00ffff;
            }
            100% {
                text-shadow:
                    0 0 15px #00ffff,
                    0 0 25px #00ffff,
                    0 0 35px #00ffff,
                    0 0 45px #0099ff;
            }
        }

        .loading-progress {
            font-size: 16px;
            font-family: 'Roboto Mono', monospace;
            color: #99ccff;
            letter-spacing: 1px;
            animation: progressFade 1.5s ease-in-out infinite alternate;
        }

        @keyframes progressFade {
            0% { opacity: 0.6; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- 加载遮罩 -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">地质灾害预警系统</div>
        <div class="loading-progress">正在初始化系统...</div>
    </div>

    <!-- 顶部导航栏 -->
    <header class="header">
        <div class="header-left">
            <div class="logo">⚡</div>
            <h1 class="system-title">地质灾害预警系统</h1>
        </div>
        <div class="header-right">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span>系统正常</span>
            </div>
            <div class="user-info">
                <div class="user-avatar">管</div>
                <span>管理员</span>
            </div>
        </div>
    </header>

    <!-- 主要内容区域 -->
    <div class="main-container">
        <!-- 左侧菜单 -->
        <nav class="sidebar">
            <div class="menu-item active">
                <span class="menu-icon">◉</span>
                实时监控
            </div>
            <div class="menu-item">
                <span class="menu-icon">△</span>
                预警管理
            </div>
            <div class="menu-item">
                <span class="menu-icon">▲</span>
                数据分析
            </div>
            <div class="menu-item">
                <span class="menu-icon">◆</span>
                应急指挥
            </div>
            <div class="menu-item">
                <span class="menu-icon">◈</span>
                系统设置
            </div>
        </nav>

        <!-- 中央地图区域 -->
        <main class="map-container">
            <!-- 地图工具栏 -->
            <div class="map-toolbar">
                <button class="toolbar-btn active" id="homeBtn">◎ 回到成都</button>
                <button class="toolbar-btn active" id="terrainBtn">▲ 关闭地形</button>
                <button class="toolbar-btn" id="boundaryBtn">◇ 行政区划</button>
                <button class="toolbar-btn" id="imageryBtn">◈ 切换影像</button>
                <button class="toolbar-btn" id="addPointBtn">● 添加监测点</button>
                <button class="toolbar-btn" id="addAreaBtn">△ 添加预警区域</button>
                <button class="toolbar-btn" id="clearBtn">◌ 清除所有</button>
            </div>
            
            <!-- CesiumJS 容器 -->
            <div id="cesiumContainer"></div>
        </main>

        <!-- 右侧信息面板 -->
        <aside class="info-panel">
            <!-- KPI指标卡片 -->
            <div class="kpi-cards">
                <div class="kpi-card">
                    <div class="kpi-value" id="onlineDevices">98.5%</div>
                    <div class="kpi-label">在线设备率</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value" id="dataIntegrity">95.2%</div>
                    <div class="kpi-label">数据完整性</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value" id="todayWarnings">3</div>
                    <div class="kpi-label">当日预警</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value" id="processingEvents">1</div>
                    <div class="kpi-label">处理中事件</div>
                </div>
            </div>

            <!-- 最新预警信息 -->
            <div class="warning-section">
                <h3 class="section-title">
                    <span>△</span>
                    最新预警信息
                </h3>
                <div class="warning-list" id="warningList">
                    <!-- 预警项目将通过JavaScript动态生成 -->
                </div>
            </div>

            <!-- 设备状态 -->
            <div class="device-status">
                <h3 class="section-title">
                    <span>◉</span>
                    设备状态
                </h3>
                <div id="deviceList">
                    <!-- 设备状态将通过JavaScript动态生成 -->
                </div>
            </div>

            <!-- 实时通知 -->
            <div class="notification-section">
                <h3 class="section-title">
                    <span>◈</span>
                    实时通知
                </h3>
                <div id="notificationList">
                    <!-- 通知将通过JavaScript动态生成 -->
                </div>
            </div>
        </aside>
    </div>

    <!-- 底部状态栏 -->
    <footer class="footer">
        <div class="footer-left">
            <span>监测点总数: <span id="totalPoints">156</span></span>
            <span style="margin-left: 24px;">在线设备: <span id="onlinePoints">154</span></span>
        </div>
        <div class="footer-center">
            <span>最后更新: <span id="lastUpdate">2024-07-17 14:30:25</span></span>
        </div>
        <div class="footer-right">
            <span>系统版本: v2.1.0</span>
        </div>
    </footer>

    <script>
        // 全局变量
        let viewer = null;
        let pointCount = 0;
        let terrainEnabled = true;
        let boundaryEnabled = false;
        let imageryIndex = 0;
        let boundaryDataSource = null;

        // 系统初始化
        class GeologicalDisasterDashboard {
            constructor() {
                this.init();
            }

            async init() {
                try {
                    console.log('🌍 初始化地质灾害预警系统...');
                    
                    // 更新加载进度
                    this.updateLoadingProgress('正在加载CesiumJS...');
                    
                    // 检查Cesium是否加载
                    if (typeof Cesium === 'undefined') {
                        throw new Error('CesiumJS CDN库未加载');
                    }
                    
                    // 设置Cesium Ion Token (使用有效的token)
                    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI2YjZlZDZhMS0xZGMzLTRlMjAtOWMyMC1hY2U2ZGI1OWM3YzIiLCJpZCI6MzIyMjE3LCJpYXQiOjE3NTI3MTgyMDZ9.ESrgN3eQQTxnHv-UUG5aJz7ojlnK9EAzfqFqgXPmH7M';

                    this.updateLoadingProgress('正在初始化3D地球...');

                    // 初始化Cesium Viewer (使用世界地形)
                    viewer = new Cesium.Viewer('cesiumContainer', {
                        terrainProvider: await Cesium.createWorldTerrainAsync({
                            requestWaterMask: true,
                            requestVertexNormals: true
                        }),
                        imageryProvider: new Cesium.OpenStreetMapImageryProvider({
                            url: 'https://tile.openstreetmap.org/',
                            fileExtension: 'png'
                        }),
                        baseLayerPicker: false,
                        geocoder: false,
                        homeButton: false,
                        sceneModePicker: false,
                        navigationHelpButton: false,
                        animation: false,
                        timeline: false,
                        fullscreenButton: false,
                        vrButton: false
                    });

                    // 设置初始地形状态
                    terrainEnabled = true;
                    
                    this.updateLoadingProgress('正在配置场景...');
                    
                    // 配置场景
                    this.configureScene();
                    
                    this.updateLoadingProgress('正在设置事件监听器...');
                    
                    // 设置事件监听器
                    this.setupEventListeners();
                    
                    this.updateLoadingProgress('正在添加初始内容...');
                    
                    // 添加初始内容
                    this.addInitialContent();
                    
                    this.updateLoadingProgress('正在飞到成都...');
                    
                    // 飞到成都
                    await this.flyToChengdu();
                    
                    this.updateLoadingProgress('正在初始化数据...');
                    
                    // 初始化模拟数据
                    this.initializeData();
                    
                    this.updateLoadingProgress('启动实时数据更新...');
                    
                    // 启动实时数据更新
                    this.startRealTimeUpdates();
                    
                    // 隐藏加载遮罩
                    this.hideLoading();
                    
                    console.log('✅ 地质灾害预警系统初始化完成');
                    
                } catch (error) {
                    console.error('❌ 系统初始化失败:', error);
                    this.showError(error.message);
                }
            }

            updateLoadingProgress(message) {
                const progressElement = document.querySelector('.loading-progress');
                if (progressElement) {
                    progressElement.textContent = message;
                }
            }

            hideLoading() {
                setTimeout(() => {
                    const overlay = document.getElementById('loadingOverlay');
                    if (overlay) {
                        overlay.style.opacity = '0';
                        setTimeout(() => {
                            overlay.style.display = 'none';
                        }, 500);
                    }
                }, 1000);
            }

            showError(message) {
                const overlay = document.getElementById('loadingOverlay');
                if (overlay) {
                    overlay.innerHTML = `
                        <div style="text-align: center;">
                            <div style="font-size: 48px; color: #FF4757; margin-bottom: 20px;">❌</div>
                            <div style="color: #FF4757; font-size: 18px; margin-bottom: 10px;">系统初始化失败</div>
                            <div style="font-size: 14px; color: #B8C5D6;">${message}</div>
                            <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #1890FF; color: white; border: none; border-radius: 6px; cursor: pointer;">重新加载</button>
                        </div>
                    `;
                }
            }

            configureScene() {
                const scene = viewer.scene;

                // 基础场景配置
                scene.globe.enableLighting = true;
                scene.fog.enabled = true;
                scene.fog.density = 0.0001;
                scene.fog.screenSpaceErrorFactor = 2.0;

                // 优化性能设置
                scene.globe.maximumScreenSpaceError = 2;
                scene.globe.tileCacheSize = 100;

                // 禁用深度测试以确保边界显示
                scene.globe.depthTestAgainstTerrain = false;

                console.log('🎬 场景配置完成');
            }

            setupEventListeners() {
                // 按钮事件监听器
                document.getElementById('homeBtn').addEventListener('click', () => this.flyToChengdu());
                document.getElementById('addPointBtn').addEventListener('click', () => this.addMonitoringPoint());
                document.getElementById('addAreaBtn').addEventListener('click', () => this.addWarningArea());
                document.getElementById('terrainBtn').addEventListener('click', (e) => this.toggleTerrain(e));
                document.getElementById('boundaryBtn').addEventListener('click', (e) => this.toggleBoundary(e));
                document.getElementById('imageryBtn').addEventListener('click', (e) => this.toggleImagery(e));
                document.getElementById('clearBtn').addEventListener('click', () => this.clearAll());

                // 键盘快捷键
                document.addEventListener('keydown', (e) => this.handleKeyboard(e));

                console.log('⚡ 事件监听器已设置');
            }

            async flyToChengdu() {
                if (!viewer) return;

                return viewer.camera.flyTo({
                    destination: Cesium.Cartesian3.fromDegrees(104.0668, 30.5728, 50000),
                    orientation: {
                        heading: 0,
                        pitch: Cesium.Math.toRadians(-45),
                        roll: 0
                    },
                    duration: 2.0
                });
            }

            addInitialContent() {
                if (!viewer) return;

                // 添加成都标记
                viewer.entities.add({
                    id: 'chengdu-city',
                    name: '成都市',
                    position: Cesium.Cartesian3.fromDegrees(104.0668, 30.5728),
                    point: {
                        pixelSize: 15,
                        color: Cesium.Color.YELLOW,
                        outlineColor: Cesium.Color.BLACK,
                        outlineWidth: 2,
                        heightReference: Cesium.HeightReference.CLAMP_TO_GROUND
                    },
                    label: {
                        text: '成都市',
                        font: '16pt sans-serif',
                        fillColor: Cesium.Color.YELLOW,
                        outlineColor: Cesium.Color.BLACK,
                        outlineWidth: 2,
                        style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                        pixelOffset: new Cesium.Cartesian2(0, -40),
                        heightReference: Cesium.HeightReference.CLAMP_TO_GROUND
                    }
                });

                console.log('📍 初始内容已添加');
            }

            addMonitoringPoint() {
                const names = ['监测点A', '监测点B', '监测点C', '监测点D', '监测点E'];
                const statuses = ['normal', 'warning', 'danger', 'normal'];

                const name = names[Math.floor(Math.random() * names.length)] + '-' + (pointCount + 1);
                const lon = 104.0668 + (Math.random() - 0.5) * 0.5;
                const lat = 30.5728 + (Math.random() - 0.5) * 0.5;
                const status = statuses[Math.floor(Math.random() * statuses.length)];

                this.addPointToMap(name, lon, lat, status);
            }

            addPointToMap(name, lon, lat, status) {
                const colors = {
                    normal: Cesium.Color.LIME,
                    warning: Cesium.Color.YELLOW,
                    danger: Cesium.Color.RED,
                    offline: Cesium.Color.GRAY
                };

                viewer.entities.add({
                    id: `monitoring-point-${pointCount}`,
                    name: name,
                    position: Cesium.Cartesian3.fromDegrees(lon, lat),
                    point: {
                        pixelSize: 12,
                        color: colors[status],
                        outlineColor: Cesium.Color.BLACK,
                        outlineWidth: 2,
                        heightReference: Cesium.HeightReference.CLAMP_TO_GROUND
                    },
                    label: {
                        text: name,
                        font: '12pt sans-serif',
                        fillColor: colors[status],
                        outlineColor: Cesium.Color.BLACK,
                        outlineWidth: 1,
                        style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                        pixelOffset: new Cesium.Cartesian2(0, -30),
                        heightReference: Cesium.HeightReference.CLAMP_TO_GROUND
                    }
                });

                pointCount++;
                this.updatePointCount();
                console.log('📍 已添加监测点:', name);
            }

            addWarningArea() {
                const areaId = 'warning-area-' + Date.now();
                const centerLon = 104.0668 + (Math.random() - 0.5) * 0.3;
                const centerLat = 30.5728 + (Math.random() - 0.5) * 0.3;
                const size = 0.05 + Math.random() * 0.05;

                viewer.entities.add({
                    id: areaId,
                    name: '预警区域',
                    polygon: {
                        hierarchy: Cesium.Cartesian3.fromDegreesArray([
                            centerLon - size, centerLat - size,
                            centerLon + size, centerLat - size,
                            centerLon + size, centerLat + size,
                            centerLon - size, centerLat + size
                        ]),
                        material: Cesium.Color.RED.withAlpha(0.3),
                        outline: true,
                        outlineColor: Cesium.Color.RED,
                        height: 0,
                        extrudedHeight: 1000
                    }
                });

                console.log('⚠️ 已添加预警区域:', areaId);
            }

            initializeData() {
                // 初始化预警数据
                this.updateWarningList();

                // 初始化设备状态
                this.updateDeviceStatus();

                // 初始化通知
                this.updateNotifications();

                console.log('📊 模拟数据已初始化');
            }

            updateWarningList() {
                const warnings = [
                    {
                        level: 'red',
                        levelText: '红色预警',
                        content: 'XX村滑坡风险极高，请立即撤离',
                        time: '14:25'
                    },
                    {
                        level: 'orange',
                        levelText: '橙色预警',
                        content: 'XX镇泥石流风险较高，注意防范',
                        time: '13:45'
                    },
                    {
                        level: 'yellow',
                        levelText: '黄色预警',
                        content: 'XX县地质灾害风险一般，保持警惕',
                        time: '12:30'
                    }
                ];

                const warningList = document.getElementById('warningList');
                warningList.innerHTML = warnings.map(warning => `
                    <div class="warning-item ${warning.level}">
                        <div class="warning-header">
                            <span class="warning-level ${warning.level}">${warning.levelText}</span>
                            <span class="warning-time">${warning.time}</span>
                        </div>
                        <div class="warning-content">${warning.content}</div>
                    </div>
                `).join('');
            }

            updateDeviceStatus() {
                const devices = [
                    { name: '监测站001', status: 'online' },
                    { name: '监测站002', status: 'online' },
                    { name: '监测站003', status: 'warning' },
                    { name: '监测站004', status: 'online' },
                    { name: '监测站005', status: 'offline' }
                ];

                const deviceList = document.getElementById('deviceList');
                deviceList.innerHTML = devices.map(device => `
                    <div class="device-item">
                        <span class="device-name">${device.name}</span>
                        <div class="device-status-dot ${device.status}"></div>
                    </div>
                `).join('');
            }

            updateNotifications() {
                const notifications = [
                    '系统自检完成，所有模块正常运行',
                    '新增3个监测点数据接入',
                    '预警推送服务已启动',
                    '数据备份任务执行成功'
                ];

                const notificationList = document.getElementById('notificationList');
                notificationList.innerHTML = notifications.map(notification => `
                    <div class="device-item">
                        <span class="device-name">${notification}</span>
                    </div>
                `).join('');
            }

            updatePointCount() {
                document.getElementById('totalPoints').textContent = 156 + pointCount;
                document.getElementById('onlinePoints').textContent = 154 + pointCount;
            }

            startRealTimeUpdates() {
                // 每30秒更新一次数据
                setInterval(() => {
                    this.updateKPIData();
                    this.updateLastUpdateTime();
                }, 30000);

                // 每5分钟更新一次预警信息
                setInterval(() => {
                    this.updateWarningList();
                }, 300000);

                console.log('🔄 实时数据更新已启动');
            }

            updateKPIData() {
                // 模拟KPI数据变化
                const onlineRate = (98 + Math.random() * 2).toFixed(1);
                const dataIntegrity = (94 + Math.random() * 4).toFixed(1);
                const todayWarnings = Math.floor(Math.random() * 5) + 1;
                const processingEvents = Math.floor(Math.random() * 3);

                document.getElementById('onlineDevices').textContent = onlineRate + '%';
                document.getElementById('dataIntegrity').textContent = dataIntegrity + '%';
                document.getElementById('todayWarnings').textContent = todayWarnings;
                document.getElementById('processingEvents').textContent = processingEvents;
            }

            updateLastUpdateTime() {
                const now = new Date();
                const timeString = now.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                document.getElementById('lastUpdate').textContent = timeString;
            }

            async toggleTerrain(event) {
                if (!viewer) return;

                const btn = event.target;
                btn.disabled = true;

                try {
                    terrainEnabled = !terrainEnabled;

                    if (terrainEnabled) {
                        // 尝试启用世界地形，如果失败则使用椭球体
                        try {
                            if (typeof Cesium.createWorldTerrainAsync === 'function') {
                                viewer.terrainProvider = await Cesium.createWorldTerrainAsync({
                                    requestWaterMask: true,
                                    requestVertexNormals: true
                                });
                            } else if (typeof Cesium.createWorldTerrain === 'function') {
                                viewer.terrainProvider = Cesium.createWorldTerrain({
                                    requestWaterMask: true,
                                    requestVertexNormals: true
                                });
                            } else {
                                throw new Error('世界地形API不可用');
                            }
                            btn.textContent = '🏔️ 关闭地形';
                            console.log('🏔️ 世界地形已启用');
                        } catch (terrainError) {
                            console.warn('世界地形加载失败，使用椭球体地形:', terrainError);
                            viewer.terrainProvider = new Cesium.EllipsoidTerrainProvider();
                            terrainEnabled = false;
                            btn.textContent = '🏔️ 开启地形';
                            console.log('🌍 降级到椭球体地形');
                        }
                    } else {
                        viewer.terrainProvider = new Cesium.EllipsoidTerrainProvider();
                        btn.textContent = '🏔️ 开启地形';
                        console.log('🌍 椭球体地形已启用');
                    }

                    btn.classList.toggle('active', terrainEnabled);
                } catch (error) {
                    console.error('地形切换失败:', error);
                    terrainEnabled = false;
                    btn.textContent = '🏔️ 开启地形';
                } finally {
                    btn.disabled = false;
                }
            }

            async toggleBoundary(event) {
                if (!viewer) return;

                const btn = event.target;
                btn.disabled = true;

                try {
                    boundaryEnabled = !boundaryEnabled;

                    if (boundaryEnabled) {
                        await this.loadAdministrativeBoundaries();
                        btn.textContent = '🗾 关闭区划';
                        console.log('🗾 行政区划已启用');
                    } else {
                        this.removeAdministrativeBoundaries();
                        btn.textContent = '🗾 行政区划';
                        console.log('🗾 行政区划已关闭');
                    }

                    btn.classList.toggle('active', boundaryEnabled);
                } catch (error) {
                    console.error('行政区划切换失败:', error);
                    boundaryEnabled = false;
                    btn.textContent = '🗾 行政区划';
                } finally {
                    btn.disabled = false;
                }
            }

            async loadAdministrativeBoundaries() {
                // 先清除现有的行政区划数据
                this.removeAdministrativeBoundaries();

                // 创建数据源
                boundaryDataSource = new Cesium.CustomDataSource('行政区划');
                viewer.dataSources.add(boundaryDataSource);

                // 加载四川省边界
                await this.loadSichuanBoundary();

                // 加载成都市边界
                await this.loadChengduBoundary();
            }

            async loadSichuanBoundary() {
                const sichuanBoundary = [
                    97.35, 32.99, 99.17, 33.97, 100.58, 33.30, 102.72, 33.40,
                    104.07, 33.30, 105.92, 32.85, 107.89, 31.85, 108.54, 31.16,
                    108.25, 30.05, 107.89, 28.93, 106.96, 28.23, 105.97, 27.99,
                    104.52, 27.88, 103.04, 27.74, 101.89, 27.99, 100.32, 28.29,
                    99.15, 28.97, 98.47, 29.84, 97.91, 30.93, 97.35, 32.99
                ];

                // 添加polygon填充
                boundaryDataSource.entities.add({
                    id: 'sichuan-province-fill',
                    name: '四川省填充',
                    polygon: {
                        hierarchy: Cesium.Cartesian3.fromDegreesArray(sichuanBoundary),
                        material: Cesium.Color.CYAN.withAlpha(0.1),
                        outline: false,
                        height: 30000,
                        extrudedHeight: 60000,
                        heightReference: Cesium.HeightReference.RELATIVE_TO_GROUND
                    }
                });

                // 添加polyline边界线
                boundaryDataSource.entities.add({
                    id: 'sichuan-province',
                    name: '四川省',
                    polyline: {
                        positions: Cesium.Cartesian3.fromDegreesArray(sichuanBoundary),
                        width: 6,
                        material: new Cesium.PolylineGlowMaterialProperty({
                            glowPower: 0.2,
                            color: Cesium.Color.CYAN
                        }),
                        clampToGround: false,
                        heightReference: Cesium.HeightReference.RELATIVE_TO_GROUND,
                        zIndex: 900
                    },
                    label: {
                        text: '四川省',
                        font: '18pt sans-serif',
                        fillColor: Cesium.Color.CYAN,
                        outlineColor: Cesium.Color.BLACK,
                        outlineWidth: 3,
                        style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                        pixelOffset: new Cesium.Cartesian2(0, -35),
                        show: true,
                        scale: 1.1
                    }
                });
            }

            async loadChengduBoundary() {
                const chengduBoundary = [
                    102.54, 31.42, 103.17, 31.47, 104.33, 31.23, 104.70, 30.98,
                    104.85, 30.39, 104.37, 30.03, 103.94, 29.97, 103.46, 30.41,
                    103.07, 30.63, 102.54, 31.42
                ];

                // 添加polygon填充
                boundaryDataSource.entities.add({
                    id: 'chengdu-city-fill',
                    name: '成都市填充',
                    polygon: {
                        hierarchy: Cesium.Cartesian3.fromDegreesArray(chengduBoundary),
                        material: Cesium.Color.YELLOW.withAlpha(0.2),
                        outline: false,
                        height: 20000,
                        extrudedHeight: 40000,
                        heightReference: Cesium.HeightReference.RELATIVE_TO_GROUND
                    }
                });

                // 添加polyline边界线
                boundaryDataSource.entities.add({
                    id: 'chengdu-city',
                    name: '成都市',
                    polyline: {
                        positions: Cesium.Cartesian3.fromDegreesArray(chengduBoundary),
                        width: 5,
                        material: new Cesium.PolylineGlowMaterialProperty({
                            glowPower: 0.2,
                            color: Cesium.Color.YELLOW
                        }),
                        clampToGround: false,
                        heightReference: Cesium.HeightReference.RELATIVE_TO_GROUND,
                        zIndex: 800
                    },
                    label: {
                        text: '成都市',
                        font: '16pt sans-serif',
                        fillColor: Cesium.Color.YELLOW,
                        outlineColor: Cesium.Color.BLACK,
                        outlineWidth: 2,
                        style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                        pixelOffset: new Cesium.Cartesian2(0, -30),
                        show: true
                    }
                });
            }

            removeAdministrativeBoundaries() {
                if (boundaryDataSource) {
                    viewer.dataSources.remove(boundaryDataSource);
                    boundaryDataSource = null;
                }
            }

            toggleImagery(event) {
                if (!viewer) return;

                const btn = event.target;
                btn.disabled = true;

                try {
                    const imageryProviders = [
                        {
                            name: '街道地图',
                            provider: () => new Cesium.OpenStreetMapImageryProvider({
                                url: 'https://tile.openstreetmap.org/',
                                fileExtension: 'png'
                            })
                        },
                        {
                            name: '卫星影像',
                            provider: () => new Cesium.UrlTemplateImageryProvider({
                                url: 'https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',
                                maximumLevel: 18,
                                credit: 'Google Earth'
                            })
                        },
                        {
                            name: '地形图',
                            provider: () => new Cesium.UrlTemplateImageryProvider({
                                url: 'https://mt1.google.com/vt/lyrs=p&x={x}&y={y}&z={z}',
                                maximumLevel: 18,
                                credit: 'Google Terrain'
                            })
                        }
                    ];

                    // 确保索引有效
                    if (imageryIndex >= imageryProviders.length) {
                        imageryIndex = 0;
                    }

                    // 循环切换影像
                    imageryIndex = (imageryIndex + 1) % imageryProviders.length;
                    const currentImagery = imageryProviders[imageryIndex];

                    console.log(`🔄 切换到索引 ${imageryIndex}: ${currentImagery.name}`);

                    // 移除当前影像层
                    viewer.imageryLayers.removeAll();

                    // 添加新的影像层
                    try {
                        const provider = currentImagery.provider();
                        const imageryLayer = new Cesium.ImageryLayer(provider);
                        viewer.imageryLayers.add(imageryLayer);

                        // 更新按钮文本
                        btn.textContent = `🗺️ ${currentImagery.name}`;
                        console.log('✅ 成功切换到:', currentImagery.name);

                    } catch (providerError) {
                        console.error(`❌ 影像提供者 ${currentImagery.name} 创建失败:`, providerError);

                        // 使用最基本的OpenStreetMap作为备用
                        const fallbackProvider = new Cesium.OpenStreetMapImageryProvider({
                            url: 'https://a.tile.openstreetmap.org/'
                        });
                        viewer.imageryLayers.add(new Cesium.ImageryLayer(fallbackProvider));
                        btn.textContent = '🗺️ 街道地图';
                        console.log('🔄 已降级到基础街道地图');
                    }

                } catch (error) {
                    console.error('❌ 影像切换失败:', error);
                    btn.textContent = '🗺️ 切换影像';
                } finally {
                    btn.disabled = false;
                }
            }

            clearAll() {
                if (!viewer) return;

                // 清除所有实体（除了成都标记）
                const entities = viewer.entities.values;
                for (let i = entities.length - 1; i >= 0; i--) {
                    if (entities[i].id !== 'chengdu-city') {
                        viewer.entities.remove(entities[i]);
                    }
                }

                pointCount = 0;
                this.updatePointCount();

                console.log('🗑️ 已清除所有监测点和预警区域');
            }

            handleKeyboard(e) {
                switch (e.key.toLowerCase()) {
                    case 'h':
                        this.flyToChengdu();
                        break;
                    case 'p':
                        this.addMonitoringPoint();
                        break;
                    case 'w':
                        this.addWarningArea();
                        break;
                    case 't':
                        document.getElementById('terrainBtn').click();
                        break;
                    case 'b':
                        document.getElementById('boundaryBtn').click();
                        break;
                    case 'i':
                        document.getElementById('imageryBtn').click();
                        break;
                    case 'c':
                        this.clearAll();
                        break;
                }
            }
        }

        // 启动应用
        document.addEventListener('DOMContentLoaded', () => {
            new GeologicalDisasterDashboard();
        });
    </script>
</body>
</html>
