<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CesiumJS åŠ è½½æµ‹è¯•</title>
    
    <!-- å¼•å…¥CesiumJS CDN -->
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.131/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.131/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    
    <style>
        html, body, #cesiumContainer {
            width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
        }
        
        .status-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 8px;
            z-index: 1000;
            max-width: 300px;
        }
        
        .status-item {
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
        }
        
        .status-success {
            color: #00FF88;
        }
        
        .status-error {
            color: #FF4444;
        }
        
        .status-warning {
            color: #FFAA00;
        }
    </style>
</head>
<body>
    <div id="cesiumContainer"></div>
    
    <div class="status-panel">
        <h3>ğŸ§ª CesiumJS åŠ è½½æµ‹è¯•</h3>
        <div class="status-item">
            <span>CesiumJS åº“:</span>
            <span id="cesiumStatus">æ£€æµ‹ä¸­...</span>
        </div>
        <div class="status-item">
            <span>CSS æ ·å¼:</span>
            <span id="cssStatus">æ£€æµ‹ä¸­...</span>
        </div>
        <div class="status-item">
            <span>3D æ¸²æŸ“:</span>
            <span id="renderStatus">æ£€æµ‹ä¸­...</span>
        </div>
        <div class="status-item">
            <span>Ion è¿æ¥:</span>
            <span id="ionStatus">æ£€æµ‹ä¸­...</span>
        </div>
    </div>

    <script>
        // æµ‹è¯•çŠ¶æ€
        const status = {
            cesium: false,
            css: false,
            render: false,
            ion: false
        };

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(type, success, message = '') {
            status[type] = success;
            const element = document.getElementById(type + 'Status');
            if (success) {
                element.textContent = 'âœ… æ­£å¸¸';
                element.className = 'status-success';
            } else {
                element.textContent = 'âŒ å¤±è´¥' + (message ? ` (${message})` : '');
                element.className = 'status-error';
            }
        }

        // æ£€æµ‹ CSS åŠ è½½
        function checkCSS() {
            try {
                // æ£€æŸ¥æ˜¯å¦æœ‰ cesium-widget ç›¸å…³çš„æ ·å¼
                const stylesheets = document.styleSheets;
                let cesiumCSSFound = false;
                
                for (let i = 0; i < stylesheets.length; i++) {
                    const sheet = stylesheets[i];
                    if (sheet.href && sheet.href.includes('cesium') && sheet.href.includes('widgets.css')) {
                        cesiumCSSFound = true;
                        break;
                    }
                }
                
                updateStatus('css', cesiumCSSFound);
            } catch (error) {
                updateStatus('css', false, error.message);
            }
        }

        // ä¸»è¦æµ‹è¯•å‡½æ•°
        async function runTests() {
            console.log('ğŸ§ª å¼€å§‹ CesiumJS åŠ è½½æµ‹è¯•...');
            
            // 1. æ£€æµ‹ CesiumJS åº“æ˜¯å¦åŠ è½½
            try {
                if (typeof Cesium !== 'undefined') {
                    updateStatus('cesium', true);
                    console.log('âœ… CesiumJS åº“åŠ è½½æˆåŠŸ');
                } else {
                    updateStatus('cesium', false, 'åº“æœªå®šä¹‰');
                    return;
                }
            } catch (error) {
                updateStatus('cesium', false, error.message);
                return;
            }

            // 2. æ£€æµ‹ CSS æ ·å¼
            checkCSS();

            // 3. æµ‹è¯• 3D æ¸²æŸ“
            try {
                // è®¾ç½® Ion Token
                Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI2YjZlZDZhMS0xZGMzLTRlMjAtOWMyMC1hY2U2ZGI1OWM3YzIiLCJpZCI6MzIyMjE3LCJpYXQiOjE3NTI3MTgyMDZ9.ESrgN3eQQTxnHv-UUG5aJz7ojlnK9EAzfqFqgXPmH7M';

                const viewer = new Cesium.Viewer('cesiumContainer', {
                    homeButton: false,
                    sceneModePicker: false,
                    baseLayerPicker: false,
                    navigationHelpButton: false,
                    animation: false,
                    timeline: false,
                    fullscreenButton: false,
                    geocoder: false,
                    infoBox: false,
                    selectionIndicator: false
                });

                updateStatus('render', true);
                console.log('âœ… 3D æ¸²æŸ“åˆå§‹åŒ–æˆåŠŸ');

                // 4. æµ‹è¯• Ion è¿æ¥
                try {
                    // é£è¡Œåˆ°æˆéƒ½æµ‹è¯•
                    await viewer.camera.flyTo({
                        destination: Cesium.Cartesian3.fromDegrees(104.0668, 30.5728, 50000),
                        duration: 2.0
                    });
                    
                    updateStatus('ion', true);
                    console.log('âœ… Ion æœåŠ¡è¿æ¥æ­£å¸¸');
                    
                    // æ·»åŠ æµ‹è¯•ç‚¹
                    viewer.entities.add({
                        name: 'æµ‹è¯•ç‚¹',
                        position: Cesium.Cartesian3.fromDegrees(104.0668, 30.5728),
                        point: {
                            pixelSize: 20,
                            color: Cesium.Color.YELLOW,
                            outlineColor: Cesium.Color.BLACK,
                            outlineWidth: 2
                        },
                        label: {
                            text: 'âœ… CesiumJS æµ‹è¯•æˆåŠŸ',
                            font: '16pt Microsoft YaHei',
                            pixelOffset: new Cesium.Cartesian2(0, -50),
                            fillColor: Cesium.Color.WHITE,
                            outlineColor: Cesium.Color.BLACK,
                            outlineWidth: 2,
                            style: Cesium.LabelStyle.FILL_AND_OUTLINE
                        }
                    });

                } catch (error) {
                    updateStatus('ion', false, error.message);
                    console.warn('âš ï¸ Ion æœåŠ¡è¿æ¥é—®é¢˜:', error);
                }

            } catch (error) {
                updateStatus('render', false, error.message);
                console.error('âŒ 3D æ¸²æŸ“å¤±è´¥:', error);
            }

            // è¾“å‡ºæµ‹è¯•ç»“æœ
            console.log('ğŸ§ª æµ‹è¯•å®Œæˆï¼Œç»“æœ:', status);
            
            const allSuccess = Object.values(status).every(s => s);
            if (allSuccess) {
                console.log('ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼CesiumJS åœ¨ Netlify ä¸Šè¿è¡Œæ­£å¸¸');
            } else {
                console.log('âš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥å…·ä½“é—®é¢˜');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œæµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(runTests, 1000); // å»¶è¿Ÿ1ç§’ç¡®ä¿èµ„æºåŠ è½½å®Œæˆ
        });
    </script>
</body>
</html>
